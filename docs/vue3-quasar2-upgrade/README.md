# Quasar 2 升级执行入口

> 本目录用于统一跟踪 **Moqui Quasar 1 → Quasar 2** 升级落地过程的计划、进度与校验数据。

## 目录索引

- [阶段计划](phase-plan.md) — 详细分阶段目标、任务拆解与交付物。
- [进度日志](progress-log.md) — 记录每次执行动作与结果，保持可追溯。
- [验证清单](validation-checklist.md) — 升级后每个阶段必须跑的检查项。
- [JWT认证统一规范](jwt-auth-standard.md) — Claude Code & Codex 在 JWT 认证实施上的统一标准。

## 团队协作模式 🤝

**三方协作角色分工**（2025-10-18更新）：

| 角色 | 主要职责 | 核心工作范围 |
| --- | --- | --- |
| **Claude Code** | 审查和验证工作 | 代码评审、架构分析、质量验证、文档审核、兼容性检查 |
| **Codex** | 计划和执行工作 | 任务规划、代码实现、测试执行、CI/CD操作、本地验证 |
| **协调者** | 协同和推进工作 | 任务分配、进度跟踪、决策协调、团队沟通、工作流管理 |

**协作原则**：
- Claude Code负责"审查验证"，确保质量和兼容性
- Codex负责"计划执行"，推进具体开发任务
- 协调者负责"协同推进"，保证团队高效协作
- **同步机制**：一方执行完成后必须立即更新文档并通知另一方，确保信息同步后才能进行下一步工作
- **主动推进机制**：
  - **Claude Code**: 每隔1-2分钟检查进度日志，发现Codex工作完成后立即接手审查验证任务
  - **Codex**: 每隔1-2分钟检查进度日志，发现Claude Code工作完成后立即接手执行任务
  - **自主推进**: 发现有待处理的工作时，无需等待通知，直接开始执行分工范围内的任务
- 所有交互和决策更新到本文档，保持信息透明

## 升级原则

1. **先对齐再迭代**：动手前先核对官方代码，非必要不保留差异。
2. **过程可复现**：每次操作必须配套日志和验证结果，确保可回滚、可追溯。
3. **团队协作**：三方明确分工，Claude Code审查验证、Codex计划执行、协调者推进协同。
4. **强制验证**：Chrome MCP 截图、自动化脚本等检查必须通过后才能关闭阶段任务。

## 工作流约束

| 步骤 | 角色分工说明                                                             |
| --- |--------------------------------------------------------------------|
| 1. 读取计划 | **所有角色**：先查阅 [阶段计划](phase-plan.md)，确认当前阶段与TODO。                    |
| 2. 执行操作 | **Codex**：负责所有代码改动和本地操作；**Claude Code**：提供审查和验证；**协调者**：协调任务分配。    |
| 3. 记录日志 | **执行者**：操作完成后立即在 [进度日志](progress-log.md) 记录日期、执行人、结果与待办。           |
| 4. 同步通知 | **执行者**：完成工作后必须更新文档并通知其他方，确保信息同步后才能进行下一步。                          |
| 5. 主动检查 | **Claude Code**: 每1-2分钟检查一次；**Codex**: 每1-2分钟检查一次；发现工作完成立即接手。      |
| 6. 校验结果 | **Claude Code**：按 [验证清单](validation-checklist.md) 审查验证结果，失败则指导回滚修复。 |

## 文档风格规范 📝

**统一的文档组织方式**（避免风格冲突）：

### 结构标准
- **文件头部**：简洁描述文档用途，用 `>` 引用格式说明关键约束
- **表格格式**：统一使用 `| 列1 | 列2 | 列3 |` 格式，包含清晰的表头分隔线
- **状态值**：使用标准化状态词汇：`todo` / `in-progress` / `blocked` / `done`
- **日期格式**：统一使用 `YYYY-MM-DD` 格式
- **执行者标识**：明确标注 `Claude Code` / `Codex` / `协调者`

### 内容组织
- **层级标题**：使用 `##` 主要章节，`###` 子章节，`####` 详细分类
- **任务编号**：采用 `阶段-序号` 格式（如 `1-1`, `2-3`）
- **引用说明**：重要提醒用 `> 📌` 标记，普通说明用 `>`
- **清单项目**：使用 `- [ ]` 格式标记待验证项，`- [x]` 标记已完成项

### 更新约定
- **追加顺序**：进度日志采用倒序（最新在上），其他文档采用逻辑顺序
- **修改标记**：所有更新都应在相关文档中留下日期和执行者信息
- **交叉引用**：用 `[文档名](文件名.md)` 格式进行文档间链接

### Emoji 使用标准
- 🤝 团队协作相关
- 📝 文档和规范相关
- 🚀 执行和实施相关
- ✅ 完成和验证相关
- ⚠️ 风险和注意事项
- 📌 重要提醒和关键点
- 🔁 循环和迭代过程
- 🧾 清单和检查项目

**所有团队成员更新文档时请严格遵循此规范，确保文档一致性和可读性。**

## 使用规范

- **新增任务**：更新 `phase-plan.md` 对应阶段的 TODO，并在日志新增“任务录入”记录。

## Slot 渲染修复模式

- 原因：Vue3 中通过 `v-html` 将 `$slots` 强转为字符串会渲染成 `[object Object]`。
- 解决：组件模板改为直接渲染 `<slot></slot>` 或具名 slot，而不是 `v-html`。
- 覆盖范围：`m-link`/`router-link` 等所有自定义组件逐一替换，确保默认 slot 直接输出。
- 验证：Chrome MCP 复测 Re-Login、Mermaid、表单容器等使用该模式的界面，确认文本与 HTML 正常显示。
- 复用：后续如再遇到 slot 内容被输出为 `[object Object]`，优先排查是否存在 `v-html`/`innerHTML` 替换并执行同样改造。

## 待执行（交给 Claude Code）

1. 核对 `diff-2025-10-13.md`，确认 runtime/webroot 与官方差异汇总准确。
2. 审阅 `phase-plan.md` 与 `progress-log.md`，确认阶段 0 状态标记合理，如需调整请同步记录。
3. 复核中/英文升级指南（`docs/vue-quasar-upgrade-*.md`），确保示例代码与当前实现一致。
4. 再次验证最新 Chrome MCP 基线截图是否正常加载（截图位于 `/tmp/baseline_jwt_homepage.png`，脚本 `testing-tools/jwt_chrome_mcp.sh` 已更新）。
5. 若发现缺失的验证项，更新 `validation-checklist.md` 并在进度日志中说明。

> 📌 Claude Code 仅负责审阅/文档修订，不执行本地命令，请按上述步骤完成后在日志追加记录。

## Codex 待执行

1. 当 Moqui 服务可用时运行 `testing-tools/jwt_chrome_mcp.sh`，建立 `/tmp/baseline_jwt_homepage.png` 基线，并更新验证清单。
2. 维护 `testing-tools/jwt_chrome_mcp.sh`（localStorage 注入方案）并确保基线截图更新。
3. 根据阶段计划推进阶段 1 的兼容层重构（参考 `phase1-compat-assessment.md` 执行逐步替换）。
4. 在每次代码改动后执行必要的本地验证，更新 `progress-log.md` 与 `validation-checklist.md`。
5. 与 Claude Code 的审阅结果配合，落实需要的代码/脚本调整。

> 🔁 Codex 与 Claude Code 协同时，务必按照进度日志记录顺序更新，避免信息脱节。

## 协作节奏约定

- **检查频率**：双方每隔 3 分钟检查一次 `progress-log.md` 与 `phase-plan.md` 状态。若发现对方任务已完成或文档已更新，即自动进入下一环节执行。
- **快速响应**：Claude Code 任务预计 1-3 分钟完成，Codex 任务通常 3-8 分钟；如超出预期，请在日志中说明原因。
- **自助接力**：发现待办进入可执行状态时，无需等待提醒，直接自助推进并记录。


- **阶段切换**：满足出口条件后写明“阶段完成”，同步更新计划状态。
- **外部依赖**：遇到待确认事项，在日志中显式标注，避免遗漏。
- **自动化脚本**：新增或修改脚本必须在验证清单中登记执行指令与预期输出。

> ✅ 任何人/任何工具在升级过程中行动前，都必须先阅读本入口文档。
