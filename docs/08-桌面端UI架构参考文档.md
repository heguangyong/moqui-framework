# 桌面端 UI 架构参考文档

> 小说动漫生成器 (NovelAnimeDesktop) 前端 UI 架构设计文档

## 1. 整体布局结构

应用采用经典的三栏布局设计，从左到右依次为：

```
┌──────────────────────────────────────────────────────────────────┐
│                         App Container                             │
├────────┬─────────────────────────────────────────────────────────┤
│        │                    Middle Panel                          │
│ Narrow │  ┌──────────────┬────────────────────────────────────┐  │
│ Sidebar│  │ Menu Column  │         Main Area                   │  │
│ (56px) │  │   (280px)    │      (Router View)                  │  │
│        │  │              │                                      │  │
│  导航   │  │  Context     │    各功能视图组件                    │  │
│  图标   │  │  Panel       │    (Dashboard/Workflow/             │  │
│        │  │              │     Characters/Assets/Settings)      │  │
│        │  │              │                                      │  │
│        │  └──────────────┴────────────────────────────────────┘  │
└────────┴─────────────────────────────────────────────────────────┘
```

### 1.1 左侧极窄侧边栏 (Narrow Sidebar)

- 宽度：固定 56px
- 功能：主导航入口
- 组件：`App.vue` 内嵌

**导航项：**
| ID | 图标 | 标签 | 路由 |
|------------|----------|----------|-------------|
| dashboard | home | 项目概览 | /dashboard |
| workflow | gitBranch| 工作流 | /workflow |
| assets | folderOpen| 资源库 | /assets |
| characters | users | 角色管理 | /characters |
| settings | settings | 设置 | /settings |

### 1.2 中间面板 (Middle Panel)

分为两部分：
- **Menu Column (280px)**：上下文面板，根据当前导航动态切换
- **Main Area (flex: 1)**：主内容区，通过 Vue Router 渲染视图

### 1.3 状态管理

使用 Pinia 进行状态管理，核心 Store：

| Store | 文件 | 职责 |
|-------|------|------|
| navigation | `stores/navigation.js` | 导航状态、面板上下文 |
| ui | `stores/ui.js` | UI 状态、通知、加载 |
| project | `stores/project.js` | 项目数据 |
| task | `stores/task.js` | 任务数据 |
| file | `stores/file.js` | 文件树数据 |
| workflow | `stores/workflow.js` | 工作流数据 |

## 2. 组件架构

### 2.1 面板组件 (Panels)

位置：`components/panels/`

| 组件 | 对应导航 | 功能 |
|------|----------|------|
| `ContextPanel.vue` | - | 面板容器，动态加载子面板 |
| `DashboardPanel.vue` | dashboard | 项目/状态/历史/文档导航 |
| `WorkflowContextPanel.vue` | workflow | 工作流列表、模板、执行记录 |
| `AssetsPanel.vue` | assets | 资源分类导航 |
| `CharactersPanel.vue` | characters | 角色列表、筛选 |
| `SettingsPanel.vue` | settings | 设置分类导航 |

### 2.2 视图组件 (Views)

位置：`views/`

| 组件 | 路由 | 功能 |
|------|------|------|
| `DashboardView.vue` | /dashboard | 仪表盘主视图 |
| `WorkflowEditor.vue` | /workflow | 工作流编辑器 |
| `AssetsView.vue` | /assets | 资源管理视图 |
| `CharactersView.vue` | /characters | 角色列表视图 |
| `CharacterDetailView.vue` | /characters/:id | 角色详情视图 |
| `Settings.vue` | /settings | 设置视图 |
| `ProfileView.vue` | /profile | 个人资料视图 |
| `TestView.vue` | /test | 组件测试视图 |

### 2.3 UI 组件

位置：`components/ui/`

| 组件 | 功能 |
|------|------|
| `ViewHeader.vue` | 视图头部（标题、副标题、操作按钮） |
| `EmptyState.vue` | 空状态占位 |
| `ConfirmDialog.vue` | 确认对话框 |

## 3. 数据流与通信机制

### 3.1 导航状态流

```
用户点击侧边栏图标
       ↓
App.vue handleNavClick()
       ↓
navigationStore.setActiveNav(navId)
       ↓
router.push(route)
       ↓
ContextPanel 监听 activeNavId 变化
       ↓
动态加载对应 Panel 组件
```

### 3.2 面板-视图通信

面板组件通过 `panelContext` 与视图组件通信：

```javascript
// Panel 组件更新上下文
navigationStore.updatePanelContext('dashboard', {
  viewType: 'status',
  statusFilter: 'running'
});

// View 组件监听上下文变化
const dashboardContext = computed(() => 
  navigationStore.panelContext.dashboard
);

watch(dashboardContext, (newVal) => {
  // 根据上下文更新视图
});
```

### 3.3 panelContext 结构

```javascript
panelContext: {
  dashboard: {
    selectedProject: null,    // 选中的项目类型
    statusFilter: null,       // 状态筛选
    viewType: null,           // 视图类型
    historyType: null         // 历史类型
  },
  workflow: {
    selectedWorkflow: null,   // 选中的工作流
    executionFilter: null,    // 执行筛选
    viewType: null,           // 视图类型
    statusFilter: null,       // 状态筛选
    templateId: null,         // 模板ID
    executionId: null         // 执行ID
  },
  assets: {
    category: null,           // 资源分类
    searchQuery: '',          // 搜索关键词
    viewType: null,           // 视图类型
    selectedAsset: null,      // 选中的资源
    filters: []               // 筛选条件
  },
  characters: {
    searchQuery: '',          // 搜索关键词
    filterLocked: null,       // 锁定状态筛选
    selectedCharacter: null,  // 选中的角色
    viewType: null            // 视图类型
  },
  settings: {
    activeCategory: 'profile' // 当前设置分类
  }
}
```

## 4. 路由配置

```javascript
const routes = [
  { path: '/', redirect: '/dashboard' },
  { path: '/dashboard', component: DashboardView },
  { path: '/workflow', component: WorkflowEditor },
  { path: '/assets', component: AssetsView },
  { path: '/characters', component: CharactersView },
  { path: '/characters/:id', component: CharacterDetailView },
  { path: '/settings', component: Settings },
  { path: '/profile', component: ProfileView },
  { path: '/test', component: TestView },
  { path: '/login', component: LoginView, meta: { guest: true } }
]
```

## 5. 样式规范

### 5.1 配色方案

采用灰色系为主的配色：

| 用途 | 颜色值 |
|------|--------|
| 背景主色 | #8a8a8a |
| 面板背景 | linear-gradient(145deg, #b8b8b8, #a8a8a8) |
| 侧边栏图标区 | linear-gradient(180deg, #2a2a2a, #1a1a1a) |
| 文字主色 | #2c2c2e |
| 文字次色 | #5a5a5c |
| 文字辅助色 | #9a9a9a |
| 选中高亮 | linear-gradient(90deg, rgba(210,210,210,0.5), rgba(200,218,212,0.4)) |

### 5.2 间距规范

| 用途 | 值 |
|------|-----|
| 应用外边距 | 12px |
| 组件间距 | 12px |
| 内边距（小） | 6-10px |
| 内边距（中） | 14-16px |
| 内边距（大） | 20-24px |

### 5.3 圆角规范

| 用途 | 值 |
|------|-----|
| 大容器 | 12px |
| 卡片/按钮 | 8px |
| 小元素 | 6px |
| 标签/徽章 | 12-14px |

## 6. 交互规范

### 6.1 工具提示

- 延迟显示：300ms
- 位置：元素右侧 12px
- 动画：fadeIn 0.15s

### 6.2 视图切换

- 使用 Vue Transition
- 动画名称：view-fade
- 模式：out-in

### 6.3 选中状态

- 背景渐变高亮
- 右侧显示 5px 宽的标注线
- 标注线使用渐变色：#8a8a8a → #b8b8b8

## 7. 文件结构

```
src/renderer/
├── main.js                 # 应用入口
├── App.vue                 # 根组件
├── router/
│   └── index.js            # 路由配置
├── stores/
│   ├── navigation.js       # 导航状态
│   ├── ui.js               # UI 状态
│   ├── project.js          # 项目数据
│   ├── task.js             # 任务数据
│   ├── file.js             # 文件数据
│   └── workflow.js         # 工作流数据
├── components/
│   ├── panels/             # 面板组件
│   ├── ui/                 # UI 组件
│   ├── explorer/           # 文件树组件
│   ├── novel/              # 小说相关组件
│   ├── character/          # 角色相关组件
│   ├── workflow/           # 工作流相关组件
│   └── ...
├── views/                  # 视图组件
├── services/               # API 服务
├── utils/                  # 工具函数
│   └── icons.js            # 图标配置
└── styles/
    └── main.scss           # 全局样式
```

## 8. 开发指南

### 8.1 添加新导航项

1. 在 `App.vue` 的 `navItems` 数组中添加配置
2. 在 `navigation.js` 的 `panelContext` 中添加对应上下文
3. 创建对应的 Panel 组件
4. 在 `ContextPanel.vue` 中注册组件
5. 创建对应的 View 组件
6. 在 `router/index.js` 中添加路由

### 8.2 面板-视图通信

```javascript
// Panel 中更新上下文
function handleItemClick(item) {
  navigationStore.updatePanelContext('navId', {
    viewType: 'detail',
    selectedItem: item.id
  });
}

// View 中监听变化
const context = computed(() => navigationStore.panelContext.navId);

watch(context, (newVal) => {
  if (newVal.viewType === 'detail') {
    loadDetail(newVal.selectedItem);
  }
}, { deep: true });
```

### 8.3 路由导航

对于需要独立页面的详情视图，使用路由导航：

```javascript
// Panel 中
function handleItemClick(item) {
  router.push(`/items/${item.id}`);
}

// View 中
const route = useRoute();
const itemId = computed(() => route.params.id);

watch(itemId, (newId) => {
  loadItem(newId);
}, { immediate: true });
```

---

*文档版本：1.0*
*更新日期：2024-12-21*
