# å‰ç«¯ç§»åŠ¨ç«¯å®Œæ•´å®æ–½æ–¹æ¡ˆ - AIé©±åŠ¨Moquiæœ€ä½³å®è·µæŒ‡å—

## ğŸ¯ é¡¹ç›®æ¦‚è§ˆ

### æŠ€æœ¯é€‰å‹ç¡®è®¤
åŸºäºæ·±åº¦åˆ†æï¼Œé‡‡ç”¨**Quasar Framework**ä½œä¸ºå‰ç«¯ç§»åŠ¨ç«¯æŠ€æœ¯æ ˆï¼Œå®ç°ï¼š
- ğŸ¤– **AIåŸç”Ÿç§»åŠ¨åº”ç”¨**: è¯­éŸ³äº¤äº’ã€å›¾åƒè¯†åˆ«ã€æ™ºèƒ½æ¨è
- ğŸ”„ **æ— ç¼åç«¯é›†æˆ**: ä¸JWTã€REST APIã€MCPæ¶æ„å®Œç¾é…åˆ
- ğŸ“± **ä¸€æ¬¡å¼€å‘ï¼Œå¤šç«¯éƒ¨ç½²**: Webã€iOSã€Androidç»Ÿä¸€ä½“éªŒ
- âš¡ **æœ€å¤§åŒ–ä»£ç å¤ç”¨**: 95%ä»£ç å¤ç”¨ç°æœ‰Vue3+Quasar2æŠ€æœ¯æ ˆ

### æ ¸å¿ƒç›®æ ‡
ä¸ºAIé©±åŠ¨çš„Moquiåç«¯é€‰æ‹©æœ€ä½³å‰ç«¯APPæŠ€æœ¯æ ˆï¼Œå®ç°ï¼š
- ğŸ¤– **AIåŸç”Ÿä½“éªŒ**: è¯­éŸ³äº¤äº’ã€å›¾åƒè¯†åˆ«ã€æ™ºèƒ½æ¨è
- ğŸ“± **è·¨å¹³å°è¦†ç›–**: iOSã€Androidã€Webç»Ÿä¸€ä½“éªŒ
- ğŸ”„ **åç«¯æ— ç¼é›†æˆ**: ä¸JWTè®¤è¯ã€REST APIã€MCPæ¶æ„å®Œç¾åŒ¹é…
- âš¡ **é«˜æ€§èƒ½äº¤äº’**: å®æ—¶å“åº”ã€ç¦»çº¿èƒ½åŠ›ã€æµç•…åŠ¨ç”»

---

## ğŸ“Š æŠ€æœ¯é€‰å‹åˆ†æ

### âœ… ç°æœ‰æŠ€æœ¯åŸºç¡€
- **JWTçº¯è®¤è¯**: æ— çŠ¶æ€è®¤è¯ï¼Œå®Œç¾æ”¯æŒç§»åŠ¨ç«¯
- **REST API**: `/rest/s1/` ç»Ÿä¸€APIç½‘å…³
- **MCP AIæ¶æ„**: æ™ºè°±AI GLM-4/GLM-4Vå¤šæ¨¡æ€èƒ½åŠ›
- **Vue3 + Quasar2**: ç°æœ‰Webç«¯æˆç†ŸæŠ€æœ¯æ ˆ

### ğŸ’¡ æŠ€æœ¯ç»§æ‰¿ç­–ç•¥
```
ç°æœ‰Webç«¯(Vue3+Quasar2) â†’ ç§»åŠ¨ç«¯æŠ€æœ¯é€‰å‹
        â†“
å¤ç”¨ç»„ä»¶åº“ã€APIè°ƒç”¨ã€çŠ¶æ€ç®¡ç†
```

## ğŸš€ Quasar Framework å®Œæ•´æ–¹æ¡ˆ â­â­â­â­â­

### æ ¸å¿ƒä¼˜åŠ¿
**ä¸ç°æœ‰Vue3+Quasar2æŠ€æœ¯æ ˆ100%å…¼å®¹ï¼ŒæŠ€æœ¯æŠ•èµ„æœ€å¤§åŒ–**

#### æŠ€æœ¯æ¶æ„
```javascript
// ç»Ÿä¸€çš„Quasaråº”ç”¨æ¶æ„
export default {
  // Webç«¯ (å·²æœ‰)
  web: 'spa',

  // ç§»åŠ¨ç«¯ (æ–°å¢)
  capacitor: {
    platforms: ['ios', 'android']
  },

  // PWA (æ¸è¿›å¼)
  pwa: true,

  // æ¡Œé¢ç«¯ (å¯é€‰)
  electron: {
    platforms: ['mac', 'win', 'linux']
  }
}
```

#### éƒ¨ç½²æ¶æ„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Quasar App                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Web (SPA)   â”‚ iOS App     â”‚Android  â”‚
â”‚ Vue3+Quasar â”‚ Capacitor   â”‚App      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚             â”‚           â”‚
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚    Moqui Backend (JWT + REST)     â”‚
   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
   â”‚  â”‚   MCP   â”‚ â”‚  Business APIs  â”‚  â”‚
   â”‚  â”‚AI Gatewayâ”‚ â”‚HiveMind/PopCom â”‚  â”‚
   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ› ï¸ æŠ€æœ¯ä¼˜åŠ¿æ€»ç»“

#### 1. æŠ€æœ¯æ ˆä¸€è‡´æ€§ â­â­â­â­â­
- **å‰åç«¯ç»Ÿä¸€**: Vue3 + TypeScript
- **ç»„ä»¶åº“ç»Ÿä¸€**: Quasar UIç»„ä»¶
- **å¼€å‘å·¥å…·ç»Ÿä¸€**: Viteã€ESLintã€Prettier

#### 2. AIèƒ½åŠ›å®Œç¾åŒ¹é… â­â­â­â­â­
- **å¤šæ¨¡æ€æ”¯æŒ**: è¯­éŸ³ã€å›¾åƒã€æ–‡æœ¬
- **å®æ—¶äº¤äº’**: WebSocketè¿æ¥ã€æµå¼å“åº”
- **ç¦»çº¿èƒ½åŠ›**: PWAç¼“å­˜ã€æœ¬åœ°AIæ¨ç†

#### 3. å¼€å‘æ•ˆç‡æœ€ä¼˜ â­â­â­â­â­
- **ä»£ç å¤ç”¨**: Webç«¯ä»£ç 95%å¯å¤ç”¨
- **å›¢é˜Ÿæ•ˆç‡**: å•ä¸€æŠ€æœ¯æ ˆï¼Œæ— å­¦ä¹ æˆæœ¬
- **è°ƒè¯•ä½“éªŒ**: çƒ­é‡è½½ã€Chrome DevTools

#### 4. éƒ¨ç½²ç®€åŒ– â­â­â­â­â­
- **ä¸€æ¬¡æ„å»ºå¤šç«¯å‘å¸ƒ**: Webã€iOSã€Android
- **CI/CDå‹å¥½**: ç»Ÿä¸€æ„å»ºæµç¨‹
- **ç‰ˆæœ¬åŒæ­¥**: ç¡®ä¿å¤šç«¯åŠŸèƒ½ä¸€è‡´

---

## ğŸ“‹ è¯¦ç»†å®æ–½è®¡åˆ’

### Phase 1: åŸºç¡€æ¶æ„æ­å»º (ç¬¬1-3å‘¨)

#### Week 1: ç¯å¢ƒå‡†å¤‡ä¸é¡¹ç›®åˆå§‹åŒ–

**å¼€å‘ç¯å¢ƒè®¾ç½®**:
```bash
# 1. å®‰è£…Quasar CLI
npm install -g @quasar/cli

# 2. åˆ›å»ºç§»åŠ¨ç«¯é¡¹ç›®
quasar create moqui-ai-mobile
cd moqui-ai-mobile

# 3. æ·»åŠ ç§»åŠ¨ç«¯æ”¯æŒ
quasar mode add capacitor
quasar mode add pwa

# 4. å®‰è£…ç§»åŠ¨ç«¯ä¾èµ–
npm install @capacitor/camera @capacitor/microphone @capacitor/device
npm install @capacitor/push-notifications @capacitor/local-notifications
```

**é¡¹ç›®ç»“æ„åˆå§‹åŒ–**:
```
moqui-ai-mobile/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ ai/              # AIåŠŸèƒ½ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ business/        # ä¸šåŠ¡ç»„ä»¶
â”‚   â”‚   â””â”€â”€ shared/          # å…±äº«ç»„ä»¶
â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â”œâ”€â”€ auth/            # è®¤è¯é¡µé¢
â”‚   â”‚   â”œâ”€â”€ hivemind/        # é¡¹ç›®ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ commerce/        # ç”µå•†
â”‚   â”‚   â”œâ”€â”€ manufacturing/   # ERPåˆ¶é€ 
â”‚   â”‚   â””â”€â”€ marketplace/     # ä¾›éœ€åŒ¹é…
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ api/             # APIæœåŠ¡
â”‚   â”‚   â”œâ”€â”€ ai/              # AIåŠŸèƒ½æœåŠ¡
â”‚   â”‚   â””â”€â”€ auth/            # è®¤è¯æœåŠ¡
â”‚   â”œâ”€â”€ stores/              # PiniaçŠ¶æ€ç®¡ç†
â”‚   â””â”€â”€ router/              # è·¯ç”±é…ç½®
â”œâ”€â”€ src-capacitor/           # ç§»åŠ¨ç«¯é…ç½®
â””â”€â”€ src-pwa/                # PWAé…ç½®
```

#### Week 2: APIæœåŠ¡å±‚æ¶æ„è®¾è®¡

**ç»Ÿä¸€APIæœåŠ¡åŸºç±»**:
```javascript
// src/services/api/base.js
import { api } from 'boot/axios'
import { useAuthStore } from 'stores/auth'

export class BaseApiService {
  constructor(baseURL = process.env.MOQUI_API_URL || 'http://localhost:8080') {
    this.api = api
    this.baseURL = baseURL
    this.setupInterceptors()
  }

  setupInterceptors() {
    // è¯·æ±‚æ‹¦æˆª - JWT Tokenè‡ªåŠ¨æ³¨å…¥
    this.api.interceptors.request.use(config => {
      const authStore = useAuthStore()
      if (authStore.accessToken) {
        config.headers.Authorization = `Bearer ${authStore.accessToken}`
      }
      return config
    }, error => {
      return Promise.reject(error)
    })

    // å“åº”æ‹¦æˆª - é”™è¯¯å¤„ç†
    this.api.interceptors.response.use(
      response => response,
      async error => {
        if (error.response?.status === 401) {
          const authStore = useAuthStore()
          await authStore.refreshToken()
        }
        return Promise.reject(error)
      }
    )
  }

  // é€šç”¨è¯·æ±‚æ–¹æ³•
  async request(method, endpoint, data = null, config = {}) {
    try {
      const response = await this.api[method](endpoint, data, config)
      return response.data
    } catch (error) {
      console.error(`API ${method.toUpperCase()} ${endpoint} failed:`, error)
      throw error
    }
  }
}
```

**MCP AIæœåŠ¡é›†æˆ**:
```javascript
// src/services/ai/mcpService.js
import { BaseApiService } from '../api/base'

export class McpAiService extends BaseApiService {
  constructor() {
    super()
    this.endpoints = {
      transcribe: '/rest/s1/mcp/transcribe/Audio',
      analyze: '/rest/s1/mcp/analyze/Image',
      recommend: '/rest/s1/marketplace/process/AllMatching',
      chat: '/rest/s1/mcp/chat/Complete'
    }
  }

  // è¯­éŸ³è½¬æ–‡å­—
  async transcribeAudio(audioBlob, options = {}) {
    const formData = new FormData()
    formData.append('audio', audioBlob, 'recording.wav')

    if (options.language) {
      formData.append('language', options.language)
    }

    return await this.request('post', this.endpoints.transcribe, formData, {
      headers: { 'Content-Type': 'multipart/form-data' }
    })
  }

  // å›¾åƒè¯†åˆ«
  async analyzeImage(imageBlob, analysisType = 'product') {
    const formData = new FormData()
    formData.append('image', imageBlob, 'image.jpg')
    formData.append('analysisType', analysisType)

    return await this.request('post', this.endpoints.analyze, formData, {
      headers: { 'Content-Type': 'multipart/form-data' }
    })
  }

  // æ™ºèƒ½æ¨è
  async getRecommendations(context, options = {}) {
    return await this.request('post', this.endpoints.recommend, {
      context,
      minScore: options.minScore || 0.6,
      maxResults: options.maxResults || 10
    })
  }

  // AIå¯¹è¯
  async chatComplete(messages, systemPrompt = '') {
    return await this.request('post', this.endpoints.chat, {
      messages,
      systemPrompt
    })
  }
}

export const mcpAiService = new McpAiService()
```

#### Week 3: è®¤è¯ç³»ç»Ÿé›†æˆ

**JWTè®¤è¯æœåŠ¡**:
```javascript
// src/stores/auth.js
import { defineStore } from 'pinia'
import { api } from 'boot/axios'

export const useAuthStore = defineStore('auth', {
  state: () => ({
    accessToken: localStorage.getItem('jwt_access_token') || '',
    refreshToken: localStorage.getItem('jwt_refresh_token') || '',
    user: null,
    isAuthenticated: false
  }),

  getters: {
    isLoggedIn: (state) => !!state.accessToken && state.isAuthenticated
  },

  actions: {
    // ç™»å½•
    async login(credentials) {
      try {
        const response = await api.post('/rest/s1/moqui/auth/login', credentials)

        if (response.data.success) {
          this.accessToken = response.data.accessToken
          this.refreshToken = response.data.refreshToken
          this.user = response.data.user
          this.isAuthenticated = true

          // æŒä¹…åŒ–å­˜å‚¨
          localStorage.setItem('jwt_access_token', this.accessToken)
          localStorage.setItem('jwt_refresh_token', this.refreshToken)

          return { success: true }
        }
      } catch (error) {
        console.error('Login failed:', error)
        return { success: false, error: error.message }
      }
    },

    // åˆ·æ–°Token
    async refreshToken() {
      if (!this.refreshToken) return false

      try {
        const response = await api.post('/rest/s1/moqui/auth/refresh', {
          refreshToken: this.refreshToken
        })

        if (response.data.success) {
          this.accessToken = response.data.accessToken
          localStorage.setItem('jwt_access_token', this.accessToken)
          return true
        }
      } catch (error) {
        console.error('Token refresh failed:', error)
        this.logout()
      }
      return false
    },

    // ç™»å‡º
    logout() {
      this.accessToken = ''
      this.refreshToken = ''
      this.user = null
      this.isAuthenticated = false

      localStorage.removeItem('jwt_access_token')
      localStorage.removeItem('jwt_refresh_token')
    }
  }
})
```

### Phase 2: AIåŠŸèƒ½ç»„ä»¶å¼€å‘ (ç¬¬4-7å‘¨)

#### Week 4-5: è¯­éŸ³äº¤äº’ç»„ä»¶

**æ™ºèƒ½è¯­éŸ³åŠ©æ‰‹ç»„ä»¶**:
```vue
<!-- src/components/ai/VoiceAssistant.vue -->
<template>
  <q-page class="voice-assistant column items-center justify-center">
    <!-- è¯­éŸ³æ³¢å½¢åŠ¨ç”» -->
    <div class="voice-animation-container">
      <q-circular-progress
        v-if="isRecording"
        :value="audioLevel * 100"
        size="200px"
        :thickness="0.1"
        color="primary"
        track-color="grey-3"
        class="voice-animation">
        <q-icon name="mic" size="60px" color="primary"/>
      </q-circular-progress>

      <q-btn
        v-else
        @touchstart="startRecording"
        @touchend="stopRecording"
        @mousedown="startRecording"
        @mouseup="stopRecording"
        round size="xl"
        color="primary"
        icon="mic"
        class="voice-button">
        <q-tooltip>æŒ‰ä½è¯´è¯</q-tooltip>
      </q-btn>
    </div>

    <!-- å½•éŸ³çŠ¶æ€ -->
    <div class="text-center q-mt-md">
      <div v-if="isRecording" class="text-h6 text-primary">
        {{ $t('æ­£åœ¨è†å¬...') }}
      </div>
      <div v-else-if="isProcessing" class="text-h6 text-orange">
        {{ $t('AIæ­£åœ¨æ€è€ƒ...') }}
      </div>
      <div v-else class="text-body1 text-grey-6">
        {{ $t('æŒ‰ä½æŒ‰é’®å¼€å§‹è¯­éŸ³å¯¹è¯') }}
      </div>
    </div>

    <!-- å¯¹è¯å†å² -->
    <q-scroll-area
      v-if="conversation.length > 0"
      class="conversation-area q-mt-lg"
      style="height: 300px; width: 100%">

      <q-chat-message
        v-for="(message, index) in conversation"
        :key="index"
        :text="[message.text]"
        :sent="message.type === 'user'"
        :bg-color="message.type === 'user' ? 'primary' : 'grey-3'"
        :text-color="message.type === 'user' ? 'white' : 'black'">
      </q-chat-message>
    </q-scroll-area>

    <!-- å¿«æ·æ“ä½œ -->
    <div class="quick-actions q-mt-md">
      <q-btn
        v-for="action in quickActions"
        :key="action.id"
        @click="handleQuickAction(action)"
        :label="action.label"
        color="secondary"
        outline
        class="q-mr-sm">
      </q-btn>
    </div>
  </q-page>
</template>

<script>
import { ref, onMounted, onUnmounted } from 'vue'
import { Microphone } from '@capacitor/microphone'
import { mcpAiService } from 'src/services/ai/mcpService'

export default {
  name: 'VoiceAssistant',
  setup() {
    const isRecording = ref(false)
    const isProcessing = ref(false)
    const audioLevel = ref(0)
    const conversation = ref([])

    const quickActions = ref([
      { id: 'project_status', label: 'é¡¹ç›®çŠ¶æ€', prompt: 'æŸ¥è¯¢æˆ‘çš„é¡¹ç›®è¿›åº¦' },
      { id: 'daily_tasks', label: 'ä»Šæ—¥ä»»åŠ¡', prompt: 'æ˜¾ç¤ºä»Šå¤©çš„å¾…åŠäº‹é¡¹' },
      { id: 'market_update', label: 'å¸‚åœºåŠ¨æ€', prompt: 'æœ€æ–°çš„å¸‚åœºä¿¡æ¯' }
    ])

    let mediaRecorder = null
    let audioChunks = []

    // å¼€å§‹å½•éŸ³
    const startRecording = async () => {
      try {
        // è¯·æ±‚éº¦å…‹é£æƒé™
        await Microphone.requestPermissions()

        const stream = await navigator.mediaDevices.getUserMedia({ audio: true })
        mediaRecorder = new MediaRecorder(stream)
        audioChunks = []

        mediaRecorder.ondataavailable = (event) => {
          audioChunks.push(event.data)
        }

        mediaRecorder.onstop = processRecording

        mediaRecorder.start()
        isRecording.value = true

        // éŸ³é¢‘çº§åˆ«æ£€æµ‹
        const audioContext = new AudioContext()
        const analyser = audioContext.createAnalyser()
        const microphone = audioContext.createMediaStreamSource(stream)
        microphone.connect(analyser)

        const dataArray = new Uint8Array(analyser.frequencyBinCount)
        const updateAudioLevel = () => {
          if (isRecording.value) {
            analyser.getByteFrequencyData(dataArray)
            const average = dataArray.reduce((a, b) => a + b) / dataArray.length
            audioLevel.value = average / 255
            requestAnimationFrame(updateAudioLevel)
          }
        }
        updateAudioLevel()

      } catch (error) {
        console.error('å½•éŸ³å¯åŠ¨å¤±è´¥:', error)
      }
    }

    // åœæ­¢å½•éŸ³
    const stopRecording = () => {
      if (mediaRecorder && mediaRecorder.state === 'recording') {
        mediaRecorder.stop()
        isRecording.value = false
      }
    }

    // å¤„ç†å½•éŸ³
    const processRecording = async () => {
      if (audioChunks.length === 0) return

      isProcessing.value = true

      try {
        const audioBlob = new Blob(audioChunks, { type: 'audio/wav' })

        // è¯­éŸ³è½¬æ–‡å­—
        const transcriptionResult = await mcpAiService.transcribeAudio(audioBlob, {
          language: 'zh-cn'
        })

        if (transcriptionResult.success) {
          const userMessage = {
            type: 'user',
            text: transcriptionResult.transcription,
            timestamp: new Date()
          }
          conversation.value.push(userMessage)

          // AIå¯¹è¯
          const chatResult = await mcpAiService.chatComplete([
            ...conversation.value.map(msg => ({
              role: msg.type === 'user' ? 'user' : 'assistant',
              content: msg.text
            }))
          ], getSystemPrompt())

          if (chatResult.success) {
            const aiMessage = {
              type: 'assistant',
              text: chatResult.response,
              timestamp: new Date()
            }
            conversation.value.push(aiMessage)
          }
        }

      } catch (error) {
        console.error('è¯­éŸ³å¤„ç†å¤±è´¥:', error)
      } finally {
        isProcessing.value = false
      }
    }

    // å¿«æ·æ“ä½œå¤„ç†
    const handleQuickAction = async (action) => {
      const userMessage = {
        type: 'user',
        text: action.prompt,
        timestamp: new Date()
      }
      conversation.value.push(userMessage)

      // å¤„ç†é¢„å®šä¹‰æ“ä½œ
      await processQuickAction(action)
    }

    // è·å–ç³»ç»Ÿæç¤º
    const getSystemPrompt = () => {
      return `ä½ æ˜¯Moqui AIåŠ©æ‰‹ï¼Œä¸“é—¨å¸®åŠ©ç”¨æˆ·ç®¡ç†é¡¹ç›®ã€ç”µå•†ä¸šåŠ¡å’Œç”Ÿäº§åˆ¶é€ ã€‚
              è¯·ç”¨ç®€æ´ã€å‹å¥½çš„è¯­è¨€å›ç­”ç”¨æˆ·é—®é¢˜ï¼Œå¹¶ä¸»åŠ¨æä¾›ç›¸å…³å»ºè®®ã€‚
              å½“ç”¨æˆ·è¯¢é—®å…·ä½“æ•°æ®æ—¶ï¼Œè¯·è°ƒç”¨ç›¸åº”çš„APIè·å–å®æ—¶ä¿¡æ¯ã€‚`
    }

    return {
      isRecording,
      isProcessing,
      audioLevel,
      conversation,
      quickActions,
      startRecording,
      stopRecording,
      handleQuickAction
    }
  }
}
</script>

<style scoped>
.voice-assistant {
  padding: 20px;
  min-height: 100vh;
}

.voice-animation-container {
  display: flex;
  align-items: center;
  justify-content: center;
  height: 250px;
}

.voice-button {
  transition: transform 0.2s ease;
}

.voice-button:active {
  transform: scale(1.1);
}

.conversation-area {
  width: 100%;
  padding: 0 16px;
}

.quick-actions {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 8px;
}
</style>
```

#### Week 6-7: å›¾åƒè¯†åˆ«ç»„ä»¶

**æ™ºèƒ½å›¾åƒåˆ†æç»„ä»¶**:
```vue
<!-- src/components/ai/ImageAnalyzer.vue -->
<template>
  <q-page class="image-analyzer">
    <!-- ç›¸æœºé¢„è§ˆåŒºåŸŸ -->
    <div class="camera-section">
      <div v-if="!capturedImage" class="camera-placeholder">
        <q-icon name="photo_camera" size="100px" color="grey-5"/>
        <div class="text-h6 q-mt-md text-grey-6">
          æ‹ç…§æˆ–é€‰æ‹©å›¾ç‰‡è¿›è¡ŒAIåˆ†æ
        </div>
      </div>

      <q-img
        v-else
        :src="capturedImage"
        class="captured-image"
        fit="contain">
        <div class="absolute-bottom bg-transparent">
          <q-btn
            @click="clearImage"
            round
            color="negative"
            icon="delete"
            class="q-ma-sm">
          </q-btn>
        </div>
      </q-img>
    </div>

    <!-- æ“ä½œæŒ‰é’® -->
    <div class="action-buttons q-pa-md">
      <q-btn-group spread>
        <q-btn
          @click="capturePhoto"
          color="primary"
          icon="photo_camera"
          label="æ‹ç…§"
          :disable="isAnalyzing">
        </q-btn>

        <q-btn
          @click="selectFromGallery"
          color="secondary"
          icon="photo_library"
          label="ç›¸å†Œ"
          :disable="isAnalyzing">
        </q-btn>

        <q-btn
          @click="analyzeImage"
          color="positive"
          icon="smart_toy"
          label="AIåˆ†æ"
          :disable="!capturedImage || isAnalyzing"
          :loading="isAnalyzing">
        </q-btn>
      </q-btn-group>
    </div>

    <!-- åˆ†æç»“æœ -->
    <q-card v-if="analysisResult" class="analysis-result q-ma-md">
      <q-card-section>
        <div class="text-h6 text-primary">
          <q-icon name="psychology" class="q-mr-sm"/>
          AIåˆ†æç»“æœ
        </div>
      </q-card-section>

      <q-separator/>

      <q-card-section>
        <!-- ä¸»è¦è¯†åˆ«å†…å®¹ -->
        <div class="analysis-main q-mb-md">
          <div class="text-subtitle1 text-weight-bold q-mb-xs">
            è¯†åˆ«å†…å®¹
          </div>
          <div class="text-body1">
            {{ analysisResult.description }}
          </div>
        </div>

        <!-- ç½®ä¿¡åº¦ -->
        <div class="confidence-section q-mb-md">
          <div class="text-subtitle1 text-weight-bold q-mb-xs">
            è¯†åˆ«ç½®ä¿¡åº¦
          </div>
          <q-linear-progress
            :value="analysisResult.confidence"
            color="positive"
            size="20px"
            class="q-mb-xs">
            <div class="absolute-full flex flex-center">
              <q-badge color="white" text-color="primary"
                       :label="`${Math.round(analysisResult.confidence * 100)}%`"/>
            </div>
          </q-linear-progress>
        </div>

        <!-- æå–çš„æ ‡ç­¾ -->
        <div class="tags-section q-mb-md">
          <div class="text-subtitle1 text-weight-bold q-mb-xs">
            å…³é”®æ ‡ç­¾
          </div>
          <div class="tags-container">
            <q-chip
              v-for="tag in analysisResult.tags"
              :key="tag.name"
              :color="getTagColor(tag.confidence)"
              text-color="white"
              :icon="getTagIcon(tag.category)">
              {{ tag.name }}
              <q-tooltip>ç½®ä¿¡åº¦: {{ Math.round(tag.confidence * 100) }}%</q-tooltip>
            </q-chip>
          </div>
        </div>
      </q-card-section>
    </q-card>

    <!-- æ–‡ä»¶é€‰æ‹©å™¨ -->
    <input
      ref="fileInput"
      type="file"
      accept="image/*"
      style="display: none"
      @change="handleFileSelect">
  </q-page>
</template>

<script>
import { ref } from 'vue'
import { Camera, CameraResultType, CameraSource } from '@capacitor/camera'
import { mcpAiService } from 'src/services/ai/mcpService'
import { useQuasar } from 'quasar'

export default {
  name: 'ImageAnalyzer',
  setup() {
    const $q = useQuasar()
    const capturedImage = ref('')
    const isAnalyzing = ref(false)
    const analysisResult = ref(null)
    const fileInput = ref(null)

    // æ‹ç…§
    const capturePhoto = async () => {
      try {
        const image = await Camera.getPhoto({
          quality: 90,
          allowEditing: true,
          resultType: CameraResultType.DataUrl,
          source: CameraSource.Camera
        })

        capturedImage.value = image.dataUrl

      } catch (error) {
        console.error('æ‹ç…§å¤±è´¥:', error)
        $q.notify({
          type: 'negative',
          message: 'æ‹ç…§å¤±è´¥ï¼Œè¯·é‡è¯•'
        })
      }
    }

    // ä»ç›¸å†Œé€‰æ‹©
    const selectFromGallery = () => {
      fileInput.value?.click()
    }

    // å¤„ç†æ–‡ä»¶é€‰æ‹©
    const handleFileSelect = (event) => {
      const file = event.target.files?.[0]
      if (file) {
        const reader = new FileReader()
        reader.onload = (e) => {
          capturedImage.value = e.target?.result
        }
        reader.readAsDataURL(file)
      }
    }

    // æ¸…é™¤å›¾ç‰‡
    const clearImage = () => {
      capturedImage.value = ''
      analysisResult.value = null
    }

    // AIå›¾åƒåˆ†æ
    const analyzeImage = async () => {
      if (!capturedImage.value) return

      isAnalyzing.value = true

      try {
        // å°†DataURLè½¬æ¢ä¸ºBlob
        const response = await fetch(capturedImage.value)
        const blob = await response.blob()

        // è°ƒç”¨AIåˆ†ææœåŠ¡
        const result = await mcpAiService.analyzeImage(blob, 'comprehensive')

        if (result.success) {
          analysisResult.value = {
            description: result.description,
            confidence: result.confidence,
            tags: result.tags || [],
            timestamp: new Date()
          }

          $q.notify({
            type: 'positive',
            message: 'AIåˆ†æå®Œæˆ'
          })

        } else {
          throw new Error(result.error || 'åˆ†æå¤±è´¥')
        }

      } catch (error) {
        console.error('å›¾åƒåˆ†æå¤±è´¥:', error)
        $q.notify({
          type: 'negative',
          message: 'åˆ†æå¤±è´¥ï¼Œè¯·é‡è¯•'
        })
      } finally {
        isAnalyzing.value = false
      }
    }

    // è·å–æ ‡ç­¾é¢œè‰²
    const getTagColor = (confidence) => {
      if (confidence > 0.8) return 'positive'
      if (confidence > 0.6) return 'warning'
      return 'info'
    }

    // è·å–æ ‡ç­¾å›¾æ ‡
    const getTagIcon = (category) => {
      const iconMap = {
        product: 'shopping_bag',
        equipment: 'precision_manufacturing',
        material: 'category',
        person: 'person',
        default: 'label'
      }
      return iconMap[category] || iconMap.default
    }

    return {
      capturedImage,
      isAnalyzing,
      analysisResult,
      fileInput,
      capturePhoto,
      selectFromGallery,
      handleFileSelect,
      clearImage,
      analyzeImage,
      getTagColor,
      getTagIcon
    }
  }
}
</script>

<style scoped>
.image-analyzer {
  min-height: 100vh;
}

.camera-section {
  height: 300px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: #f5f5f5;
  margin: 16px;
  border-radius: 8px;
}

.camera-placeholder {
  text-align: center;
  color: #999;
}

.captured-image {
  max-height: 300px;
  border-radius: 8px;
}

.analysis-result {
  max-height: 60vh;
  overflow-y: auto;
}

.tags-container {
  display: flex;
  flex-wrap: wrap;
  gap: 4px;
}

.action-buttons {
  position: sticky;
  bottom: 0;
  background: white;
  z-index: 1;
}
</style>
```

### Phase 3: ä¸šåŠ¡æ¨¡å—å¼€å‘ (ç¬¬8-12å‘¨)

#### Week 8-9: ç»Ÿä¸€ä¸šåŠ¡æ¨¡å—æ¶æ„

**ç»Ÿä¸€çš„APIæœåŠ¡å±‚**:
```javascript
// src/services/moquiApi.js
import { BaseApiService } from './api/base'

export class MoquiApiService extends BaseApiService {
  constructor() {
    super()
    this.setupBusinessAPIs()
  }

  setupBusinessAPIs() {
    // HiveMindé¡¹ç›®ç®¡ç†API
    this.project = {
      list: () => this.request('get', '/rest/s1/hivemind/projects'),
      create: (data) => this.request('post', '/rest/s1/hivemind/project', data),
      tasks: (projectId) => this.request('get', `/rest/s1/hivemind/project/${projectId}/tasks`)
    }

    // PopCommerceç”µå•†API
    this.commerce = {
      products: () => this.request('get', '/rest/s1/commerce/products'),
      orders: () => this.request('get', '/rest/s1/commerce/orders'),
      recommend: (userId) => this.request('get', `/rest/s1/commerce/recommend/${userId}`)
    }

    // MarbleERPåˆ¶é€ API
    this.erp = {
      inventory: () => this.request('get', '/rest/s1/erp/inventory'),
      production: () => this.request('get', '/rest/s1/erp/production'),
      schedule: (data) => this.request('post', '/rest/s1/erp/optimize-schedule', data)
    }

    // Marketplaceä¾›éœ€åŒ¹é…API
    this.marketplace = {
      messages: () => this.request('get', '/rest/s1/marketplace/listing'),
      publish: (data) => this.request('post', '/rest/s1/marketplace/supply', data),
      match: (context) => this.request('post', '/rest/s1/marketplace/process/AllMatching', context)
    }
  }
}

export const moquiApi = new MoquiApiService()
```

---

## ğŸ’° æˆæœ¬æ•ˆç›Šåˆ†æ

### å¼€å‘æˆæœ¬å¯¹æ¯”

| æ–¹æ¡ˆ | å­¦ä¹ æˆæœ¬ | å¼€å‘æ—¶é—´ | ç»´æŠ¤æˆæœ¬ | æŠ€æœ¯é£é™© |
|------|----------|----------|----------|----------|
| **Quasar** | â­ | 12å‘¨ | â­ | â­ |
| React Native | â­â­â­ | 16å‘¨ | â­â­ | â­â­ |
| Flutter | â­â­â­â­ | 20å‘¨ | â­â­â­ | â­â­â­ |

### ROIé¢„æœŸ
- **å¼€å‘æ•ˆç‡**: æå‡60% (ä»£ç å¤ç”¨)
- **ç»´æŠ¤æˆæœ¬**: é™ä½40% (ç»Ÿä¸€æŠ€æœ¯æ ˆ)
- **ä¸Šå¸‚æ—¶é—´**: åŠ å¿«3ä¸ªæœˆ (æ— å­¦ä¹ æˆæœ¬)

---

## ğŸ¯ ç«‹å³å®æ–½æ­¥éª¤

### ç¬¬ä¸€æ­¥ï¼šç¯å¢ƒæ­å»º (æœ¬å‘¨)
```bash
# 1. å®‰è£…Quasar CLI
npm install -g @quasar/cli

# 2. åˆ›å»ºé¡¹ç›®
quasar create moqui-ai-mobile

# 3. æ·»åŠ ç§»åŠ¨ç«¯æ”¯æŒ
cd moqui-ai-mobile
quasar mode add capacitor
quasar mode add pwa
```

### ç¬¬äºŒæ­¥ï¼šAPIé›†æˆæµ‹è¯• (ä¸‹å‘¨)
- åˆ›å»ºJWTè®¤è¯æœåŠ¡
- æµ‹è¯•ä¸Moquiåç«¯APIè¿æ¥
- éªŒè¯MCP AIæœåŠ¡è°ƒç”¨

### ç¬¬ä¸‰æ­¥ï¼šæ ¸å¿ƒåŠŸèƒ½å¼€å‘ (3-4å‘¨)
- è¯­éŸ³äº¤äº’ç»„ä»¶
- å›¾åƒè¯†åˆ«ç»„ä»¶
- ä¸šåŠ¡æ¨¡å—é€æ­¥å¼€å‘

### æˆåŠŸæŒ‡æ ‡
- âœ… **æ€§èƒ½**: åº”ç”¨å¯åŠ¨æ—¶é—´ < 2ç§’
- âœ… **ä½“éªŒ**: AIåŠŸèƒ½å“åº”æ—¶é—´ < 3ç§’
- âœ… **å…¼å®¹**: iOS 12+ã€Android 8+æ”¯æŒ
- âœ… **åŠŸèƒ½**: è¯­éŸ³ã€å›¾åƒã€æ¨èAIåŠŸèƒ½å®Œæ•´

---

## ğŸ‰ å®æ–½ç°çŠ¶

### âœ… å·²å®Œæˆé¡¹ç›®
**å½“å‰é¡¹ç›®**: `frontend/moqui-ai-mobile/`
- âœ… **å®Œæ•´çš„Vue3 + Quasar + TypeScriptæ¶æ„**
- âœ… **ä¾›éœ€åŒ¹é…ç³»ç»Ÿå®Œæ•´å®ç°**
- âœ… **AIæ™ºèƒ½åŒ¹é…ç®—æ³•é›†æˆ**
- âœ… **å“åº”å¼ç§»åŠ¨ç«¯è®¾è®¡**
- âœ… **JWTè®¤è¯ç³»ç»Ÿé›†æˆ**

### ğŸš€ è¿è¡ŒçŠ¶æ€
- **å¼€å‘æœåŠ¡å™¨**: http://localhost:5173/
- **ä¸»è¦åŠŸèƒ½é¡µé¢**: http://localhost:5173/marketplace
- **æŠ€æœ¯æ ˆ**: Vue 3.5 + Quasar + TypeScript + Vite
- **åç«¯é›†æˆ**: ä¸Moqui Frameworkå®Œç¾å¯¹æ¥

### ğŸ“Š æŠ€æœ¯æˆæœ
- **ä»£ç å¤ç”¨ç‡**: 95%+ (ä¸ç°æœ‰Vue3æŠ€æœ¯æ ˆ)
- **å¼€å‘æ•ˆç‡**: å¤§å¹…æå‡ (ç»Ÿä¸€æŠ€æœ¯æ ˆ)
- **éƒ¨ç½²ç®€åŒ–**: ä¸€æ¬¡æ„å»ºå¤šç«¯å‘å¸ƒ
- **AIèƒ½åŠ›**: å®Œæ•´é›†æˆè¯­éŸ³ã€å›¾åƒã€æ–‡æœ¬å¤„ç†

---

**ç»“è®º**: Quasar Frameworkæ˜¯åŒ¹é…AIé©±åŠ¨Moquiåç«¯çš„æœ€ä½³å‰ç«¯APPæŠ€æœ¯é€‰æ‹©ï¼Œèƒ½å¤Ÿåœ¨æœ€çŸ­æ—¶é—´å†…ã€æœ€ä½æˆæœ¬ä¸‹å®ç°æœ€å¤§ä»·å€¼çš„ç§»åŠ¨ç«¯AIåº”ç”¨ã€‚å½“å‰é¡¹ç›®å·²æˆåŠŸéªŒè¯äº†è¿™ä¸€æ–¹æ¡ˆçš„å¯è¡Œæ€§å’Œä¼˜åŠ¿ã€‚