# 前端场景化集成测试 - 需求文档

## 简介

本文档定义了前端系统的场景化集成测试需求。前端系统包含两个主要应用：
1. **moqui-ai-mobile** - Vue3 + Quasar移动端应用
2. **NovelAnimeDesktop** - Electron桌面应用

场景化集成测试旨在验证真实用户场景下的端到端功能，确保各个模块在实际使用中能够正确协作。

## 术语表

- **场景化测试 (Scenario Testing)**: 基于真实用户使用场景的端到端测试
- **集成测试 (Integration Testing)**: 验证多个模块协同工作的测试
- **E2E测试 (End-to-End Testing)**: 从用户界面到后端API的完整流程测试
- **用户旅程 (User Journey)**: 用户完成特定目标的完整操作流程
- **测试夹具 (Test Fixture)**: 测试所需的预置数据和环境配置
- **Mock数据**: 模拟的测试数据
- **Stub服务**: 模拟的外部服务
- **测试覆盖率 (Test Coverage)**: 测试覆盖的代码比例

## 需求

### 需求 1: moqui-ai-mobile 核心场景测试

**用户故事**: 作为移动端用户，我希望系统能够在真实使用场景下正常工作，以便我能够顺利完成业务操作。

#### 验收标准

1. WHEN 用户访问应用首页 THEN 系统应显示订单大厅页面并加载最新订单列表
2. WHEN 用户未登录时访问需要认证的页面 THEN 系统应重定向到登录页面并保存原始目标路径
3. WHEN 用户输入正确的用户名和密码并点击登录 THEN 系统应成功认证并跳转到原始目标页面或默认首页
4. WHEN 用户登录后访问订单详情页面 THEN 系统应显示完整的订单信息包括标题、描述、联系方式和相关推荐
5. WHEN 用户在订单大厅使用搜索功能 THEN 系统应根据关键词筛选并显示匹配的订单列表

### 需求 2: 供需市场完整流程测试

**用户故事**: 作为供需市场用户，我希望能够完成从发布订单到接收匹配推荐的完整流程，以便找到合适的交易对象。

#### 验收标准

1. WHEN 用户点击发布订单按钮 THEN 系统应显示发布表单包含类型、标题、描述、分类、地区和联系方式字段
2. WHEN 用户填写完整的订单信息并提交 THEN 系统应调用AI标签提取服务并成功创建订单
3. WHEN 订单创建成功后 THEN 系统应自动触发智能匹配算法并返回匹配结果列表
4. WHEN 用户查看匹配结果 THEN 系统应显示匹配度评分和匹配原因说明
5. WHEN 用户点击联系按钮 THEN 系统应显示对方的联系方式包括电话和微信

### 需求 3: 认证和授权场景测试

**用户故事**: 作为系统管理员，我希望认证和授权机制能够正确工作，以便保护用户数据和系统安全。

#### 验收标准

1. WHEN 用户使用无效凭证登录 THEN 系统应显示错误提示并保持在登录页面
2. WHEN 用户成功登录后 THEN 系统应在localStorage中存储JWT token并设置认证状态
3. WHEN JWT token过期时 THEN 系统应自动刷新token或重定向到登录页面
4. WHEN 用户点击退出登录 THEN 系统应清除token和认证状态并重定向到登录页面
5. WHEN 未认证用户尝试访问受保护的API端点 THEN 系统应返回401错误并重定向到登录页面

### 需求 4: AI功能集成场景测试

**用户故事**: 作为使用AI功能的用户，我希望AI服务能够正确响应并返回有用的结果，以便提升我的工作效率。

#### 验收标准

1. WHEN 用户在发布订单时输入描述文本 THEN 系统应调用AI标签提取服务并返回相关标签列表
2. WHEN AI标签提取服务不可用时 THEN 系统应使用降级方案并显示友好的错误提示
3. WHEN 用户查看订单详情时 THEN 系统应调用智能匹配API并显示推荐的相关订单
4. WHEN 智能匹配返回结果时 THEN 系统应显示匹配度评分在0到100之间并提供匹配原因
5. WHEN AI服务响应时间超过5秒 THEN 系统应显示加载状态并允许用户取消操作

### 需求 5: NovelAnimeDesktop 核心场景测试

**用户故事**: 作为桌面应用用户，我希望能够完成从创建项目到导出作品的完整流程，以便生成我的小说动漫作品。

#### 验收标准

1. WHEN 用户启动应用 THEN 系统应在5秒内完成启动并显示项目列表页面
2. WHEN 用户创建新项目并输入项目名称 THEN 系统应创建项目并自动保存到本地数据库
3. WHEN 用户导入测试小说文件（test-novel.txt）THEN 系统应正确解析章节结构并显示在编辑器中
4. WHEN 用户在小说编辑器中输入文本 THEN 系统应实时更新字数统计并每30秒自动保存
5. WHEN 用户基于小说内容创建角色（如艾莉娅、马克等）THEN 系统应保存角色数据并在角色列表中显示
6. WHEN 用户在工作流编辑器中连接节点 THEN 系统应验证连接的有效性并保存工作流配置

### 需求 6: 工作流执行场景测试

**用户故事**: 作为使用工作流功能的用户，我希望工作流能够按照预期执行并生成正确的结果，以便自动化我的创作流程。

#### 验收标准

1. WHEN 用户点击执行工作流按钮 THEN 系统应验证工作流配置的完整性并开始执行
2. WHEN 工作流执行过程中 THEN 系统应实时更新每个节点的执行状态和进度
3. WHEN 工作流节点调用AI服务分析测试小说内容时 THEN 系统应正确传递小说文本并处理返回结果
4. WHEN 工作流基于测试小说生成角色分析时 THEN 系统应识别出主要角色（艾莉娅、马克、苏菲亚等）并生成角色描述
5. WHEN 工作流执行失败时 THEN 系统应显示详细的错误信息并允许用户重试或修改配置
6. WHEN 工作流执行完成时 THEN 系统应保存执行结果并允许用户预览和导出

### 需求 7: 跨模块数据流转场景测试

**用户故事**: 作为系统架构师，我希望验证不同模块之间的数据流转正确无误，以便确保系统的整体一致性。

#### 验收标准

1. WHEN 用户在项目管理模块创建项目 THEN 该项目应在小说编辑器和角色管理模块中可见
2. WHEN 用户在角色管理中创建角色 THEN 该角色应在工作流节点的角色选择器中可用
3. WHEN 用户在小说编辑器中编辑文本 THEN 工作流的文本分析节点应能够访问最新的文本内容
4. WHEN 用户在工作流中生成内容 THEN 生成的内容应正确保存到素材库并可在预览中查看
5. WHEN 用户导出项目时 THEN 系统应包含所有相关的项目数据、角色信息和生成的素材

### 需求 8: 性能和响应式场景测试

**用户故事**: 作为关注用户体验的产品经理，我希望系统在各种负载条件下都能保持良好的性能，以便提供流畅的用户体验。

#### 验收标准

1. WHEN 订单列表包含1000条以上记录时 THEN 系统应使用虚拟滚动技术并保持流畅的滚动体验
2. WHEN 用户在移动设备上访问应用 THEN 系统应正确适配屏幕尺寸并保持所有功能可用
3. WHEN 用户上传大于10MB的图片文件时 THEN 系统应显示上传进度并在合理时间内完成上传
4. WHEN 系统内存使用超过阈值时 THEN 系统应自动清理缓存并释放不必要的资源
5. WHEN 用户在弱网络环境下使用应用 THEN 系统应显示加载状态并在网络恢复后自动重试失败的请求

### 需求 9: 错误处理和恢复场景测试

**用户故事**: 作为系统用户，我希望在遇到错误时能够获得清晰的提示和恢复选项，以便继续完成我的工作。

#### 验收标准

1. WHEN 后端API返回500错误时 THEN 系统应显示友好的错误提示并提供重试选项
2. WHEN 网络连接中断时 THEN 系统应检测到离线状态并显示离线提示
3. WHEN 用户在编辑过程中应用崩溃 THEN 系统应在重启后恢复未保存的数据
4. WHEN AI服务调用失败时 THEN 系统应使用降级方案或提示用户稍后重试
5. WHEN 用户输入无效数据时 THEN 系统应在提交前进行验证并显示具体的错误信息

### 需求 10: 测试基础设施和工具

**用户故事**: 作为测试工程师，我希望有完善的测试基础设施和工具，以便高效地编写和执行场景化测试。

#### 验收标准

1. WHEN 测试框架初始化时 THEN 系统应自动配置测试环境包括测试数据库和Mock服务
2. WHEN 测试需要预置数据时 THEN 系统应提供测试夹具工具快速创建测试数据
3. WHEN 测试执行完成时 THEN 系统应生成详细的测试报告包括覆盖率和失败原因
4. WHEN 测试失败时 THEN 系统应保存失败时的截图和日志以便调试
5. WHEN 运行CI/CD流水线时 THEN 系统应自动执行所有场景化测试并报告结果
