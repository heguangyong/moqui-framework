# Requirements Document

## Introduction

This specification addresses a critical bug in the novel import workflow where the frontend uses an incorrect projectId when importing novels, causing the backend to reject the import with a "Project not found" error. The issue stems from a mismatch between the backend-generated projectId and a client-generated projectId being used in subsequent API calls.

## Glossary

- **Frontend**: The Novel Anime Desktop application (Vue.js-based Electron app)
- **Backend**: The Moqui-based REST API server
- **ProjectId**: A unique identifier for a project, generated by the backend database
- **Client_Generated_Id**: A temporary identifier created by the frontend's ProjectManager.js (format: project_{timestamp}_{random})
- **Novel_Import**: The process of uploading a novel text file and creating chapters/scenes from it
- **DashboardView**: The Vue component responsible for handling novel uploads
- **ProjectManager**: The frontend service that manages local project state
- **NovelAnimeRestServices**: The backend service that handles project creation and novel import

## Requirements

### Requirement 1: Correct ProjectId Usage

**User Story:** As a user, I want to import a novel into a newly created project, so that the system can process my novel without errors.

#### Acceptance Criteria

1. WHEN a user creates a new project via the backend API, THE Frontend SHALL store the backend-returned projectId
2. WHEN the frontend imports a novel, THE Frontend SHALL use the backend-returned projectId in the import API call
3. WHEN the backend receives a novel import request, THE Backend SHALL successfully find the project using the provided projectId
4. THE Frontend SHALL NOT generate or use client-side projectIds for backend API calls
5. THE Frontend SHALL NOT mix client-generated IDs with backend-generated IDs in the same workflow

### Requirement 2: Project Creation Flow

**User Story:** As a developer, I want a clear separation between local project management and backend project management, so that ID conflicts are prevented.

#### Acceptance Criteria

1. WHEN the backend creates a project, THE Backend SHALL return a unique projectId in the response
2. WHEN the frontend receives a project creation response, THE Frontend SHALL extract and store the projectId
3. THE Frontend SHALL use the backend projectId for all subsequent backend API calls related to that project
4. IF the frontend maintains local project state, THE Frontend SHALL map the backend projectId to any local identifiers separately

### Requirement 3: Error Prevention

**User Story:** As a user, I want the system to prevent ID mismatch errors, so that my novel import workflow completes successfully.

#### Acceptance Criteria

1. WHEN a novel import is initiated, THE Frontend SHALL validate that a valid backend projectId exists before making the API call
2. IF no valid backend projectId exists, THEN THE Frontend SHALL display an error message and prevent the import
3. WHEN the backend receives an invalid projectId, THE Backend SHALL return a clear error message indicating the project was not found
4. THE Frontend SHALL log the projectId being used for debugging purposes

### Requirement 4: State Synchronization

**User Story:** As a developer, I want the frontend and backend to maintain consistent project state, so that all operations use the correct identifiers.

#### Acceptance Criteria

1. WHEN a project is created via the backend, THE Frontend SHALL update its local state with the backend projectId
2. WHEN the frontend stores project information, THE Frontend SHALL include the backend projectId as the primary identifier
3. THE Frontend SHALL ensure that the projectId used in novel import matches the projectId from project creation
4. IF the frontend uses local storage, THE Frontend SHALL persist the backend projectId correctly

### Requirement 5: Workflow Integrity

**User Story:** As a user, I want the novel import workflow to complete end-to-end without interruption, so that I can start working with my imported novel immediately.

#### Acceptance Criteria

1. WHEN a user selects a novel file and clicks import, THE System SHALL create a project and import the novel in a single cohesive workflow
2. WHEN the project creation succeeds, THE Frontend SHALL immediately proceed to novel import using the correct projectId
3. WHEN the novel import succeeds, THE Frontend SHALL navigate to the project view with the correct project loaded
4. THE System SHALL maintain the projectId consistently throughout the entire workflow from creation to import to navigation
