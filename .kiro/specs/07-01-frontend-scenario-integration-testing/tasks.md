# 前端场景化集成测试 - 实施计划

## 实施概述

本实施计划将场景化集成测试系统分为多个阶段，从测试基础设施搭建开始，逐步实现各个功能模块的测试用例。

**重要说明**:
- ✅ 所有测试都使用真实的前后端交互，不使用Mock
- ✅ 所有测试资源（脚本、数据、报告）都在spec目录下（`.kiro/specs/07-01-frontend-scenario-integration-testing/testing/`）
- ✅ 采用人机配合模式，关键步骤需要人工确认
- ✅ 每个任务都引用了具体的需求条款，确保实施与需求的可追溯性

## 任务列表

- [ ] 1. 搭建测试基础设施
  - 在spec目录下创建testing目录结构
  - 配置Playwright测试框架
  - 创建测试夹具和工具函数
  - _Requirements: 10.1, 10.2_

- [ ] 1.1 创建testing目录结构
  - 在`.kiro/specs/07-01-frontend-scenario-integration-testing/`下创建`testing/`目录
  - 创建子目录：scenarios/, fixtures/, utils/, config/, reports/
  - 创建scenarios子目录：moqui-ai-mobile/, NovelAnimeDesktop/
  - _Requirements: 10.1_

- [ ] 1.2 配置Playwright测试框架
  - 在testing目录下初始化npm项目（package.json）
  - 安装Playwright及相关依赖
  - 创建playwright.config.ts配置文件
  - 配置测试浏览器、报告输出、截图和视频录制
  - _Requirements: 10.1_

- [ ] 1.3 创建测试环境配置
  - 创建testing/config/test-env.ts环境变量配置
  - 配置前端应用URL、后端API URL
  - 配置测试用户凭证和数据前缀
  - 配置超时设置和人工检查点超时
  - _Requirements: 10.1_

- [ ] 1.4 创建测试夹具系统
  - 安装@faker-js/faker数据生成库
  - 实现用户数据夹具（fixtures/user.fixture.ts）
  - 实现订单数据夹具（fixtures/order.fixture.ts）
  - 实现项目数据夹具（fixtures/project.fixture.ts）
  - 实现工作流数据夹具（fixtures/workflow.fixture.ts）
  - _Requirements: 10.2_

- [ ] 1.5 创建测试工具函数
  - 实现等待辅助函数（waitForElement, waitForAPIResponse）
  - 实现表单填写辅助函数（fillForm）
  - 实现截图辅助函数（takeScreenshot）
  - 实现人工检查点函数（manualCheckpoint）
  - 实现自定义断言函数（expectCurrentRoute, expectElementVisible等）
  - _Requirements: 10.2_

- [ ] 1.6 创建数据清理工具
  - 实现测试数据清理函数（cleanupTestData）
  - 实现测试前数据准备钩子
  - 实现测试后数据清理钩子
  - 配置失败测试的数据保留策略
  - _Requirements: 10.2_

- [ ] 2. 实现moqui-ai-mobile核心场景测试
  - 实现首页路由和数据加载测试
  - 实现认证和授权流程测试
  - 实现订单搜索和筛选测试
  - _Requirements: 1.1, 1.2, 1.3, 1.4, 1.5_

- [ ] 2.1 实现首页路由测试（Property 1）
  - 编写集成测试验证首页路由到订单大厅
  - 验证订单列表数据加载
  - 测试不同初始状态下的路由行为
  - **Property 1: 首页路由和数据加载一致性**
  - **Validates: Requirements 1.1**

- [ ] 2.2 实现未认证访问保护测试（Property 2）
  - 编写集成测试验证路由守卫
  - 测试未认证访问受保护路由的重定向
  - 验证原始目标路径的保存
  - 测试未认证访问受保护API的拒绝
  - **Property 2: 未认证访问保护**
  - **Validates: Requirements 1.2, 3.5**

- [ ] 2.3 实现登录流程测试（Property 3, 9, 10）
  - 编写E2E测试完整登录流程
  - 测试有效凭证登录和跳转
  - 测试无效凭证的错误处理
  - 测试登出流程和状态清理
  - 验证token存储和认证状态设置
  - **Property 3: 登录流程完整性**
  - **Property 9: 登录错误处理**
  - **Property 10: 登出流程完整性**
  - **Validates: Requirements 1.3, 3.1, 3.2, 3.4**

- [ ] 2.4 实现订单详情渲染测试（Property 4）
  - 编写集成测试验证订单详情页面
  - 测试所有必需字段的显示
  - 使用随机订单数据验证渲染完整性
  - **Property 4: 订单详情渲染完整性**
  - **Validates: Requirements 1.4**

- [ ] 2.5 实现搜索功能测试（Property 5）
  - 编写集成测试验证搜索功能
  - 测试关键词匹配逻辑
  - 验证搜索结果的准确性
  - 测试空搜索和无结果情况
  - **Property 5: 搜索结果准确性**
  - **Validates: Requirements 1.5**

- [ ] 3. 实现供需市场完整流程测试
  - 实现订单发布流程测试
  - 实现AI标签提取和智能匹配测试
  - 实现联系沟通功能测试
  - _Requirements: 2.1, 2.2, 2.3, 2.4, 2.5_

- [ ] 3.1 实现订单发布表单测试
  - 编写E2E测试验证发布表单显示
  - 测试表单包含所有必需字段
  - 验证表单验证逻辑
  - _Requirements: 2.1_

- [ ] 3.2 实现订单创建和AI集成流程测试（Property 6）
  - 编写E2E测试完整订单发布流程
  - 使用真实的AI标签提取服务
  - 验证订单创建成功（真实API调用）
  - 验证自动触发智能匹配（真实API调用）
  - 测试AI服务调用的参数传递
  - 添加人工检查点验证AI生成的标签质量
  - **Property 6: 订单创建和AI集成流程**
  - **Validates: Requirements 2.2, 2.3, 4.1**

- [ ] 3.3 实现匹配结果显示测试（Property 7, 12）
  - 编写集成测试验证匹配结果显示
  - 测试匹配度评分范围（0-100）
  - 验证匹配原因说明显示
  - 测试智能匹配API集成
  - **Property 7: 匹配结果显示完整性**
  - **Property 12: 智能匹配集成**
  - **Validates: Requirements 2.4, 4.3, 4.4**

- [ ] 3.4 实现联系信息显示测试（Property 8）
  - 编写集成测试验证联系功能
  - 测试联系方式的显示
  - 验证多种联系方式（电话、微信）
  - **Property 8: 联系信息显示**
  - **Validates: Requirements 2.5**

- [ ] 4. 实现AI功能集成测试
  - 实现AI服务调用测试
  - 实现AI服务降级测试
  - 实现AI服务超时处理测试
  - _Requirements: 4.1, 4.2, 4.3, 4.4, 4.5_

- [ ] 4.1 实现AI服务降级测试（Property 11）
  - 编写集成测试模拟AI服务失败（通过网络条件或后端配置）
  - 测试降级方案的触发
  - 验证友好错误提示的显示
  - 测试多种AI服务失败场景
  - **Property 11: AI服务降级处理**
  - **Validates: Requirements 4.2, 9.4**

- [ ] 4.2 实现AI服务超时处理测试
  - 编写集成测试模拟AI服务超时（通过网络延迟）
  - 测试加载状态显示
  - 验证取消操作功能
  - _Requirements: 4.5_

- [ ] 5. 实现NovelAnimeDesktop核心场景测试
  - 实现应用启动和项目管理测试
  - 实现编辑器功能测试
  - 实现角色管理测试
  - 实现工作流编辑测试
  - _Requirements: 5.1, 5.2, 5.3, 5.4, 5.5_

- [ ] 5.1 实现应用启动性能测试
  - 编写E2E测试验证应用启动
  - 测试启动时间（<5秒）
  - 验证项目列表页面显示
  - _Requirements: 5.1_

- [ ] 5.2 实现项目创建测试（Property 13）
  - 编写集成测试验证项目创建
  - 测试项目数据持久化
  - 验证项目在列表中显示
  - 使用随机项目名称测试
  - **Property 13: 项目创建和持久化**
  - **Validates: Requirements 5.2**

- [ ] 5.3 实现编辑器功能测试（Property 14）
  - 编写集成测试验证编辑器
  - 测试实时字数统计
  - 验证自动保存机制（30秒）
  - 测试文本输入和更新
  - **Property 14: 编辑器实时更新**
  - **Validates: Requirements 5.3**

- [ ] 5.4 实现角色管理测试（Property 15）
  - 编写集成测试验证角色创建
  - 测试角色数据持久化
  - 验证角色在列表中显示
  - 使用随机角色数据测试
  - **Property 15: 角色数据持久化**
  - **Validates: Requirements 5.4**

- [ ] 5.5 实现工作流连接验证测试（Property 16）
  - 编写集成测试验证节点连接
  - 测试连接有效性验证（类型匹配）
  - 测试循环依赖检测
  - 验证工作流配置保存
  - **Property 16: 工作流连接验证**
  - **Validates: Requirements 5.5**

- [ ] 6. 实现工作流执行场景测试
  - 实现工作流执行前验证测试
  - 实现工作流执行监控测试
  - 实现AI节点执行测试
  - 实现工作流错误处理测试
  - 实现工作流结果保存测试
  - _Requirements: 6.1, 6.2, 6.3, 6.4, 6.5_

- [ ] 6.1 实现工作流执行前验证测试（Property 17）
  - 编写集成测试验证工作流配置
  - 测试必需节点检查
  - 测试连接有效性验证
  - 验证不完整配置的拒绝
  - **Property 17: 工作流执行前验证**
  - **Validates: Requirements 6.1**

- [ ] 6.2 实现工作流执行状态同步测试（Property 18）
  - 编写集成测试验证执行监控
  - 测试节点状态实时更新
  - 测试进度信息显示
  - 验证执行过程的可观察性
  - **Property 18: 工作流执行状态同步**
  - **Validates: Requirements 6.2**

- [ ] 6.3 实现AI节点参数传递测试（Property 19）
  - 编写集成测试验证AI节点执行
  - 使用真实的AI服务调用
  - 测试参数正确传递
  - 验证返回结果处理
  - 添加人工检查点验证AI生成的内容质量
  - **Property 19: AI节点参数传递**
  - **Validates: Requirements 6.3**

- [ ] 6.4 实现工作流错误处理测试（Property 20）
  - 编写集成测试模拟执行失败
  - 测试错误信息显示
  - 验证重试选项
  - 测试修改配置功能
  - **Property 20: 工作流错误处理**
  - **Validates: Requirements 6.4**

- [ ] 6.5 实现工作流结果保存测试（Property 21）
  - 编写集成测试验证结果保存
  - 测试执行结果持久化
  - 验证预览功能
  - 测试导出功能
  - **Property 21: 工作流结果保存**
  - **Validates: Requirements 6.5**

- [ ] 7. 实现跨模块数据流转测试
  - 实现跨模块数据可见性测试
  - 实现工作流内容生成测试
  - 实现项目导出完整性测试
  - _Requirements: 7.1, 7.2, 7.3, 7.4, 7.5_

- [ ] 7.1 实现跨模块数据可见性测试（Property 22）
  - 编写集成测试验证数据流转
  - 测试项目在多个模块中可见
  - 测试角色在工作流中可用
  - 测试文本内容在工作流中可访问
  - **Property 22: 跨模块数据可见性**
  - **Validates: Requirements 7.1, 7.2, 7.3**

- [ ] 7.2 实现工作流内容生成测试（Property 23）
  - 编写集成测试验证内容生成
  - 测试生成内容保存到素材库
  - 验证内容在预览中可查看
  - **Property 23: 工作流内容生成和保存**
  - **Validates: Requirements 7.4**

- [ ] 7.3 实现项目导出完整性测试（Property 24）
  - 编写集成测试验证项目导出
  - 测试导出包含所有项目数据
  - 验证导出包含角色信息
  - 验证导出包含生成的素材
  - **Property 24: 项目导出完整性**
  - **Validates: Requirements 7.5**

- [ ] 8. 实现性能和响应式测试
  - 实现虚拟滚动性能测试
  - 实现响应式布局测试
  - 实现大文件上传测试
  - 实现内存管理测试
  - 实现弱网络环境测试
  - _Requirements: 8.1, 8.2, 8.3, 8.4, 8.5_

- [ ] 8.1 实现虚拟滚动性能测试
  - 编写性能测试验证大数据量渲染
  - 测试1000+条记录的滚动性能
  - 验证虚拟滚动技术的应用
  - 测试滚动流畅度
  - _Requirements: 8.1_

- [ ] 8.2 实现响应式布局测试（Property 25）
  - 编写E2E测试验证响应式设计
  - 测试多种屏幕尺寸（手机、平板、桌面）
  - 验证布局适配
  - 测试功能在不同尺寸下的可用性
  - **Property 25: 响应式布局适配**
  - **Validates: Requirements 8.2**

- [ ] 8.3 实现大文件上传测试
  - 编写集成测试验证文件上传
  - 测试10MB+图片上传
  - 验证上传进度显示
  - 测试上传完成时间
  - _Requirements: 8.3_

- [ ] 8.4 实现内存管理测试
  - 编写性能测试验证内存使用
  - 测试内存超过阈值时的清理
  - 验证缓存清理机制
  - 测试资源释放
  - _Requirements: 8.4_

- [ ] 8.5 实现弱网络环境测试
  - 编写集成测试模拟弱网络
  - 测试加载状态显示
  - 验证自动重试机制
  - 测试网络恢复后的请求重试
  - _Requirements: 8.5_

- [ ] 9. 实现错误处理和恢复测试
  - 实现API错误处理测试
  - 实现网络中断测试
  - 实现崩溃恢复测试
  - 实现输入验证测试
  - _Requirements: 9.1, 9.2, 9.3, 9.4, 9.5_

- [ ] 9.1 实现API错误处理测试（Property 26）
  - 编写集成测试模拟API错误（通过后端配置或网络条件）
  - 测试500错误的处理
  - 测试404错误的处理
  - 验证友好错误提示
  - 测试重试选项
  - **Property 26: API错误处理**
  - **Validates: Requirements 9.1**

- [ ] 9.2 实现网络中断测试
  - 编写集成测试模拟网络中断（通过浏览器网络条件）
  - 测试离线状态检测
  - 验证离线提示显示
  - 测试网络恢复后的行为
  - _Requirements: 9.2_

- [ ] 9.3 实现崩溃恢复测试
  - 编写E2E测试模拟应用崩溃
  - 测试未保存数据的恢复
  - 验证重启后的数据恢复
  - _Requirements: 9.3_

- [ ] 9.4 实现输入验证测试（Property 27）
  - 编写集成测试验证输入验证
  - 测试必填字段验证
  - 测试格式验证
  - 测试范围验证
  - 验证具体错误信息显示
  - 使用随机无效输入测试
  - **Property 27: 输入验证**
  - **Validates: Requirements 9.5**

- [ ] 10. 配置测试执行和报告
  - 创建测试执行脚本
  - 配置测试报告生成
  - 创建测试文档
  - _Requirements: 10.3, 10.5_

- [ ] 10.1 创建测试执行脚本
  - 创建testing/run-tests.sh执行脚本
  - 配置环境变量设置
  - 配置测试报告清理和生成
  - 添加测试执行的npm scripts
  - _Requirements: 10.5_

- [ ] 10.2 配置测试报告生成
  - 配置Playwright HTML报告
  - 配置JSON报告输出
  - 配置截图和视频保存
  - 创建报告查看说明
  - _Requirements: 10.3_

- [ ] 10.3 创建测试文档
  - 创建testing/README.md测试说明文档
  - 编写测试执行指南
  - 编写人工检查点操作指南
  - 编写测试数据管理指南
  - 编写故障排查指南
  - _Requirements: 10.3_

- [ ] 11. Checkpoint - 确保所有测试通过
  - 运行所有场景测试
  - 验证测试报告生成正确
  - 检查测试数据清理是否正常
  - 确保所有测试通过，询问用户是否有问题

## 实施注意事项

1. **真实环境**: 所有测试都在真实的开发/测试环境中执行，不使用Mock
2. **数据清理**: 每个测试后清理测试数据，避免污染数据库
3. **人工检查点**: 关键步骤需要人工确认，确保业务逻辑正确
4. **资源集中**: 所有测试资源都在spec目录下（`.kiro/specs/07-01-frontend-scenario-integration-testing/testing/`）
5. **可重现性**: 使用固定的随机种子，确保测试结果可重现
6. **性能考虑**: 避免过度的等待时间，使用合理的超时设置
7. **文档同步**: 测试代码应该包含清晰的注释，说明测试目的和验证点
8. **失败保留**: 测试失败时保留测试数据和截图，便于调试

## 预期成果

完成所有任务后，将实现：
- ✅ 完整的测试基础设施（在spec目录下）
- ✅ 27个Correctness Properties的测试实现
- ✅ 真实的前后端功能闭环验证
- ✅ 人机配合的测试执行模式
- ✅ 详细的测试报告和截图/视频
- ✅ 可维护和可扩展的测试代码库
- ✅ 完整的测试文档和操作指南
