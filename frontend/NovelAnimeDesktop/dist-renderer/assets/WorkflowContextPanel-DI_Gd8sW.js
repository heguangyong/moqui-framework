const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index-CMv62JsV.js","./api-BR07cdPl.js","./_plugin-vue_export-helper-BFgqyxDe.js","./runtime-core.esm-bundler-8-XbLWPr.js","./pinia-Be3yrKEl.js","./preload-helper-CmsKOCeN.js","./novelApi-CpaaRXu-.js"])))=>i.map(i=>d[i]);
import{_ as O}from"./preload-helper-CmsKOCeN.js";import{c as U,d as q,i as a,u as G,b as J,_ as K}from"./_plugin-vue_export-helper-BFgqyxDe.js";import{useWorkflowStore as Q}from"./workflowStore-BU4lfOfq.js";import{I as X,r as T,d as y,C as Y,j as l,k as o,l as n,s as _,F as I,z as b,x as m,p as f,u as v,v as C,y as r}from"./runtime-core.esm-bundler-8-XbLWPr.js";import"./pinia-Be3yrKEl.js";import"./api-BR07cdPl.js";import"./CharacterSystem-9i6-R3qi.js";const Z={class:"workflow-context-panel"},ee={class:"section section--workflows"},te={class:"section-items section-items--scrollable"},se=["onClick","title"],ne={class:"workflow-name"},oe={class:"item-badge"},le={class:"section"},ie={class:"section-items"},ae={key:0,class:"item-badge item-badge--highlight"},re={key:0,class:"item-badge"},ue={key:0,class:"item-badge"},ce={class:"section"},de={class:"section-items"},me=["onClick"],fe={class:"section section--executions"},ve={class:"section-items"},pe=["onClick"],ke={class:"execution-time"},we={key:1,class:"empty-hint"},x=5,S=12,ge=X({__name:"WorkflowContextPanel",setup(_e){const z=G(),F=J();U();const p=q(),k=Q();function w(){F.path!=="/workflow"&&z.push("/workflow")}const i=T(""),g=T(!1),u=y(()=>k.workflows.map(e=>({...e,count:e.nodes?.length||0}))),M=y(()=>g.value?u.value:u.value.slice(0,x));function E(e){return e?e.length<=S?e:e.substring(0,S)+"...":""}const c=y(()=>{const e={running:0,completed:0,failed:0};return u.value.forEach(t=>{t.status==="running"?e.running++:t.status==="completed"?e.completed++:(t.status==="error"||t.status==="failed")&&e.failed++}),e});Y(async()=>{await k.loadWorkflows(),await B(),console.log("ğŸ“‹ WorkflowContextPanel mounted, workflows:",k.workflows.length)});function N(e){console.log("ğŸ–±ï¸ Workflow clicked:",e.id,e.name),i.value=`workflow-${e.id}`,w();const t=k.selectWorkflow(e.id);console.log("ğŸ“Œ selectWorkflow result:",t),p.updatePanelContext("workflow",{selectedWorkflow:e.id,viewType:"workflow-detail",statusFilter:null,templateId:null,executionId:null})}const h=T([]);async function B(){try{const{apiService:e}=await O(async()=>{const{apiService:s}=await import("./index-CMv62JsV.js");return{apiService:s}},__vite__mapDeps([0,1,2,3,4,5,6]),import.meta.url),t=await e.getWorkflowTemplates();t.success&&t.templates.length>0?h.value=t.templates.map(s=>({id:s.templateId||s.id,name:s.name})):h.value=[{id:"t1",name:"æ ‡å‡†è½¬æ¢æµç¨‹"},{id:"t2",name:"å¿«é€Ÿé¢„è§ˆæµç¨‹"},{id:"t3",name:"é«˜è´¨é‡è¾“å‡º"}]}catch(e){console.error("Failed to load templates:",e),h.value=[{id:"t1",name:"æ ‡å‡†è½¬æ¢æµç¨‹"},{id:"t2",name:"å¿«é€Ÿé¢„è§ˆæµç¨‹"},{id:"t3",name:"é«˜è´¨é‡è¾“å‡º"}]}}const P=y(()=>k.executions.sort((e,t)=>new Date(t.startTime||0).getTime()-new Date(e.startTime||0).getTime()).slice(0,5).map(e=>({id:e.id,name:e.workflowName||"æœªå‘½åå·¥ä½œæµ",status:e.status==="completed"?"success":e.status==="failed"?"error":e.status,time:R(e.startTime)})));function R(e){if(!e)return"";const t=typeof e=="number"?new Date(e):new Date(e),d=new Date().getTime()-t.getTime(),$=Math.floor(d/6e4),D=Math.floor(d/36e5),H=Math.floor(d/864e5);return $<1?"åˆšåˆš":$<60?`${$}åˆ†é’Ÿå‰`:D<24?`${D}å°æ—¶å‰`:`${H}å¤©å‰`}function V(e){return{success:a.check,error:a.xCircle,running:a.refresh,pending:a.clock}[e]||a.circle}function L(e){i.value=`template-${e.id}`,w(),p.updatePanelContext("workflow",{templateId:e.id,viewType:"template",selectedWorkflow:null,statusFilter:null,executionId:null})}function A(e){i.value=`execution-${e.id}`,w(),p.updatePanelContext("workflow",{executionId:e.id,executionName:e.name,executionStatus:e.status,executionTime:e.time,viewType:"execution",selectedWorkflow:null,statusFilter:null,templateId:null})}function j(){i.value="",w(),p.updatePanelContext("workflow",{viewType:"new",selectedWorkflow:null,statusFilter:null,templateId:null,executionId:null})}function W(e){i.value=`status-${e}`,w(),p.updatePanelContext("workflow",{statusFilter:e,viewType:"status",selectedWorkflow:null,templateId:null,executionId:null})}return(e,t)=>(o(),l("div",Z,[n("div",ee,[n("div",{class:"section-header"},[t[5]||(t[5]=n("div",{class:"section-title"},"å·¥ä½œæµ",-1)),n("span",{class:"add-btn",onClick:j},"+")]),n("div",te,[(o(!0),l(I,null,b(M.value,s=>(o(),l("div",{key:s.id,class:m(["section-item",{"section-item--active":i.value===`workflow-${s.id}`}]),onClick:d=>N(s),title:s.name},[(o(),f(v(C(a).gitBranch),{size:16})),n("span",ne,r(E(s.name)),1),n("span",oe,r(s.count),1)],10,se))),128)),u.value.length>x&&!g.value?(o(),l("div",{key:0,class:"show-more-btn",onClick:t[0]||(t[0]=s=>g.value=!0)}," æ˜¾ç¤ºæ›´å¤š ("+r(u.value.length-x)+") ",1)):_("",!0),g.value&&u.value.length>x?(o(),l("div",{key:1,class:"show-more-btn",onClick:t[1]||(t[1]=s=>g.value=!1)}," æ”¶èµ· ")):_("",!0)])]),n("div",le,[t[9]||(t[9]=n("div",{class:"section-title"},"æ‰§è¡ŒçŠ¶æ€",-1)),n("div",ie,[n("div",{class:m(["section-item",{"section-item--active":i.value==="status-running"}]),onClick:t[2]||(t[2]=s=>W("running"))},[(o(),f(v(C(a).refresh),{size:16})),t[6]||(t[6]=n("span",null,"è¿è¡Œä¸­",-1)),c.value.running>0?(o(),l("span",ae,r(c.value.running),1)):_("",!0)],2),n("div",{class:m(["section-item",{"section-item--active":i.value==="status-completed"}]),onClick:t[3]||(t[3]=s=>W("completed"))},[(o(),f(v(C(a).check),{size:16})),t[7]||(t[7]=n("span",null,"å·²å®Œæˆ",-1)),c.value.completed>0?(o(),l("span",re,r(c.value.completed),1)):_("",!0)],2),n("div",{class:m(["section-item",{"section-item--active":i.value==="status-failed"}]),onClick:t[4]||(t[4]=s=>W("failed"))},[(o(),f(v(C(a).xCircle),{size:16})),t[8]||(t[8]=n("span",null,"å¤±è´¥",-1)),c.value.failed>0?(o(),l("span",ue,r(c.value.failed),1)):_("",!0)],2)])]),n("div",ce,[t[10]||(t[10]=n("div",{class:"section-title"},"å¿«é€Ÿå¼€å§‹",-1)),n("div",de,[(o(!0),l(I,null,b(h.value,s=>(o(),l("div",{key:s.id,class:m(["section-item",{"section-item--active":i.value===`template-${s.id}`}]),onClick:d=>L(s)},[(o(),f(v(C(a).layers),{size:16})),n("span",null,r(s.name),1)],10,me))),128))])]),n("div",fe,[t[11]||(t[11]=n("div",{class:"section-title"},"æ‰§è¡Œè®°å½•",-1)),n("div",ve,[P.value.length>0?(o(!0),l(I,{key:0},b(P.value,s=>(o(),l("div",{key:s.id,class:m(["section-item",{"section-item--active":i.value===`execution-${s.id}`}]),onClick:d=>A(s)},[(o(),f(v(V(s.status)),{size:16})),n("span",null,r(s.name),1),n("span",ke,r(s.time),1)],10,pe))),128)):(o(),l("div",we," æš‚æ— æ‰§è¡Œè®°å½• "))])])]))}}),Ie=K(ge,[["__scopeId","data-v-4c6f2554"]]);export{Ie as default};
