const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index-CMv62JsV.js","./api-BR07cdPl.js","./_plugin-vue_export-helper-BFgqyxDe.js","./runtime-core.esm-bundler-8-XbLWPr.js","./pinia-Be3yrKEl.js","./preload-helper-CmsKOCeN.js","./novelApi-CpaaRXu-.js"])))=>i.map(i=>d[i]);
import{_ as D}from"./preload-helper-CmsKOCeN.js";import{_ as T,u as L,e as O,d as z,c as G}from"./_plugin-vue_export-helper-BFgqyxDe.js";import{r as $,d as J,C as M,j as _,k as g,l as t,y as d,F as C,z as I,x as q,s as x}from"./runtime-core.esm-bundler-8-XbLWPr.js";import"./pinia-Be3yrKEl.js";const H={class:"generated-content-view"},K={class:"content-header"},Q={class:"header-info"},W={class:"stats-section"},X={class:"stat-card"},Y={class:"stat-info"},Z={class:"stat-value"},tt={class:"stat-card"},et={class:"stat-info"},st={class:"stat-value"},ot={class:"stat-card"},nt={class:"stat-info"},at={class:"stat-value"},lt={class:"stat-card"},ct={class:"stat-info"},it={class:"stat-value"},rt={class:"preview-section"},dt={class:"chapter-list"},ut=["onClick"],vt={class:"chapter-info"},pt={class:"chapter-number"},_t={class:"chapter-title"},gt={class:"chapter-meta"},ht={class:"scene-count"},mt={class:"expand-icon"},ft={key:0,class:"scene-list"},bt={class:"scene-preview"},wt={class:"scene-info"},kt={class:"scene-characters"},jt={class:"scene-actions"},St=["onClick"],$t=["onClick"],Ct={__name:"GeneratedContentView",setup(It){const j=L(),v=O();z();const S=G(),w=$(null),V=J(()=>v.currentProject?.name||"æœªå‘½åé¡¹ç›®"),k=$({chapters:0,scenes:0,characters:0,videos:0}),p=$([]);function y(a){const e=new Set;return a.filter(s=>{const o=s.id||s.chapterId;return e.has(o)?(console.warn("âš ï¸ å‘ç°é‡å¤ç« èŠ‚:",o,s.title),!1):(e.add(o),!0)})}M(async()=>{if(p.value.length>0){console.log("âš ï¸ æ•°æ®å·²åŠ è½½ï¼Œè·³è¿‡é‡å¤åŠ è½½");return}let a=v.currentProject?.id||v.currentProject?.projectId;a||(a=localStorage.getItem("novel_anime_current_project_id"),console.log("ğŸ“¦ ä» localStorage è·å– projectId:",a));let e=v.currentProject?.novelId||v.currentProject?.novel?.id||localStorage.getItem("novel_anime_current_novel_id");if(console.log("ğŸ“¦ novelId:",e),e){console.log("ğŸ“š å°è¯•ä» localStorage åŠ è½½å°è¯´æ•°æ®, novelId:",e);try{const s=localStorage.getItem(`novel_${e}`);if(s){const o=JSON.parse(s);if(console.log("ğŸ“š ä» localStorage åŠ è½½åˆ°å°è¯´æ•°æ®:",o.title,"ç« èŠ‚æ•°:",o.chapters?.length),o.chapters&&o.chapters.length>0){const u=o.chapters.map((l,m)=>({id:l.id||l.chapterId||`ch${m+1}`,number:l.chapterNumber||m+1,title:l.title||`ç¬¬${m+1}ç« `,scenes:(l.scenes||[]).map((n,r)=>{let i=n.title;if(!i||i==="Unknown"||i.includes("æœªçŸ¥")){const c=n.setting&&n.setting!=="Unknown"&&n.setting!=="æœªçŸ¥åœºæ™¯"?n.setting:null;if(c)i=`åœºæ™¯${n.sceneNumber||r+1}: ${c}`;else{const f=(n.content||n.description||"").substring(0,20).trim();f?i=`åœºæ™¯${n.sceneNumber||r+1}: ${f}...`:i=`åœºæ™¯${n.sceneNumber||r+1}`}}return{id:n.id||n.sceneId||`s${r+1}`,title:i,description:n.description||n.visualDescription||n.content?.substring(0,100)||"",characters:n.characters||[]}})}));p.value=y(u),console.log("âœ… å»é‡åç« èŠ‚æ•°:",p.value.length);const h=o.chapters.reduce((l,m)=>l+(m.scenes?.length||0),0);k.value={chapters:o.chapters.length,scenes:h,characters:0,videos:h},console.log("âœ… ä» localStorage æ„å»ºäº†æ˜¾ç¤ºæ•°æ®:",p.value.length,"ç« "),console.log("ğŸ“Š æ•°æ®å·²åŠ è½½åˆ° generatedChaptersï¼ŒPreviewView å°†ç‹¬ç«‹åŠ è½½æ•°æ®");return}}}catch(s){console.warn("âš ï¸ ä» localStorage åŠ è½½å¤±è´¥:",s)}}if(a)try{console.log("ğŸ“š å°è¯•ä»åç«¯åŠ è½½é¡¹ç›®æ•°æ®, projectId:",a);const{novelApi:s}=await D(async()=>{const{novelApi:u}=await import("./index-CMv62JsV.js");return{novelApi:u}},__vite__mapDeps([0,1,2,3,4,5,6]),import.meta.url),o=await s.listNovels(a);if(console.log("ğŸ“š å°è¯´åˆ—è¡¨:",o),o.success&&o.novels&&o.novels.length>0){const u=o.novels[0].novelId;console.log("ğŸ“š è·å–å°è¯´è¯¦æƒ…, novelId:",u);const h=await s.getNovel(u);if(console.log("ğŸ“š å°è¯´è¯¦æƒ…:",h),h.success&&h.novel){const l=h.novel;if(console.log("ğŸ“š ä»åç«¯è·å–åˆ°å°è¯´æ•°æ®:",l.title,"ç« èŠ‚æ•°:",l.chapters?.length),l.chapters&&l.chapters.length>0){const m=l.chapters.map((r,i)=>({id:r.chapterId||r.id||`ch${i+1}`,number:r.chapterNumber||i+1,title:r.title||`ç¬¬${i+1}ç« `,scenes:(r.scenes||[]).map((c,f)=>{let b=c.title;if(!b||b==="Unknown"||b.includes("æœªçŸ¥")){const N=c.setting&&c.setting!=="Unknown"&&c.setting!=="æœªçŸ¥åœºæ™¯"?c.setting:null;if(N)b=`åœºæ™¯${c.sceneNumber||f+1}: ${N}`;else{const P=(c.visualDescription||c.content||"").substring(0,20).trim();P?b=`åœºæ™¯${c.sceneNumber||f+1}: ${P}...`:b=`åœºæ™¯${c.sceneNumber||f+1}`}}return{id:c.sceneId||`s${f+1}`,title:b,description:c.visualDescription||c.content?.substring(0,100)||"",characters:[]}})}));p.value=y(m),console.log("âœ… å»é‡åç« èŠ‚æ•°:",p.value.length);const n=l.scenes?.length||l.chapters.reduce((r,i)=>r+(i.scenes?.length||0),0);k.value={chapters:l.chapters.length,scenes:n,characters:0,videos:n},console.log("âœ… ä»åç«¯æ„å»ºäº†æ˜¾ç¤ºæ•°æ®:",p.value.length,"ç« ,",n,"ä¸ªåœºæ™¯"),console.log("ğŸ“Š æ•°æ®å·²åŠ è½½åˆ° generatedChaptersï¼ŒPreviewView å°†ç‹¬ç«‹åŠ è½½æ•°æ®");return}}}}catch(s){console.warn("Failed to load generated content from backend:",s)}p.value.length===0&&console.log("âŒ No generated content found, showing empty state")});function A(a){w.value===a?w.value=null:w.value=a}function E(a){console.log("ğŸ¬ é¢„è§ˆåœºæ™¯:",a),console.log("âœ… è·³è½¬åˆ°é¢„è§ˆé¡µé¢"),j.push("/preview")}function R(a){S.addNotification({type:"success",title:"å¯¼å‡ºæˆåŠŸ",message:`${a.title} å·²å¯¼å‡º`,timeout:2e3})}function U(){S.addNotification({type:"success",title:"å¯¼å‡ºå…¨éƒ¨",message:"æ‰€æœ‰å†…å®¹å·²æ‰“åŒ…å¯¼å‡º",timeout:3e3})}function B(){j.push("/workflow")}async function F(){if(v.currentProject){const a=v.currentProject.id||v.currentProject.projectId;try{const{apiService:e}=await D(async()=>{const{apiService:s}=await import("./index-CMv62JsV.js");return{apiService:s}},__vite__mapDeps([0,1,2,3,4,5,6]),import.meta.url);await e.axiosInstance.put(`/project/${a}`,{status:"completed"})}catch(e){console.warn("Failed to update project status on backend:",e)}v.currentProject.status="completed"}v.clearCurrentProject(),localStorage.removeItem("novel_anime_current_novel_id"),localStorage.removeItem("novel_anime_current_novel_title"),j.push("/dashboard"),S.addNotification({type:"success",title:"ğŸ‰ é¡¹ç›®å®Œæˆ",message:"æ­å–œï¼æ‚¨çš„å°è¯´å·²æˆåŠŸè½¬æ¢ä¸ºåŠ¨æ¼«",timeout:5e3})}return(a,e)=>(g(),_("div",H,[t("div",K,[t("div",Q,[e[0]||(e[0]=t("h1",null,"ç”Ÿæˆç»“æœé¢„è§ˆ",-1)),t("p",null,d(V.value)+" - åŠ¨æ¼«è½¬æ¢å®Œæˆ",1)]),t("div",{class:"header-actions"},[t("button",{class:"btn btn-secondary",onClick:B}," è¿”å›å·¥ä½œæµ "),t("button",{class:"btn btn-primary",onClick:U}," å¯¼å‡ºå…¨éƒ¨ ")])]),t("div",W,[t("div",X,[e[2]||(e[2]=t("div",{class:"stat-icon"},"ğŸ“–",-1)),t("div",Y,[t("span",Z,d(k.value.chapters),1),e[1]||(e[1]=t("span",{class:"stat-label"},"ç« èŠ‚",-1))])]),t("div",tt,[e[4]||(e[4]=t("div",{class:"stat-icon"},"ğŸ¬",-1)),t("div",et,[t("span",st,d(k.value.scenes),1),e[3]||(e[3]=t("span",{class:"stat-label"},"åœºæ™¯",-1))])]),t("div",ot,[e[6]||(e[6]=t("div",{class:"stat-icon"},"ğŸ‘¤",-1)),t("div",nt,[t("span",at,d(k.value.characters),1),e[5]||(e[5]=t("span",{class:"stat-label"},"è§’è‰²",-1))])]),t("div",lt,[e[8]||(e[8]=t("div",{class:"stat-icon"},"ğŸ¥",-1)),t("div",ct,[t("span",it,d(k.value.videos),1),e[7]||(e[7]=t("span",{class:"stat-label"},"è§†é¢‘ç‰‡æ®µ",-1))])])]),t("div",rt,[e[10]||(e[10]=t("h2",null,"ç”Ÿæˆå†…å®¹",-1)),t("div",dt,[(g(!0),_(C,null,I(p.value,s=>(g(),_("div",{key:s.id,class:q(["chapter-card",{"chapter-card--expanded":w.value===s.id}])},[t("div",{class:"chapter-header",onClick:o=>A(s.id)},[t("div",vt,[t("span",pt,"ç¬¬"+d(s.number)+"ç« ",1),t("span",_t,d(s.title),1)]),t("div",gt,[t("span",ht,d(s.scenes.length)+" ä¸ªåœºæ™¯",1),t("span",mt,d(w.value===s.id?"â–¼":"â–¶"),1)])],8,ut),w.value===s.id?(g(),_("div",ft,[(g(!0),_(C,null,I(s.scenes,o=>(g(),_("div",{key:o.id,class:"scene-card"},[t("div",bt,[e[9]||(e[9]=t("div",{class:"scene-thumbnail"},[t("span",{class:"thumbnail-placeholder"},"ğŸ¬")],-1)),t("div",wt,[t("h4",null,d(o.title),1),t("p",null,d(o.description),1),t("div",kt,[(g(!0),_(C,null,I(o.characters,u=>(g(),_("span",{key:u,class:"character-tag"},d(u),1))),128))])])]),t("div",jt,[t("button",{class:"btn btn-small",onClick:u=>E(o)},"é¢„è§ˆ",8,St),t("button",{class:"btn btn-small",onClick:u=>R(o)},"å¯¼å‡º",8,$t)])]))),128))])):x("",!0)],2))),128))])]),t("div",{class:"action-section"},[t("button",{class:"btn btn-large btn-primary",onClick:F}," å®Œæˆé¡¹ç›® "),e[11]||(e[11]=t("p",{class:"action-hint"},"ç‚¹å‡»å®Œæˆé¡¹ç›®åï¼Œå°†è¿”å›é¡¹ç›®æ¦‚è§ˆé¡µé¢",-1))])]))}},Vt=T(Ct,[["__scopeId","data-v-aef8dcc7"]]);export{Vt as default};
