import{_ as K,i as r,u as de,b as ue,e as ce,c as ve,d as me}from"./_plugin-vue_export-helper-BFgqyxDe.js";import{u as G,a as fe}from"./App-DXMnr7Mu.js";import{withModifiers as q,vModelText as pe}from"./vue.runtime.esm-bundler-tGj6Om4U.js";import{d as D,L as ge,j as u,k as o,l as n,s as k,p as v,u as p,v as g,x as z,y as T,B as H,F as J,z as W,r as h,C as Z,K as he,q as ye,w as be,D as E}from"./runtime-core.esm-bundler-8-XbLWPr.js";import{I as A}from"./InputDialog-CLWUPPpH.js";import"./pinia-Be3yrKEl.js";import"./preload-helper-CmsKOCeN.js";import"./useTheme-yXL8gOdE.js";import"./credits-WUr7wWTG.js";const Ce={class:"tree-node-wrapper"},xe={key:1,class:"tree-spacer"},ke={class:"tree-name"},$e={key:2,class:"item-count"},De={key:0,class:"tree-children"},Se={__name:"DocumentTreeNode",props:{node:{type:Object,required:!0},depth:{type:Number,default:0},expandedFolders:{type:Array,default:()=>[]},selectedNode:{type:Object,default:null}},emits:["toggle","select","contextmenu"],setup(d,{emit:f}){const l=d,a=f,c=D(()=>l.expandedFolders.includes(l.node.id)),s=D(()=>l.selectedNode?.id===l.node.id),S=D(()=>{if(l.node.type==="folder")return c.value?r.folderOpen:r.folder;switch(l.node.fileType||F(l.node.name)){case"novel":return r.fileText;case"script":return r.file;case"storyboard":return r.image;case"video":return r.video;default:return r.fileText}}),N=D(()=>{if(l.node.type==="folder")return"tree-icon--folder";switch(l.node.fileType||F(l.node.name)){case"novel":return"tree-icon--novel";case"script":return"tree-icon--script";case"storyboard":return"tree-icon--storyboard";case"video":return"tree-icon--video";default:return"tree-icon--default"}}),b=D(()=>l.node.type==="folder"&&(l.node.count>0||l.node.children&&l.node.children.length>0)),I=D(()=>l.node.count!==void 0?l.node.count:l.node.children?l.node.children.length:0);function O(){a("select",l.node)}function w(){l.node.type==="folder"&&a("toggle",l.node.id)}function U(C){a("contextmenu",{node:l.node,event:C})}function F(C){switch(C.split(".").pop()?.toLowerCase()){case"txt":case"md":return"novel";case"json":case"script":return"script";case"png":case"jpg":case"jpeg":return"storyboard";case"mp4":case"avi":case"mov":return"video";default:return"other"}}return(C,y)=>{const $=ge("DocumentTreeNode",!0);return o(),u("div",Ce,[n("div",{class:z(["tree-item",{"tree-item--folder":d.node.type==="folder","tree-item--file":d.node.type==="file","tree-item--expanded":c.value,"tree-item--selected":s.value}]),style:H({paddingLeft:d.depth*12+8+"px"}),onClick:O,onContextmenu:q(U,["prevent","stop"])},[d.node.type==="folder"?(o(),v(p(c.value?g(r).chevronDown:g(r).chevronRight),{key:0,size:12,class:"tree-chevron",onClick:q(w,["stop"])})):(o(),u("div",xe)),(o(),v(p(S.value),{size:16,class:z(["tree-icon",N.value])},null,8,["class"])),n("span",ke,T(d.node.name),1),b.value?(o(),u("span",$e,T(I.value),1)):k("",!0)],38),c.value&&d.node.children&&d.node.children.length>0?(o(),u("div",De,[(o(!0),u(J,null,W(d.node.children,P=>(o(),v($,{key:P.id,node:P,depth:d.depth+1,"expanded-folders":d.expandedFolders,"selected-node":d.selectedNode,onToggle:y[0]||(y[0]=j=>C.$emit("toggle",j)),onSelect:y[1]||(y[1]=j=>C.$emit("select",j)),onContextmenu:y[2]||(y[2]=j=>C.$emit("contextmenu",j))},null,8,["node","depth","expanded-folders","selected-node"]))),128))])):k("",!0)])}}},je=K(Se,[["__scopeId","data-v-e8afe9b4"]]),Ne={class:"document-tree-container"},Te={class:"search-box"},we={key:1,class:"tree-empty"},Fe={key:3,class:"context-menu-divider"},Pe={__name:"DocumentTree",emits:["select","open","create","delete","rename"],setup(d,{emit:f}){const l=f,a=G(),c=h(""),s=h({visible:!1,x:0,y:0,node:null}),S=D(()=>a.filteredFileTree),N=D(()=>a.expandedFolders),b=D(()=>a.selectedNode);function I(){a.setSearchQuery(c.value)}function O(){c.value="",a.setSearchQuery("")}function w(m){a.toggleFolder(m)}function U(m){a.selectNode(m),l("select",m)}function F(m){y(m,null)}function C({node:m,event:i}){y(i,m)}function y(m,i){s.value={visible:!0,x:m.clientX,y:m.clientY,node:i}}function $(){s.value.visible=!1}function P(){s.value.node&&l("open",s.value.node),$()}function j(){const m=s.value.node?.id;l("create",{type:"file",parentId:m}),$()}function B(){const m=s.value.node?.id;l("create",{type:"folder",parentId:m}),$()}function L(){s.value.node&&l("rename",s.value.node),$()}function V(){s.value.node&&l("delete",s.value.node),$()}function Q(){a.loadFromStorage(),$()}function M(m){s.value.visible&&$()}return Z(()=>{a.loadFromStorage(),document.addEventListener("click",M)}),he(()=>{document.removeEventListener("click",M)}),(m,i)=>(o(),u("div",Ne,[n("div",Te,[(o(),v(p(g(r).search),{size:16,class:"search-icon"})),ye(n("input",{type:"text",placeholder:"æœç´¢",class:"search-input","onUpdate:modelValue":i[0]||(i[0]=R=>c.value=R),onInput:I},null,544),[[pe,c.value]]),c.value?(o(),u("button",{key:0,class:"search-clear",onClick:O},[(o(),v(p(g(r).x),{size:14}))])):k("",!0)]),n("div",{class:"document-tree",onContextmenu:q(F,["prevent"])},[S.value.length>0?(o(!0),u(J,{key:0},W(S.value,R=>(o(),v(je,{key:R.id,node:R,depth:0,"expanded-folders":N.value,"selected-node":b.value,onToggle:w,onSelect:U,onContextmenu:C},null,8,["node","expanded-folders","selected-node"]))),128)):(o(),u("div",we,[(o(),v(p(g(r).folder),{size:24})),n("span",null,T(c.value?"æ— åŒ¹é…ç»“æžœ":"æš‚æ— æ–‡ä»¶"),1)]))],32),s.value.visible?(o(),u("div",{key:0,class:"context-menu",style:H({top:s.value.y+"px",left:s.value.x+"px"}),onClick:i[1]||(i[1]=q(()=>{},["stop"]))},[s.value.node?.type==="file"?(o(),u("div",{key:0,class:"context-menu-item",onClick:P},[(o(),v(p(g(r).fileText),{size:14})),i[2]||(i[2]=n("span",null,"æ‰“å¼€æ–‡ä»¶",-1))])):k("",!0),s.value.node?.type==="folder"?(o(),u("div",{key:1,class:"context-menu-item",onClick:j},[(o(),v(p(g(r).filePlus),{size:14})),i[3]||(i[3]=n("span",null,"æ–°å»ºæ–‡ä»¶",-1))])):k("",!0),s.value.node?.type==="folder"?(o(),u("div",{key:2,class:"context-menu-item",onClick:B},[(o(),v(p(g(r).folderPlus),{size:14})),i[4]||(i[4]=n("span",null,"æ–°å»ºæ–‡ä»¶å¤¹",-1))])):k("",!0),s.value.node?(o(),u("div",Fe)):k("",!0),s.value.node?(o(),u("div",{key:4,class:"context-menu-item",onClick:L},[(o(),v(p(g(r).edit),{size:14})),i[5]||(i[5]=n("span",null,"é‡å‘½å",-1))])):k("",!0),s.value.node?(o(),u("div",{key:5,class:"context-menu-item context-menu-item--danger",onClick:V},[(o(),v(p(g(r).trash),{size:14})),i[6]||(i[6]=n("span",null,"åˆ é™¤",-1))])):k("",!0),i[8]||(i[8]=n("div",{class:"context-menu-divider"},null,-1)),n("div",{class:"context-menu-item",onClick:Q},[(o(),v(p(g(r).refresh),{size:14})),i[7]||(i[7]=n("span",null,"åˆ·æ–°",-1))])],4)):k("",!0)]))}},ze=K(Pe,[["__scopeId","data-v-f6b51924"]]),Ie={class:"confirm-dialog"},Re={class:"dialog-header"},Ue={class:"dialog-body"},Me={class:"dialog-footer"},Oe={__name:"ConfirmDialog",props:{title:{type:String,default:"ç¡®è®¤"},message:{type:String,required:!0},confirmText:{type:String,default:"ç¡®è®¤"},cancelText:{type:String,default:"å–æ¶ˆ"},confirmType:{type:String,default:"primary",validator:d=>["primary","danger","warning"].includes(d)}},emits:["confirm","cancel"],setup(d){const f=d,l=D(()=>`btn-${f.confirmType}`);return(a,c)=>(o(),u("div",{class:"modal-overlay",onClick:c[2]||(c[2]=q(s=>a.$emit("cancel"),["self"]))},[n("div",Ie,[n("div",Re,[n("h3",null,T(d.title),1)]),n("div",Ue,[n("p",null,T(d.message),1)]),n("div",Me,[n("button",{class:"btn btn-secondary",onClick:c[0]||(c[0]=s=>a.$emit("cancel"))},T(d.cancelText),1),n("button",{class:z(["btn",l.value]),onClick:c[1]||(c[1]=s=>a.$emit("confirm"))},T(d.confirmText),3)])])]))}},Be=K(Oe,[["__scopeId","data-v-a39f92b6"]]),Le={class:"dashboard-panel"},Ve={class:"section"},Ee={class:"section-items"},qe={key:0,class:"item-badge"},Qe={class:"section"},Ae={class:"section-items"},Ke={key:0,class:"item-badge item-badge--highlight"},Xe={key:0,class:"item-badge"},Ye={class:"section section--shortcuts"},Ge={class:"section-items"},He={class:"section section--documents"},Je={__name:"DashboardPanel",setup(d){const f=de(),l=ue(),a=ce(),c=fe(),s=G(),S=ve(),N=me(),b=h("project-dashboard"),I=h(!1),O=h(""),w=h(!1),U=h(""),F=h(!1),C=h(""),y=h(!1),$=h(""),P=h(!1),j=h(""),B=h(null),L=h(null),V=h(null),Q=D(()=>a.projectCounts),M=D(()=>c.taskCounts);Z(async()=>{console.log("ðŸ“Š DashboardPanel mounted, fetching projects..."),await a.fetchProjects(),console.log("ðŸ“Š Projects loaded, count:",a.projects.length)}),be(()=>l.path,async(t,e)=>{t==="/dashboard"&&e&&e!=="/dashboard"&&(console.log("ðŸ”„ Switched to dashboard from",e,", refreshing projects..."),await a.fetchProjects(),console.log("âœ… Projects refreshed, count:",a.projects.length))},{immediate:!1});function m(){O.value="",I.value=!0}async function i(t){if(t&&t.trim()){console.log("ðŸ“ DashboardPanel: Creating project:",t);const e=await a.createProject({name:t.trim(),description:"æ–°å»ºçš„å°è¯´åŠ¨æ¼«é¡¹ç›®",type:"novel-to-anime"});e?(console.log("âœ… DashboardPanel: Project created successfully:",e),S.addNotification({type:"success",title:"åˆ›å»ºæˆåŠŸ",message:`é¡¹ç›® "${t}" å·²åˆ›å»º`,timeout:2e3}),b.value="project-library",R("library")):(console.error("âŒ DashboardPanel: Project creation failed"),S.addNotification({type:"error",title:"åˆ›å»ºå¤±è´¥",message:a.error||"æ— æ³•åˆ›å»ºé¡¹ç›®ï¼Œè¯·é‡è¯•",timeout:5e3}))}I.value=!1}function R(t){console.log("ðŸ–±ï¸ Project clicked:",t),b.value=`project-${t}`;const e={selectedProject:t==="dashboard"?null:t,viewType:t==="dashboard"?null:"project",statusFilter:null,shortcutType:null};console.log("ðŸ“¤ Updating panelContext:",e),N.updatePanelContext("dashboard",e),console.log("âœ… panelContext updated, current state:",N.panelContext.dashboard),f.currentRoute.value.path!=="/dashboard"&&(console.log("ðŸ”„ Navigating to /dashboard"),f.push("/dashboard"))}function X(t){console.log("ðŸ–±ï¸ Status clicked:",t),b.value=`status-${t}`;const e={statusFilter:t,viewType:"status",selectedProject:null,shortcutType:null};console.log("ðŸ“¤ Updating panelContext:",e),N.updatePanelContext("dashboard",e),console.log("âœ… panelContext updated, current state:",N.panelContext.dashboard),f.currentRoute.value.path!=="/dashboard"&&(console.log("ðŸ”„ Navigating to /dashboard"),f.push("/dashboard"))}function Y(t){console.log("ðŸ–±ï¸ Shortcut clicked:",t),b.value=`shortcut-${t}`;const e={shortcutType:t,viewType:"shortcut",selectedProject:null,statusFilter:null};console.log("ðŸ“¤ Updating panelContext:",e),N.updatePanelContext("dashboard",e),console.log("âœ… panelContext updated, current state:",N.panelContext.dashboard),f.currentRoute.value.path!=="/dashboard"&&(console.log("ðŸ”„ Navigating to /dashboard"),f.push("/dashboard"))}function _(){B.value=null,U.value="",w.value=!0}function ee(t){t&&t.trim()&&(s.addFolder(B.value,{name:t.trim()}),S.addNotification({type:"success",title:"åˆ›å»ºæˆåŠŸ",message:`æ–‡ä»¶å¤¹ "${t}" å·²åˆ›å»º`,timeout:2e3})),w.value=!1}function te(t){t&&t.trim()&&(s.addFile(B.value,{name:t.trim()}),S.addNotification({type:"success",title:"åˆ›å»ºæˆåŠŸ",message:`æ–‡ä»¶ "${t}" å·²åˆ›å»º`,timeout:2e3})),F.value=!1}function ne(t){console.log("Selected:",t.name)}function oe(t){switch(t.fileType||"other"){case"novel":f.push(`/edit/novel/${t.id}`);break;case"script":f.push(`/edit/script/${t.id}`);break;case"storyboard":f.push(`/edit/storyboard/${t.id}`);break;case"video":f.push(`/preview/video/${t.id}`);break;default:f.push(`/edit/file/${t.id}`)}}function le({type:t,parentId:e}){B.value=e,t==="folder"?(U.value="",w.value=!0):(C.value="",F.value=!0)}function se(t){L.value=t,$.value=t.name,y.value=!0}function ae(t){t&&t.trim()&&L.value&&(s.renameNode(L.value.id,t.trim()),S.addNotification({type:"success",title:"é‡å‘½åæˆåŠŸ",message:`å·²é‡å‘½åä¸º "${t}"`,timeout:2e3})),y.value=!1,L.value=null}function ie(t){V.value=t,j.value=t.name,P.value=!0}function re(){V.value&&(s.deleteNode(V.value.id),S.addNotification({type:"success",title:"åˆ é™¤æˆåŠŸ",message:`"${j.value}" å·²åˆ é™¤`,timeout:2e3})),P.value=!1,V.value=null}return(t,e)=>(o(),u("div",Le,[n("div",Ve,[n("div",{class:"section-header"},[e[11]||(e[11]=n("div",{class:"section-title"},"é¡¹ç›®",-1)),n("span",{class:"add-btn",onClick:m},"+")]),n("div",Ee,[n("div",{class:z(["section-item",{"section-item--active":b.value==="project-dashboard"}]),onClick:e[0]||(e[0]=x=>R("dashboard"))},[(o(),v(p(g(r).grid),{size:16})),e[12]||(e[12]=n("span",null,"æ¦‚è§ˆ",-1))],2),n("div",{class:z(["section-item",{"section-item--active":b.value==="project-library"}]),onClick:e[1]||(e[1]=x=>R("library"))},[(o(),v(p(g(r).book),{size:16})),e[13]||(e[13]=n("span",null,"å…¨éƒ¨é¡¹ç›®",-1)),Q.value.total>0?(o(),u("span",qe,T(Q.value.total),1)):k("",!0)],2)])]),n("div",Qe,[e[16]||(e[16]=n("div",{class:"section-title"},"ä»»åŠ¡",-1)),n("div",Ae,[n("div",{class:z(["section-item",{"section-item--active":b.value==="status-running"}]),onClick:e[2]||(e[2]=x=>X("running"))},[(o(),v(p(g(r).refresh),{size:16})),e[14]||(e[14]=n("span",null,"è¿›è¡Œä¸­",-1)),M.value.running>0?(o(),u("span",Ke,T(M.value.running),1)):k("",!0)],2),n("div",{class:z(["section-item",{"section-item--active":b.value==="status-completed"}]),onClick:e[3]||(e[3]=x=>X("completed"))},[(o(),v(p(g(r).check),{size:16})),e[15]||(e[15]=n("span",null,"å·²å®Œæˆ",-1)),M.value.completed>0?(o(),u("span",Xe,T(M.value.completed),1)):k("",!0)],2)])]),n("div",Ye,[e[19]||(e[19]=n("div",{class:"section-title"},"å¿«æ·å…¥å£",-1)),n("div",Ge,[n("div",{class:z(["section-item",{"section-item--active":b.value==="shortcut-recent"}]),onClick:e[4]||(e[4]=x=>Y("recent"))},[(o(),v(p(g(r).clock),{size:16})),e[17]||(e[17]=n("span",null,"æœ€è¿‘æ‰“å¼€",-1))],2),n("div",{class:z(["section-item",{"section-item--active":b.value==="shortcut-favorites"}]),onClick:e[5]||(e[5]=x=>Y("favorites"))},[(o(),v(p(g(r).star),{size:16})),e[18]||(e[18]=n("span",null,"æ”¶è—",-1))],2)])]),n("div",He,[n("div",{class:"section-header"},[e[20]||(e[20]=n("div",{class:"section-title"},"æ–‡æ¡£",-1)),n("span",{class:"add-btn",onClick:_},"+")]),E(ze,{onSelect:ne,onOpen:oe,onCreate:le,onRename:se,onDelete:ie})]),E(A,{visible:I.value,"onUpdate:visible":e[6]||(e[6]=x=>I.value=x),title:"åˆ›å»ºæ–°é¡¹ç›®",message:"è¯·è¾“å…¥é¡¹ç›®åç§°",placeholder:"ä¾‹å¦‚ï¼šæˆ‘çš„å°è¯´é¡¹ç›®","default-value":O.value,onConfirm:i},null,8,["visible","default-value"]),E(A,{visible:w.value,"onUpdate:visible":e[7]||(e[7]=x=>w.value=x),title:"åˆ›å»ºæ–‡ä»¶å¤¹",message:"è¯·è¾“å…¥æ–‡ä»¶å¤¹åç§°",placeholder:"ä¾‹å¦‚ï¼šæˆ‘çš„æ–‡ä»¶å¤¹","default-value":U.value,onConfirm:ee},null,8,["visible","default-value"]),E(A,{visible:F.value,"onUpdate:visible":e[8]||(e[8]=x=>F.value=x),title:"åˆ›å»ºæ–‡ä»¶",message:"è¯·è¾“å…¥æ–‡ä»¶åç§°",placeholder:"ä¾‹å¦‚ï¼šæˆ‘çš„æ–‡ä»¶.txt","default-value":C.value,onConfirm:te},null,8,["visible","default-value"]),E(A,{visible:y.value,"onUpdate:visible":e[9]||(e[9]=x=>y.value=x),title:"é‡å‘½å",message:"è¯·è¾“å…¥æ–°åç§°",placeholder:$.value,"default-value":$.value,onConfirm:ae},null,8,["visible","placeholder","default-value"]),P.value?(o(),v(Be,{key:0,title:"ç¡®è®¤åˆ é™¤",message:`ç¡®å®šè¦åˆ é™¤ "${j.value}" å—ï¼Ÿæ­¤æ“ä½œæ— æ³•æ’¤é”€ã€‚`,"confirm-text":"åˆ é™¤","cancel-text":"å–æ¶ˆ","confirm-type":"danger",onConfirm:re,onCancel:e[10]||(e[10]=x=>P.value=!1)},null,8,["message"])):k("",!0)]))}},at=K(Je,[["__scopeId","data-v-59744d0b"]]);export{at as default};
