import{a as o}from"./_plugin-vue_export-helper-BFgqyxDe.js";class n{constructor(){this.baseURL="http://localhost:8080/rest/s1/novel-anime",this.isDevelopment=this.baseURL.includes("localhost"),console.log("üîß ApiService initialized:",{baseURL:this.baseURL,isDevelopment:this.isDevelopment,"import.meta.env.DEV":!1}),this.axiosInstance=o.create({baseURL:this.baseURL,timeout:this.isDevelopment?5e3:3e4,headers:{"Content-Type":"application/json"}}),this.axiosInstance.interceptors.request.use(s=>{const e=localStorage.getItem("novel_anime_access_token");return e?(s.headers.Authorization=`Bearer ${e}`,console.debug("[API Request]",s.method?.toUpperCase(),s.url,"- Auth: ‚úì")):console.debug("[API Request]",s.method?.toUpperCase(),s.url,"- Auth: ‚úó"),s},s=>(console.error("[API Request Error]",s),Promise.reject(s))),this.axiosInstance.interceptors.response.use(s=>(console.debug("[API Response]",s.config.method?.toUpperCase(),s.config.url,"- Status:",s.status),s),s=>{const e=s.response?.status,t=s.config?.url,r=s.config?.method?.toUpperCase();return console.error("[API Error]",{method:r,url:t,status:e,statusText:s.response?.statusText,message:s.message}),e===401&&(console.warn("üö´ 401 Unauthorized - Token invalid or expired"),console.warn("   Clearing auth tokens and redirecting to login"),localStorage.removeItem("novel_anime_access_token"),localStorage.removeItem("novel_anime_refresh_token"),localStorage.removeItem("novel_anime_user_id"),localStorage.removeItem("novel_anime_user_data")),e===403&&(console.warn("üö´ 403 Forbidden - Insufficient permissions"),console.warn("   User:",localStorage.getItem("novel_anime_user_id")||"Unknown")),e===404&&console.warn("‚ö†Ô∏è 404 Not Found:",t),Promise.reject(s)})}async testConnection(){try{const s=await this.axiosInstance.get("/auth/status",{timeout:3e3});return console.log("‚úÖ Backend connection test:",s.status===200?"OK":"Failed"),s.status===200}catch(s){return s.response?(console.log("‚úÖ Backend is reachable (status:",s.response.status,")"),!0):(console.error("‚ùå Backend connection test failed:",s.message),!1)}}async testAIService(){try{const s=await fetch("http://localhost:8080/rest/s1/mcp/user/ai-config",{method:"GET"});if(s.ok){const e=await s.json(),t=e.aiConfig&&e.aiConfig["ai.api.key"],r=e.aiConfig&&e.aiConfig["ai.provider"],a=e.aiConfig&&e.aiConfig["ai.model"];return console.log("ü§ñ MCP AI Config check:",{hasApiKey:!!t,hasProvider:!!r,hasModel:!!a,provider:e.aiConfig?.["ai.provider"],model:e.aiConfig?.["ai.model"]}),!!(t&&r&&a)}return!1}catch(s){return console.warn("AI service status check failed:",s.message),!1}}async getCurrentUser(){try{return(await this.axiosInstance.get("/auth/user")).data}catch(s){return console.error("Failed to get current user:",s),null}}async login(s,e){try{const t=await this.axiosInstance.post("/auth/login",{email:s,password:e});if(t.data.success){const r=t.data.token||t.data.accessToken;return r&&localStorage.setItem("novel_anime_access_token",r),{success:!0,token:r,user:t.data.user}}else return{success:!1,message:t.data.message||"Login failed"}}catch(t){return console.error("Login failed:",t),{success:!1,message:t.response?.data?.message||"Login failed. Please try again."}}}async register(s,e,t){try{const r=await this.axiosInstance.post("/auth/register",{email:s,password:e,username:t});if(r.data.success){const a=r.data.token||r.data.accessToken;return a&&localStorage.setItem("novel_anime_access_token",a),{success:!0,token:a,user:r.data.user}}else return{success:!1,message:r.data.message||"Registration failed"}}catch(r){return console.error("Registration failed:",r),{success:!1,message:r.response?.data?.message||"Registration failed. Please try again."}}}async logout(){try{return await this.axiosInstance.post("/auth/logout"),localStorage.removeItem("novel_anime_access_token"),localStorage.removeItem("novel_anime_refresh_token"),!0}catch(s){return console.error("Logout failed:",s),localStorage.removeItem("novel_anime_access_token"),localStorage.removeItem("novel_anime_refresh_token"),!1}}async getCredits(){try{const s=await this.axiosInstance.get("/credits");return{credits:s.data.credits||0,history:s.data.history||[]}}catch(s){return console.error("Failed to get credits:",s),{credits:0}}}async getProjects(s){try{let e=s||localStorage.getItem("novel_anime_user_id");e||(e=await this.getOrCreateDefaultUser());const t=await this.axiosInstance.get("/projects",{params:{userId:e}});return{success:!0,projects:t.data.projects||t.data||[]}}catch(e){return console.error("Failed to get projects:",e),e.response?.data?{success:e.response.data.success!==!1,projects:e.response.data.projects||[]}:{success:!1,projects:[],message:e.message}}}async getOrCreateDefaultUser(){const s=localStorage.getItem("novel_anime_user_data");if(s)try{const t=JSON.parse(s);if(t.userId)return localStorage.setItem("novel_anime_user_id",t.userId),t.userId}catch(t){console.warn("Failed to parse user data:",t)}const e=localStorage.getItem("novel_anime_user_id");if(e&&e!=="test-user-001")return e;if(this.isDevelopment){const t="EX_JOHN_DOE";return localStorage.setItem("novel_anime_user_id",t),console.log("üîß Using default development userId:",t),t}return console.warn("No valid userId found, user should login first"),""}async createProject(s){try{let e=s.userId||localStorage.getItem("novel_anime_user_id");e||(e=await this.getOrCreateDefaultUser());const r=(await this.axiosInstance.post("/projects",{name:s.name,description:s.description,userId:e})).data;return{success:r.success!==!1,project:r.project,message:r.message}}catch(e){return console.error("Failed to create project:",e),e.response?.data?{success:e.response.data.success!==!1,project:e.response.data.project,message:e.response.data.message}:{success:!1,message:e.message||"Failed to create project"}}}async updateProject(s,e){try{const t=await this.axiosInstance.put("/project",{projectId:s,...e});return{success:t.data?.success!==!1,message:t.data?.message}}catch(t){return console.error("Failed to update project:",t),{success:!1,message:t.message||"Failed to update project"}}}async deleteProject(s){try{console.log("üóëÔ∏è Deleting project:",s);const e=await this.axiosInstance.delete(`/project/${s}`);return console.log("üóëÔ∏è Delete response:",e.data),{success:e.data?.success!==!1,message:e.data?.message}}catch(e){return console.error("‚ùå Failed to delete project:",e),{success:!1,message:e.response?.data?.message||e.message||"Failed to delete project"}}}async getWorkflows(s){try{return{success:!0,workflows:(await this.axiosInstance.get("/workflows",{params:s})).data.workflows||[]}}catch(e){return console.error("Failed to get workflows:",e),{success:!1,workflows:[],message:e.message}}}async getWorkflow(s){console.log("üîç API: Getting workflow:",s);try{const e=await this.axiosInstance.get("/workflow",{params:{workflowId:s}});return console.log("‚úÖ API: Workflow response:",e.data),{success:!0,workflow:e.data.workflow}}catch(e){return console.error("‚ùå API: Failed to get workflow:",{workflowId:s,status:e.response?.status,statusText:e.response?.statusText,data:e.response?.data,message:e.message}),{success:!1,message:e.message}}}async createWorkflow(s){try{return{success:!0,workflowId:(await this.axiosInstance.post("/workflows",s)).data.workflowId}}catch(e){return console.error("Failed to create workflow:",e),{success:!1,message:e.message}}}async updateWorkflow(s,e){try{return await this.axiosInstance.put("/workflow",{workflowId:s,...e}),{success:!0}}catch(t){return console.error("Failed to update workflow:",t),{success:!1,message:t.message}}}async deleteWorkflow(s){try{return await this.axiosInstance.delete("/workflow",{params:{workflowId:s}}),{success:!0}}catch(e){return console.error("Failed to delete workflow:",e),{success:!1,message:e.message}}}async getWorkflowExecutions(s){try{return{success:!0,executions:(await this.axiosInstance.get("/workflow-executions",{params:s})).data.executions||[]}}catch(e){return console.error("Failed to get workflow executions:",e),{success:!1,executions:[],message:e.message}}}async getWorkflowExecution(s){try{return{success:!0,execution:(await this.axiosInstance.get("/workflow-execution",{params:{executionId:s}})).data.execution}}catch(e){return console.error("Failed to get workflow execution:",e),{success:!1,message:e.message}}}async createWorkflowExecution(s){try{return{success:!0,executionId:(await this.axiosInstance.post("/workflow-executions",s)).data.executionId}}catch(e){return console.error("Failed to create workflow execution:",e),{success:!1,message:e.message}}}async updateWorkflowExecution(s,e){try{return await this.axiosInstance.put("/workflow-execution",{executionId:s,...e}),{success:!0}}catch(t){return console.error("Failed to update workflow execution:",t),{success:!1,message:t.message}}}async getWorkflowTemplates(s){try{return{success:!0,templates:(await this.axiosInstance.get("/workflow-templates",{params:s})).data.templates||[]}}catch(e){return console.error("Failed to get workflow templates:",e),{success:!1,templates:[],message:e.message}}}async getWorkflowTemplate(s){try{return{success:!0,template:(await this.axiosInstance.get("/workflow-template",{params:{templateId:s}})).data.template}}catch(e){return console.error("Failed to get workflow template:",e),{success:!1,message:e.message}}}async createWorkflowTemplate(s){try{return{success:!0,templateId:(await this.axiosInstance.post("/workflow-templates",s)).data.templateId}}catch(e){return console.error("Failed to create workflow template:",e),{success:!1,message:e.message}}}async updateWorkflowTemplate(s,e){try{return await this.axiosInstance.put("/workflow-template",{templateId:s,...e}),{success:!0}}catch(t){return console.error("Failed to update workflow template:",t),{success:!1,message:t.message}}}async deleteWorkflowTemplate(s){try{const e=await this.axiosInstance.delete("/workflow-template",{params:{templateId:s}});return{success:e.data?.success!==!1,message:e.data?.message}}catch(e){return console.error("Failed to delete workflow template:",e),{success:!1,message:e.message}}}async getAssets(s){try{return{success:!0,assets:(await this.axiosInstance.get("/assets",{params:s})).data.assets||[]}}catch(e){return console.error("Failed to get assets:",e),{success:!1,assets:[],message:e.message}}}async getAsset(s){try{return{success:!0,asset:(await this.axiosInstance.get("/asset",{params:{assetId:s}})).data.asset}}catch(e){return console.error("Failed to get asset:",e),{success:!1,message:e.message}}}async createAsset(s){try{return{success:!0,assetId:(await this.axiosInstance.post("/assets",s)).data.assetId}}catch(e){return console.error("Failed to create asset:",e),{success:!1,message:e.message}}}async updateAsset(s,e){try{return await this.axiosInstance.put("/asset",{assetId:s,...e}),{success:!0}}catch(t){return console.error("Failed to update asset:",t),{success:!1,message:t.message}}}async deleteAsset(s){try{return await this.axiosInstance.delete("/asset",{params:{assetId:s}}),{success:!0}}catch(e){return console.error("Failed to delete asset:",e),{success:!1,message:e.message}}}async getNovel(s){try{const e=await this.axiosInstance.get(`/novel?novelId=${s}`);return{success:!0,novel:e.data.novel||e.data}}catch(e){return console.error("Failed to get novel:",e),{success:!1,message:e.message}}}async getNovels(s){try{return{success:!0,novels:(await this.axiosInstance.get("/novels",{params:s?{projectId:s}:void 0})).data.novels||[]}}catch(e){return console.error("Failed to get novels:",e),{success:!1,novels:[],message:e.message}}}async getUserSettings(s){try{const e=s||await this.getOrCreateDefaultUser();return{success:!0,settings:(await this.axiosInstance.get("/user-settings",{params:{userId:e}})).data.settings}}catch(e){return console.error("Failed to get user settings:",e),{success:!1,message:e.message}}}async updateUserSettings(s){try{const e=s.userId||await this.getOrCreateDefaultUser();return{success:!0,settings:(await this.axiosInstance.put("/user-settings",{...s,userId:e})).data.settings}}catch(e){return console.error("Failed to update user settings:",e),{success:!1,message:e.message}}}}const l=new n;export{l as a};
