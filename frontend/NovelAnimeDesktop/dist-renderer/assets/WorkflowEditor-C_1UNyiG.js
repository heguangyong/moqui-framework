const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./_plugin-vue_export-helper-BFgqyxDe.js","./runtime-core.esm-bundler-8-XbLWPr.js","./pinia-Be3yrKEl.js","./preload-helper-CmsKOCeN.js","./workflowStore-BU4lfOfq.js","./api-BR07cdPl.js","./CharacterSystem-9i6-R3qi.js","./credits-WUr7wWTG.js"])))=>i.map(i=>d[i]);
import{vModelSelect as Ht,withModifiers as q,vModelText as Gt,withKeys as Jt}from"./vue.runtime.esm-bundler-tGj6Om4U.js";import{u as qe,e as Zt,c as Qt,d as eo,i as p,_ as to}from"./_plugin-vue_export-helper-BFgqyxDe.js";import{useWorkflowStore as oo}from"./workflowStore-BU4lfOfq.js";import{_ as Y}from"./preload-helper-CmsKOCeN.js";import{J as Ce,r as c,I as so,d as v,C as no,K as lo,w as Ne,j as a,k as n,s as w,l as o,D as ao,q as Ve,y as i,F as b,z as W,p as m,u as g,v as y,B as ce,x as O,A as de}from"./runtime-core.esm-bundler-8-XbLWPr.js";import{I as io}from"./InputDialog-CLWUPPpH.js";import"./pinia-Be3yrKEl.js";import"./api-BR07cdPl.js";import"./CharacterSystem-9i6-R3qi.js";const Q=c(!1),pe=c(!1),ee=c(null);let X=null;function ro(){async function ve(){if(!Q.value)return X||(X=te(),X)}async function te(){pe.value=!0,ee.value=null;try{const{useAuthStore:x}=await Y(async()=>{const{useAuthStore:I}=await import("./_plugin-vue_export-helper-BFgqyxDe.js").then(h=>h.r);return{useAuthStore:I}},__vite__mapDeps([0,1,2,3]),import.meta.url),{useWorkflowStore:C}=await Y(async()=>{const{useWorkflowStore:I}=await import("./workflowStore-BU4lfOfq.js");return{useWorkflowStore:I}},__vite__mapDeps([4,2,1,5,0,3,6]),import.meta.url),u=x();u.accessToken&&await u.validateToken(),console.log("âœ… AuthStore initialized"),await C().initialize(),console.log("âœ… WorkflowStore initialized");try{const{useCreditsStore:I}=await Y(async()=>{const{useCreditsStore:S}=await import("./credits-WUr7wWTG.js");return{useCreditsStore:S}},__vite__mapDeps([7,2,1,0,3]),import.meta.url),h=I();typeof h.fetchBalance=="function"&&(await h.fetchBalance(),console.log("âœ… CreditsStore initialized"))}catch{console.log("â„¹ï¸ CreditsStore not available")}Q.value=!0,console.log("ðŸŽ‰ App initialization complete")}catch(x){const C=x instanceof Error?x.message:"Unknown initialization error";throw ee.value=C,console.error("âŒ App initialization failed:",C),x}finally{pe.value=!1}}async function r(){if(!Q.value){if(X){await X;return}await ve()}}function f(){Q.value=!1,pe.value=!1,ee.value=null,X=null}async function d(){try{const{useAuthStore:x}=await Y(async()=>{const{useAuthStore:I}=await import("./_plugin-vue_export-helper-BFgqyxDe.js").then(h=>h.r);return{useAuthStore:I}},__vite__mapDeps([0,1,2,3]),import.meta.url),{useUIStore:C}=await Y(async()=>{const{useUIStore:I}=await import("./_plugin-vue_export-helper-BFgqyxDe.js").then(h=>h.p);return{useUIStore:I}},__vite__mapDeps([0,1,2,3]),import.meta.url),u=x(),k=C();if(u.accessToken)if((await u.validateToken?.())?.success)try{const{useCreditsStore:h}=await Y(async()=>{const{useCreditsStore:N}=await import("./credits-WUr7wWTG.js");return{useCreditsStore:N}},__vite__mapDeps([7,2,1,0,3]),import.meta.url),S=h();await S.fetchBalance(),k.addNotification?.({type:"success",title:"æ¬¢è¿Žå›žæ¥",message:`${u.displayName}ï¼Œæ‚¨çš„ç§¯åˆ†ä½™é¢ï¼š${S.formattedBalance}`})}catch{}else k.addNotification?.({type:"warning",title:"ç™»å½•å·²è¿‡æœŸ",message:"è¯·é‡æ–°ç™»å½•"})}catch(x){const C=x instanceof Error?x.message:"Unknown error";ee.value=C,console.error("Auth initialization failed:",C)}}async function j(){try{const x=qe(),{useAuthStore:C}=await Y(async()=>{const{useAuthStore:I}=await import("./_plugin-vue_export-helper-BFgqyxDe.js").then(h=>h.r);return{useAuthStore:I}},__vite__mapDeps([0,1,2,3]),import.meta.url),u=C(),k=x.currentRoute.value.path;!u.isAuthenticated&&k!=="/login"&&x.push({path:"/login",query:{redirect:k}})}catch(x){console.error("handleStartupRedirect failed:",x)}}return{isAppInitialized:Ce(Q),isInitializing:Ce(pe),initError:Ce(ee),initialize:ve,waitForInit:r,reset:f,initializeAuth:d,handleStartupRedirect:j}}const uo={class:"workflow-editor"},co={key:0,class:"loading-overlay"},po={class:"view-header"},vo={key:0,class:"header-content"},fo={class:"workflow-title-group"},mo={class:"workflow-selector"},go={value:""},yo=["value"],wo={key:0,class:"workflow-actions"},ko={class:"header-actions"},_o=["disabled"],ho=["disabled"],bo={key:1,class:"execution-progress-panel"},xo={class:"progress-header"},Co={class:"progress-title"},No={class:"progress-actions"},Io={class:"progress-details"},Wo={class:"progress-bar-container"},To={class:"progress-bar"},jo={class:"progress-text"},Do={class:"node-status-summary"},Eo={class:"status-item"},So={class:"status-value"},zo={class:"status-item status-completed"},Po={class:"status-value"},$o={class:"status-item status-running"},Mo={class:"status-value"},Ao={class:"status-item status-pending"},Ro={class:"status-value"},Lo={key:0,class:"execution-logs-panel"},Oo={class:"log-time"},Uo={class:"log-level"},Bo={class:"log-message"},Fo={key:0,class:"logs-empty"},Yo={class:"results-content"},Xo={class:"results-header"},Ko={class:"results-actions"},Vo={key:0},qo={key:1},Ho={class:"result-stats"},Go={class:"stat-item"},Jo={class:"stat-value"},Zo={class:"stat-item"},Qo={class:"stat-value"},es={class:"stat-item"},ts={class:"stat-value"},os={class:"node-results-section"},ss={class:"node-results-list"},ns={class:"node-result-header"},ls={class:"node-icon"},as={class:"node-name"},is={key:0,class:"node-result-data"},rs={key:0,class:"result-actions"},us={class:"editor-content"},cs={key:0,class:"status-view"},ds={class:"status-list"},ps=["onClick"],vs={class:"status-info"},fs={class:"status-name"},ms={class:"status-desc"},gs={class:"status-time"},ys={key:0,class:"empty-status"},ws={key:1,class:"template-view"},ks={class:"template-content"},_s={class:"template-preview"},hs={class:"template-nodes"},bs={class:"node-list"},xs={class:"node-icon"},Cs={key:2,class:"execution-history-view"},Ns={class:"execution-detail"},Is={class:"execution-info-card"},Ws={class:"info-header"},Ts={class:"execution-id"},js={class:"info-grid"},Ds={class:"info-item"},Es={class:"info-item"},Ss={class:"info-value"},zs={class:"info-item"},Ps={class:"info-value"},$s={class:"info-item"},Ms={class:"info-value"},As={class:"execution-timeline"},Rs={class:"timeline-items"},Ls={class:"timeline-content"},Os={class:"timeline-time"},Us={class:"timeline-message"},Bs={key:3,class:"editor-layout"},Fs={class:"node-palette"},Ys={class:"node-search"},Xs={class:"node-categories"},Ks=["onDragstart"],Vs={class:"node-item-icon"},qs={class:"node-item-text"},Hs={key:0,class:"no-results"},Gs={key:0,class:"validation-section"},Js={key:0,class:"validation-result"},Zs={key:0,class:"validation-success"},Qs={key:1,class:"validation-errors"},en={key:2,class:"validation-warnings"},tn={class:"workflow-canvas-wrapper"},on={class:"canvas-controls-fixed"},sn={class:"zoom-level"},nn={key:0,class:"empty-canvas"},ln=["onMousedown","onClick","onDblclick"],an={key:0,class:"node-status-indicator"},rn={class:"node-header"},un={class:"node-icon"},cn={class:"node-title"},dn=["onClick"],pn=["onClick"],vn={class:"node-content"},fn={class:"node-inputs"},mn={class:"node-outputs"},gn={key:1,class:"node-config-preview"},yn={key:2,class:"node-progress"},wn={class:"node-progress-bar"},kn={class:"node-progress-text"},_n={class:"connections-layer"},hn=["x1","y1","x2","y2"],bn={key:2,class:"node-properties-panel"},xn={class:"properties-header"},Cn={class:"properties-content"},Nn={class:"property-group"},In=["value"],Wn={class:"property-group"},Tn={class:"property-value"},jn={class:"property-group"},Dn={class:"property-row"},En={class:"property-group"},Sn={key:0,class:"property-group"},zn={key:1,class:"property-group"},Pn={key:2,class:"property-group"},$n={class:"property-actions"},Mn=so({__name:"WorkflowEditor",setup(ve){const te=qe(),r=oo(),f=Zt(),d=Qt(),j=eo(),{waitForInit:x}=ro(),C=c(!1),u=c(""),k=c(""),I=c(""),h=c(null),S=c(null),N=c(null),U=c(!1);c(!1);const He=c(null),R=c(""),K=c(!1),H=c([]),B=c(null),Ge=c(0),Je=c([]),M=c(1),V=c({x:0,y:0}),fe=c(!1),me=c({x:0,y:0}),ge=c(!1);c(!1),c(null),c(0),c({x:0,y:0}),c(null),c(null);const G=c(!1),oe=c(""),se=c(""),ne=c(""),le=c(""),J=c(null),F=v(()=>j.panelContext.workflow||{}),z=v(()=>F.value?.viewType||""),ae=v(()=>F.value?.statusFilter||""),Ze=v(()=>F.value?.templateId||""),Qe=v(()=>F.value?.executionId||""),ye=v(()=>F.value?.executionName||""),we=v(()=>F.value?.executionStatus||"success"),Z=v(()=>F.value?.executionTime||""),Ie=c([{id:"t1",name:"æ ‡å‡†è½¬æ¢æµç¨‹",description:"å®Œæ•´çš„å°è¯´åˆ°è§†é¢‘è½¬æ¢æµç¨‹ï¼ˆå«AIå›¾ç‰‡ç”Ÿæˆï¼‰",nodes:["novel-parser","character-analyzer","scene-generator","image-generator","script-converter","video-generator"]},{id:"t2",name:"å¿«é€Ÿé¢„è§ˆæµç¨‹",description:"å¿«é€Ÿç”Ÿæˆé¢„è§ˆè§†é¢‘ï¼ˆå«AIå›¾ç‰‡ç”Ÿæˆï¼‰",nodes:["novel-parser","scene-generator","image-generator","video-generator"]},{id:"t3",name:"é«˜è´¨é‡è¾“å‡º",description:"é«˜è´¨é‡è§†é¢‘è¾“å‡ºæµç¨‹ï¼ˆå«AIå›¾ç‰‡ç”Ÿæˆï¼‰",nodes:["novel-parser","character-analyzer","scene-generator","image-generator","script-converter","video-generator"]}]),$=v(()=>Ie.value.find(e=>e.id===Ze.value)),et=v(()=>$.value?.nodes||[]);v(()=>{switch(z.value){case"status":return ke.value;case"template":return $.value?.name||"æ¨¡æ¿è¯¦æƒ…";case"execution":return ye.value||"æ‰§è¡Œè®°å½•";case"new":return"æ–°å»ºå·¥ä½œæµ";case"workflow-detail":return"å·¥ä½œæµç¼–è¾‘å™¨";default:return"å·¥ä½œæµç¼–è¾‘å™¨"}}),v(()=>{switch(z.value){case"status":return We.value;case"template":return $.value?.description||"æŸ¥çœ‹æ¨¡æ¿é…ç½®";case"execution":return Z.value?`æ‰§è¡ŒäºŽ ${Z.value}`:"æŸ¥çœ‹å·¥ä½œæµæ‰§è¡ŒåŽ†å²";case"new":return"åˆ›å»ºæ–°çš„å·¥ä½œæµ";case"workflow-detail":return _.value?.description||"è®¾è®¡å’Œç¼–è¾‘å·¥ä½œæµèŠ‚ç‚¹";default:return"è®¾è®¡å’Œæ‰§è¡Œå·¥ä½œæµç¨‹"}});const ke=v(()=>({running:"è¿è¡Œä¸­",completed:"å·²å®Œæˆ",failed:"å¤±è´¥"})[ae.value]||"å·¥ä½œæµçŠ¶æ€"),We=v(()=>({running:"æ­£åœ¨æ‰§è¡Œçš„å·¥ä½œæµ",completed:"å·²æˆåŠŸå®Œæˆçš„å·¥ä½œæµ",failed:"æ‰§è¡Œå¤±è´¥çš„å·¥ä½œæµ"})[ae.value]||"æŸ¥çœ‹å·¥ä½œæµæ‰§è¡ŒçŠ¶æ€"),Te=v(()=>ae.value?L.value.filter(e=>e.status===ae.value):L.value);function je(e){return{running:p.refresh,completed:p.check,failed:p.xCircle,idle:p.circle}[e]||p.circle}function De(e){if(!e)return"";const t=new Date(e),l=new Date-t;return l<6e4?"åˆšåˆš":l<36e5?`${Math.floor(l/6e4)} åˆ†é’Ÿå‰`:l<864e5?`${Math.floor(l/36e5)} å°æ—¶å‰`:t.toLocaleDateString("zh-CN")}function Ee(e){return new Date(e).toLocaleTimeString("zh-CN",{hour12:!1})}function tt(e){if(!e||e<0)return"0ç§’";if(e<1e3)return`${e}æ¯«ç§’`;const t=Math.floor(e/1e3),s=Math.floor(t/60),l=Math.floor(s/60);return l>0?`${l}å°æ—¶${s%60}åˆ†${t%60}ç§’`:s>0?`${s}åˆ†${t%60}ç§’`:`${t}ç§’`}function ot(e){return{idle:"ç©ºé—²",pending:"å¾…æ‰§è¡Œ",running:"æ‰§è¡Œä¸­",completed:"å·²å®Œæˆ",error:"é”™è¯¯"}[e||"idle"]||"æœªçŸ¥"}function st(e){return{success:"æˆåŠŸ",completed:"æˆåŠŸ",error:"å¤±è´¥",failed:"å¤±è´¥",running:"æ‰§è¡Œä¸­",cancelled:"å·²å–æ¶ˆ"}[e]||e}function Se(e){return N.value?.nodeResultsData?e in N.value.nodeResultsData:!1}function nt(e){if(!N.value?.nodeResultsData)return"";const t=N.value.nodeResultsData[e];if(!t)return"";try{return JSON.stringify(t,null,2)}catch{return String(t)}}function lt(){K.value=!K.value,K.value&&setTimeout(()=>{B.value&&(B.value.scrollTop=B.value.scrollHeight)},100)}function at(){H.value=[]}function ie(e,t){H.value.push({timestamp:Date.now(),level:e,message:t}),setTimeout(()=>{B.value&&(B.value.scrollTop=B.value.scrollHeight)},50)}function it(){j.updatePanelContext("workflow",{viewType:"status",statusFilter:"completed"})}function rt(e){u.value=e.id,r.setCurrentWorkflow(e.id),j.updatePanelContext("workflow",{selectedWorkflow:e.id,viewType:"workflow-detail",statusFilter:null,templateId:null,executionId:null})}async function ut(){const e=f.currentProject?.id;await r.loadWorkflows(e),d.addNotification({type:"info",title:"åˆ·æ–°æˆåŠŸ",message:"å·¥ä½œæµçŠ¶æ€å·²æ›´æ–°",timeout:2e3})}async function ze(){if(console.log("useTemplate called"),!$.value){console.log("No template selected!"),d.addNotification({type:"warning",title:"è¯·é€‰æ‹©æ¨¡æ¿",message:"è¯·å…ˆä»Žå·¦ä¾§é¢æ¿é€‰æ‹©ä¸€ä¸ªæ¨¡æ¿",timeout:3e3});return}const e=j.panelContext.workflow,t=e?.projectId||f.currentProject?.id;if(!t){console.warn("âš ï¸ useTemplate: no projectId available, creating workflow without project association");const l=await r.createWorkflow({name:$.value.name,description:$.value.description});if(!l){d.addNotification({type:"error",title:"åˆ›å»ºå¤±è´¥",message:"æ— æ³•åˆ›å»ºå·¥ä½œæµ",timeout:3e3});return}await r.addTemplateNodesToWorkflow(l.id,$.value),await r.saveWorkflow(l.id),r.selectWorkflow(l.id),u.value=l.id,j.updatePanelContext("workflow",{selectedWorkflow:l.id,viewType:"workflow-detail",templateId:null}),d.addNotification({type:"success",title:"æ¨¡æ¿åº”ç”¨æˆåŠŸ",message:`å·²åˆ›å»ºå·¥ä½œæµ "${l.name}"`,timeout:3e3});return}console.log("âœ… useTemplate: creating workflow for project:",t);const s=e?.projectName||f.currentProject?.name||"æœªå‘½åé¡¹ç›®";try{const l=await r.createWorkflowForProject(t,$.value,s);if(!l){console.log("â³ useTemplate: workflow creation already in progress"),d.addNotification({type:"info",title:"è¯·ç¨å€™",message:"æ­£åœ¨åˆ›å»ºå·¥ä½œæµ...",timeout:2e3});return}r.selectWorkflow(l.id),u.value=l.id,j.updatePanelContext("workflow",{selectedWorkflow:l.id,viewType:"workflow-detail",templateId:null,projectId:t}),d.addNotification({type:"success",title:"æ¨¡æ¿åº”ç”¨æˆåŠŸ",message:`å·²åˆ›å»ºå·¥ä½œæµ "${l.name}"`,timeout:3e3})}catch(l){console.error("âŒ useTemplate failed:",l),d.addNotification({type:"error",title:"åˆ›å»ºå¤±è´¥",message:l instanceof Error?l.message:"åˆ›å»ºå·¥ä½œæµå¤±è´¥",timeout:5e3})}}function _e(e){return{"novel-parser":"å°è¯´è§£æžå™¨","character-analyzer":"è§’è‰²åˆ†æžå™¨","scene-generator":"åœºæ™¯ç”Ÿæˆå™¨","script-converter":"è„šæœ¬è½¬æ¢å™¨","video-generator":"è§†é¢‘ç”Ÿæˆå™¨"}[e]||e}const ct=v(()=>{if(!u.value)return"é€‰æ‹©å·¥ä½œæµ";const e=L.value.find(t=>t.id===u.value);return e?e.name:"é€‰æ‹©å·¥ä½œæµ"});async function dt(){try{await x(),r.loadProjectWorkflowMap();const e=f.currentProject?.id;await r.loadWorkflows(e);const t=await r.cleanupEmptyWorkflows(e);t>0&&console.log(`ðŸ§¹ Cleaned up ${t} empty workflow(s)`),console.log("ðŸ“‚ WorkflowEditor initialized, workflows loaded:",r.workflows.length,e?`for project ${e}`:"(all projects)");const s=j.panelContext.workflow;s?.viewType==="template"&&s?.templateId&&s?.projectName&&(console.log("ðŸš€ Auto-applying template on mount:",s.templateId,"for project:",s.projectName),await gt(s)),C.value=!0}catch(e){console.error("âŒ WorkflowEditor initialization failed:",e),C.value=!0,d.addNotification({type:"error",title:"åˆå§‹åŒ–å¤±è´¥",message:"å·¥ä½œæµç¼–è¾‘å™¨åŠ è½½å¤±è´¥ï¼Œéƒ¨åˆ†åŠŸèƒ½å¯èƒ½ä¸å¯ç”¨",timeout:5e3})}}function Pe(){M.value=Math.min(M.value+.1,2)}function $e(){M.value=Math.max(M.value-.1,.5)}function Me(){M.value=1,V.value={x:0,y:0}}function pt(e){if(e.ctrlKey||e.metaKey){e.preventDefault();const t=-e.deltaY*.001;M.value=Math.max(.5,Math.min(2,M.value+t))}}function vt(e){(ge.value||e.button===1)&&(e.preventDefault(),fe.value=!0,me.value={x:e.clientX-V.value.x,y:e.clientY-V.value.y})}function ft(e){fe.value&&(V.value={x:e.clientX-me.value.x,y:e.clientY-me.value.y})}function mt(){fe.value=!1}function Ae(e){const s=navigator.platform.toUpperCase().indexOf("MAC")>=0?e.metaKey:e.ctrlKey;if(e.code==="Space"&&!e.repeat){e.preventDefault(),e.stopPropagation(),ge.value=!0;return}if(s&&e.key==="s"&&(e.preventDefault(),u.value&&Fe()),s&&e.key==="n"&&(e.preventDefault(),Be()),s&&(e.key==="+"||e.key==="=")&&(e.preventDefault(),Pe()),s&&e.key==="-"&&(e.preventDefault(),$e()),s&&e.key==="0"&&(e.preventDefault(),Me()),(e.key==="Delete"||e.key==="Backspace")&&k.value&&(e.preventDefault(),be(k.value)),e.key==="Escape"&&(k.value="",R.value=""),s&&e.key==="f"){e.preventDefault();const l=document.querySelector(".node-search .search-input");l&&l.focus()}}function Re(e){e.code==="Space"&&(ge.value=!1)}no(()=>{document.addEventListener("keydown",Ae),document.addEventListener("keyup",Re),dt()});async function gt(e){try{const t=Ie.value.find(l=>l.id===e.templateId);if(!t){console.warn("Template not found:",e.templateId);return}if(!e.projectId){console.error("âŒ autoApplyTemplate: projectId is required"),d.addNotification({type:"error",title:"åˆ›å»ºå¤±è´¥",message:"ç¼ºå°‘é¡¹ç›®ID",timeout:3e3});return}console.log("ðŸš€ autoApplyTemplate: creating workflow for project:",e.projectId);const s=await r.createWorkflowForProject(e.projectId,t,e.projectName||"æœªå‘½åé¡¹ç›®");if(!s){console.log("â³ autoApplyTemplate: workflow creation already in progress"),d.addNotification({type:"info",title:"è¯·ç¨å€™",message:"æ­£åœ¨åˆ›å»ºå·¥ä½œæµ...",timeout:2e3});return}r.selectWorkflow(s.id),u.value=s.id,j.updatePanelContext("workflow",{selectedWorkflow:s.id,viewType:"workflow-detail",templateId:null,projectId:e.projectId,novelId:e.novelId,projectName:e.projectName}),d.addNotification({type:"success",title:"å·¥ä½œæµå·²åˆ›å»º",message:`å·²ä¸ºé¡¹ç›® "${e.projectName}" åˆ›å»ºå·¥ä½œæµï¼Œç‚¹å‡»"è¿è¡Œå·¥ä½œæµ"å¼€å§‹ç”Ÿæˆ`,timeout:5e3})}catch(t){console.error("âŒ autoApplyTemplate failed:",t),d.addNotification({type:"error",title:"åˆ›å»ºå¤±è´¥",message:t instanceof Error?t.message:"åˆ›å»ºå·¥ä½œæµå¤±è´¥",timeout:5e3})}}lo(()=>{document.removeEventListener("keydown",Ae),document.removeEventListener("keyup",Re)}),Ne(()=>r.executionStatus,e=>{e==="completed"?Ye():e==="failed"&&Xe()}),Ne(()=>f.currentProject?.id,async(e,t)=>{C.value&&e!==t&&(console.log("ðŸ”„ Project changed, reloading workflows for project:",e),await r.loadWorkflows(e),u.value="",d.addNotification({type:"info",title:"é¡¹ç›®å·²åˆ‡æ¢",message:"å·¥ä½œæµåˆ—è¡¨å·²æ›´æ–°",timeout:2e3}))}),Ne(()=>j.panelContext.workflow,e=>{if(C.value){if(console.log("ðŸ‘€ WorkflowEditor panelContext changed:",e),e?.selectedWorkflow&&e.selectedWorkflow!==u.value&&(u.value=e.selectedWorkflow,!r.currentWorkflow||r.currentWorkflow.id!==e.selectedWorkflow)){const t=r.selectWorkflow(e.selectedWorkflow);console.log("ðŸ“Œ WorkflowEditor selectWorkflow result:",t,"workflow:",r.currentWorkflow?.name)}e?.templateId&&console.log("ðŸ“‹ Template selected:",e.templateId),e?.executionId&&console.log("ðŸ“Š Execution selected:",e.executionId)}},{deep:!0,immediate:!0});const L=v(()=>r.workflows),_=v(()=>r.currentWorkflow),T=v(()=>r.currentWorkflowNodes),yt=v(()=>r.currentWorkflowConnections),re=v(()=>r.isExecuting),Le=v(()=>r.executionProgress),wt=v(()=>r.executionMessage),P=v(()=>!k.value||!T.value?null:T.value.find(e=>e.id===k.value)||null),kt=v(()=>T.value.filter(e=>e.status==="completed").length),_t=v(()=>T.value.filter(e=>e.status==="running").length),ht=v(()=>T.value.filter(e=>!e.status||e.status==="pending"||e.status==="idle").length);function bt(e){k.value&&e&&_.value&&r.updateNodeName(_.value.id,k.value,e)}function he(e,t){k.value&&_.value&&r.updateNodeConfig(_.value.id,k.value,{[e]:t})}const ue={"novel-parser":{icon:"ðŸ“–",title:"å°è¯´è§£æžå™¨",inputs:[],outputs:["æ–‡æœ¬","ç»“æž„"]},"character-analyzer":{icon:"ðŸ‘¤",title:"è§’è‰²åˆ†æžå™¨",inputs:["æ–‡æœ¬"],outputs:["è§’è‰²ä¿¡æ¯"]},"scene-generator":{icon:"ðŸŽ¬",title:"åœºæ™¯ç”Ÿæˆå™¨",inputs:["ç»“æž„","è§’è‰²ä¿¡æ¯"],outputs:["åœºæ™¯æè¿°"]},"image-generator":{icon:"ðŸŽ¨",title:"AIå›¾ç‰‡ç”Ÿæˆå™¨",inputs:["åœºæ™¯æè¿°"],outputs:["åˆ†é•œå›¾ç‰‡"]},"script-converter":{icon:"ðŸ“",title:"è„šæœ¬è½¬æ¢å™¨",inputs:["åœºæ™¯æè¿°"],outputs:["è„šæœ¬"]},"video-generator":{icon:"ðŸŽ¥",title:"è§†é¢‘ç”Ÿæˆå™¨",inputs:["è„šæœ¬"],outputs:[]}},Oe=[{name:"è¾“å…¥èŠ‚ç‚¹",nodes:[{type:"novel-parser",icon:"ðŸ“–",title:"å°è¯´è§£æžå™¨"}]},{name:"å¤„ç†èŠ‚ç‚¹",nodes:[{type:"character-analyzer",icon:"ðŸ‘¤",title:"è§’è‰²åˆ†æžå™¨"},{type:"scene-generator",icon:"ðŸŽ¬",title:"åœºæ™¯ç”Ÿæˆå™¨"},{type:"image-generator",icon:"ðŸŽ¨",title:"AIå›¾ç‰‡ç”Ÿæˆå™¨"},{type:"script-converter",icon:"ðŸ“",title:"è„šæœ¬è½¬æ¢å™¨"}]},{name:"è¾“å‡ºèŠ‚ç‚¹",nodes:[{type:"video-generator",icon:"ðŸŽ¥",title:"è§†é¢‘ç”Ÿæˆå™¨"}]}],Ue=v(()=>{if(!R.value.trim())return Oe;const e=R.value.toLowerCase();return Oe.map(t=>({...t,nodes:t.nodes.filter(s=>s.title.toLowerCase().includes(e)||s.type.toLowerCase().includes(e))})).filter(t=>t.nodes.length>0)}),xt=v(()=>({transform:`translate(${V.value.x}px, ${V.value.y}px) scale(${M.value})`,transformOrigin:"0 0"}));function Ct(){if(console.log("ðŸ“Œ onWorkflowSelect called, selectedWorkflowId:",u.value),u.value){const e=r.selectWorkflow(u.value);console.log("ðŸ“Œ selectWorkflow result:",e),e?(j.updatePanelContext("workflow",{selectedWorkflow:u.value,viewType:"workflow-detail"}),d.addNotification({type:"info",title:"å·¥ä½œæµå·²é€‰æ‹©",message:`å·²åˆ‡æ¢åˆ°å·¥ä½œæµ "${ct.value}"`,timeout:2e3})):(d.addNotification({type:"error",title:"é€‰æ‹©å¤±è´¥",message:"æ— æ³•æ‰¾åˆ°è¯¥å·¥ä½œæµ",timeout:3e3}),u.value="")}else r.currentWorkflowId=null}function Be(){oe.value="æ–°å»ºå·¥ä½œæµ",se.value="",ne.value="è¯·è¾“å…¥å·¥ä½œæµåç§°",le.value="",J.value=async e=>{if(e){const t=await r.createWorkflow({name:e,description:"æ–°å»ºçš„å·¥ä½œæµ"});t&&(u.value=t.id,r.selectWorkflow(t.id),d.addNotification({type:"success",title:"åˆ›å»ºæˆåŠŸ",message:`å·¥ä½œæµ "${e}" å·²åˆ›å»º`,timeout:2e3}))}},G.value=!0}function Nt(){console.log("ðŸ”§ renameCurrentWorkflow called, selectedWorkflowId:",u.value),u.value?Dt(u.value):(console.warn("âš ï¸ No workflow selected"),d.addNotification({type:"warning",title:"è¯·å…ˆé€‰æ‹©å·¥ä½œæµ",message:"è¯·ä»Žä¸‹æ‹‰åˆ—è¡¨ä¸­é€‰æ‹©ä¸€ä¸ªå·¥ä½œæµ",timeout:2e3}))}function It(){u.value&&jt(u.value)}function Wt(e){J.value&&J.value(e)}async function Tt(){const e=await r.createDefaultWorkflow();e&&(u.value=e.id)}async function jt(e){const t=L.value.find(s=>s.id===e);t&&setTimeout(async()=>{confirm(`ç¡®å®šè¦åˆ é™¤å·¥ä½œæµ "${t.name}" å—ï¼Ÿ`)&&await r.deleteWorkflow(e)&&(u.value===e&&(u.value=""),d.addNotification({type:"success",title:"åˆ é™¤æˆåŠŸ",message:`å·¥ä½œæµ "${t.name}" å·²åˆ é™¤`,timeout:2e3}))},100)}function Dt(e){console.log("ðŸ”§ renameWorkflow called with id:",e);const t=L.value.find(s=>s.id===e);if(!t){console.log("âš ï¸ Workflow not found in workflows list"),console.log("ðŸ“‹ Available workflows:",L.value.map(s=>({id:s.id,name:s.name})));return}console.log("âœ… Found workflow:",t.name),setTimeout(()=>{console.log("ðŸ“ Opening input dialog for rename"),oe.value="é‡å‘½åå·¥ä½œæµ",se.value="",ne.value="è¯·è¾“å…¥æ–°çš„å·¥ä½œæµåç§°",le.value=t.name,J.value=async s=>{if(console.log("ðŸ“ Rename callback called with:",s),s&&s!==t.name){const l=await r.renameWorkflow(e,s);console.log("ðŸ“ Rename result:",l),l.success?d.addNotification({type:"success",title:"é‡å‘½åæˆåŠŸ",message:`å·¥ä½œæµå·²é‡å‘½åä¸º "${l.name}"`,timeout:2e3}):d.addNotification({type:"error",title:"é‡å‘½åå¤±è´¥",message:"æ— æ³•é‡å‘½åå·¥ä½œæµï¼Œè¯·é‡è¯•",timeout:3e3})}},G.value=!0,console.log("ðŸ“ inputDialogVisible set to true")},100)}async function Fe(){_.value&&await r.saveWorkflow(_.value.id)&&d.addNotification({type:"success",title:"ä¿å­˜æˆåŠŸ",message:"å·¥ä½œæµå·²ä¿å­˜",timeout:2e3})}async function Et(){if(!_.value){d.addNotification({type:"warning",title:"æ— æ³•æ‰§è¡Œ",message:"è¯·å…ˆé€‰æ‹©ä¸€ä¸ªå·¥ä½œæµ",timeout:3e3});return}if(T.value.length===0){d.addNotification({type:"warning",title:"æ— æ³•æ‰§è¡Œ",message:"è¯·å…ˆæ·»åŠ ä¸€äº›èŠ‚ç‚¹åˆ°å·¥ä½œæµä¸­",timeout:3e3});return}const e={};if(f.currentProject){e.projectId=f.currentProject.id||f.currentProject.projectId;let t=f.currentProject.novelId;if(!t){const s=localStorage.getItem("novel_anime_current_novel_id");s&&(t=s,console.log("ðŸ“¦ [WorkflowEditor] ä»Ž localStorage èŽ·å– novelId:",t))}e.novelId=t,f.currentProject.novel&&(e.title=f.currentProject.novel.title,e.chapters=f.currentProject.novel.chapters),f.currentProject.characters&&(e.characters=f.currentProject.characters),console.log("ðŸ“Š [WorkflowEditor] initialData:",{projectId:e.projectId,novelId:e.novelId,hasChapters:!!(e.chapters&&Array.isArray(e.chapters)&&e.chapters.length>0)})}try{N.value=null,U.value=!1,H.value=[],K.value=!0,ie("info",`å¼€å§‹æ‰§è¡Œå·¥ä½œæµ: ${_.value.name}`),ie("info",`èŠ‚ç‚¹æ•°é‡: ${T.value.length}`),d.addNotification({type:"info",title:"å¼€å§‹æ‰§è¡Œ",message:`å·¥ä½œæµ "${_.value.name}" å¼€å§‹æ‰§è¡Œ`,timeout:2e3}),S.value=await r.executeWorkflow(_.value.id,e),ie("success","å·¥ä½œæµæ‰§è¡Œå®Œæˆ"),Ye()}catch(t){const s=t instanceof Error?t.message:"æœªçŸ¥é”™è¯¯";ie("error",`æ‰§è¡Œå¤±è´¥: ${s}`),Xe(s)}}async function Ye(){const e=r.getExecutionStatus(S.value);if(e){const t=e.endTime&&e.startTime?e.endTime-e.startTime:0,s=e.context?.nodeResults,l={};s&&(typeof s.forEach=="function"?s.forEach((A,E)=>{l[E]=A}):typeof s=="object"&&Object.assign(l,s)),console.log("ðŸ“Š Execution nodeResults:",l),console.log("ðŸ“Š NodeResults keys:",Object.keys(l));const D={status:"completed",nodeResults:s,nodeResultsData:l,duration:t};if(N.value=D,U.value=!0,console.log("âœ… Execution completed, showing results panel:",D),f.currentProject){const A=f.currentProject.id||f.currentProject.projectId;try{console.log("ðŸ“ Updating project status to completed for:",A);const E=await apiService.axiosInstance.patch(`/project/${A}`,{status:"completed"});E.data&&E.data.success?(f.currentProject.status="completed",console.log("âœ… Project status updated to completed in backend")):(console.warn("âš ï¸ Backend returned unsuccessful response:",E.data),f.currentProject.status="completed")}catch(E){console.error("âŒ Failed to update project status to backend:",E),f.currentProject.status="completed"}}}else console.warn("âš ï¸ Execution not found:",S.value);d.addNotification({type:"success",title:"æ‰§è¡Œå®Œæˆ",message:"å·¥ä½œæµæ‰§è¡ŒæˆåŠŸå®Œæˆ",timeout:3e3})}function St(){console.log("ðŸ” viewGeneratedContent called"),console.log("ðŸ“Š Current executionResults:",N.value),U.value=!1,console.log("âœ… Navigating to /preview..."),te.push("/preview").then(()=>{console.log("âœ… Navigation to /preview completed")}).catch(e=>{console.error("âŒ Navigation to /preview failed:",e),d.addNotification({type:"error",title:"å¯¼èˆªå¤±è´¥",message:"æ— æ³•è·³è½¬åˆ°é¢„è§ˆé¡µé¢",timeout:3e3})})}function zt(){console.log("exportResults called"),d.addNotification({type:"success",title:"å¯¼å‡ºæˆåŠŸ",message:"ç”Ÿæˆå†…å®¹å·²æ‰“åŒ…å¯¼å‡ºåˆ°æœ¬åœ°",timeout:3e3})}function Pt(){console.log("backToDashboard called"),U.value=!1,f.currentProject&&(f.currentProject.status="completed"),f.clearCurrentProject(),localStorage.removeItem("novel_anime_current_novel_id"),localStorage.removeItem("novel_anime_current_novel_title"),te.push("/dashboard"),d.addNotification({type:"success",title:"é¡¹ç›®å·²å®Œæˆ",message:"æ­å–œï¼æ‚¨çš„å°è¯´å·²æˆåŠŸè½¬æ¢ä¸ºåŠ¨æ¼«",timeout:5e3})}function Xe(e){const t=r.error;d.addNotification({type:"error",title:"æ‰§è¡Œå¤±è´¥",message:e||t?.message||"å·¥ä½œæµæ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯",timeout:5e3})}function $t(){S.value&&(r.cancelExecution(S.value),S.value=null,d.addNotification({type:"info",title:"å·²å–æ¶ˆ",message:"å·¥ä½œæµæ‰§è¡Œå·²å–æ¶ˆ",timeout:2e3}))}function Mt(){h.value=r.validateCurrentWorkflow()}function At(e,t){e.dataTransfer?.setData("nodeType",t)}function Rt(e){if(!_.value)return;e.preventDefault();const t=e.dataTransfer?.getData("nodeType");if(!t)return;const l=e.currentTarget.getBoundingClientRect(),D=e.clientX-l.left-75,A=e.clientY-l.top-50,E=ue[t]?.title||t;r.addNode(_.value.id,t,E,{x:Math.max(0,D),y:Math.max(0,A)})}function be(e){_.value&&confirm("ç¡®å®šè¦åˆ é™¤è¿™ä¸ªèŠ‚ç‚¹å—ï¼Ÿ")&&(r.removeNode(_.value.id,e),k.value===e&&(k.value=""))}function Lt(e){k.value=e.id,I.value=""}function Ke(e){k.value=e.id,He.value=e,oe.value="ç¼–è¾‘èŠ‚ç‚¹",se.value=`èŠ‚ç‚¹ç±»åž‹: ${_e(e.type)}`,ne.value="è¯·è¾“å…¥èŠ‚ç‚¹åç§°",le.value=e.name,J.value=t=>{t&&t!==e.name&&_.value&&(r.updateNodeName(_.value.id,e.id,t),d.addNotification({type:"success",title:"èŠ‚ç‚¹å·²æ›´æ–°",message:`èŠ‚ç‚¹åç§°å·²æ”¹ä¸º "${t}"`,timeout:2e3}))},G.value=!0}function Ot(e,t){const s=e.clientX-t.position.x,l=e.clientY-t.position.y;function D(E){if(!_.value)return;const Vt=E.clientX-s,qt=E.clientY-l;r.updateNodePosition(_.value.id,t.id,{x:Math.max(0,Vt),y:Math.max(0,qt)})}function A(){document.removeEventListener("mousemove",D),document.removeEventListener("mouseup",A)}document.addEventListener("mousemove",D),document.addEventListener("mouseup",A)}function xe(e){return ue[e]?.icon||"âš™ï¸"}function Ut(e){return ue[e]?.inputs||[]}function Bt(e){return ue[e]?.outputs||[]}function Ft(e){const t=T.value.find(s=>s.id===e.fromNodeId);return t?t.position.x+150:0}function Yt(e){const t=T.value.find(s=>s.id===e.fromNodeId);return t?t.position.y+30:0}function Xt(e){const t=T.value.find(s=>s.id===e.toNodeId);return t?t.position.x:0}function Kt(e){const t=T.value.find(s=>s.id===e.toNodeId);return t?t.position.y+30:0}return(e,t)=>(n(),a("div",uo,[C.value?w("",!0):(n(),a("div",co,[...t[14]||(t[14]=[o("div",{class:"loading-spinner"},"æ­£åœ¨åŠ è½½å·¥ä½œæµç¼–è¾‘å™¨...",-1)])])),o("div",po,[z.value==="workflow-detail"||z.value==="new"||!z.value?(n(),a("div",vo,[o("div",fo,[o("div",mo,[t[15]||(t[15]=o("label",{for:"workflow-select"},"å·¥ä½œæµ:",-1)),Ve(o("select",{id:"workflow-select","onUpdate:modelValue":t[0]||(t[0]=s=>u.value=s),onChange:Ct,class:"workflow-select"},[o("option",go,i(L.value.length===0?"æš‚æ— å·¥ä½œæµ":"é€‰æ‹©å·¥ä½œæµ"),1),(n(!0),a(b,null,W(L.value,s=>(n(),a("option",{key:s.id,value:s.id},i(s.name),9,yo))),128))],544),[[Ht,u.value]])]),u.value?(n(),a("div",wo,[o("button",{onClick:Nt,class:"icon-btn",title:"é‡å‘½åå·¥ä½œæµ"},[(n(),m(g(y(p).edit),{size:16}))]),o("button",{onClick:It,class:"icon-btn icon-btn-danger",title:"åˆ é™¤å·¥ä½œæµ"},[(n(),m(g(y(p).trash),{size:16}))])])):w("",!0)]),o("div",ko,[o("button",{onClick:Be,class:"btn btn-secondary"},[(n(),m(g(y(p).plus),{size:16})),t[16]||(t[16]=o("span",null,"æ–°å»ºå·¥ä½œæµ",-1))]),o("button",{onClick:Tt,class:"btn btn-secondary"},"é»˜è®¤å·¥ä½œæµ"),o("button",{onClick:Fe,class:"btn btn-primary",disabled:!u.value},[(n(),m(g(y(p).save),{size:16})),t[17]||(t[17]=o("span",null,"ä¿å­˜",-1))],8,_o),o("button",{onClick:Et,class:"btn btn-success",disabled:!u.value||re.value},[(n(),m(g(re.value?y(p).refresh:y(p).play),{size:16})),o("span",null,i(re.value?"æ‰§è¡Œä¸­...":"è¿è¡Œ"),1)],8,ho)])])):z.value==="status"?(n(),a(b,{key:1},[o("h2",null,i(ke.value),1),o("p",null,i(We.value),1),o("div",{class:"header-actions"},[o("button",{class:"btn btn-secondary",onClick:ut},"åˆ·æ–°çŠ¶æ€")])],64)):z.value==="template"?(n(),a(b,{key:2},[o("h2",null,i($.value?.name||"æ¨¡æ¿è¯¦æƒ…"),1),o("p",null,i($.value?.description||"æŸ¥çœ‹æ¨¡æ¿é…ç½®"),1),o("div",{class:"header-actions"},[o("button",{class:"btn btn-primary",onClick:ze},"ä½¿ç”¨æ­¤æ¨¡æ¿")])],64)):z.value==="execution"?(n(),a(b,{key:3},[o("h2",null,i(ye.value||"æ‰§è¡Œè®°å½•"),1),o("p",null,i(Z.value?`æ‰§è¡ŒäºŽ ${Z.value}`:"æŸ¥çœ‹å·¥ä½œæµæ‰§è¡ŒåŽ†å²"),1)],64)):w("",!0)]),re.value?(n(),a("div",bo,[o("div",xo,[o("div",Co,[(n(),m(g(y(p).play),{size:16,class:"progress-icon"})),o("span",null,i(wt.value),1)]),o("div",No,[o("button",{onClick:lt,class:"btn btn-small btn-secondary"},i(K.value?"éšè—æ—¥å¿—":"æŸ¥çœ‹æ—¥å¿—"),1),o("button",{onClick:$t,class:"btn btn-small btn-danger"},"å–æ¶ˆ")])]),o("div",Io,[o("div",Wo,[o("div",To,[o("div",{class:"progress-fill",style:ce({width:Le.value+"%"})},null,4)]),o("div",jo,i(Le.value)+"%",1)]),o("div",Do,[o("div",Eo,[t[18]||(t[18]=o("span",{class:"status-label"},"æ€»èŠ‚ç‚¹:",-1)),o("span",So,i(T.value.length),1)]),o("div",zo,[t[19]||(t[19]=o("span",{class:"status-label"},"å·²å®Œæˆ:",-1)),o("span",Po,i(kt.value),1)]),o("div",$o,[t[20]||(t[20]=o("span",{class:"status-label"},"æ‰§è¡Œä¸­:",-1)),o("span",Mo,i(_t.value),1)]),o("div",Ao,[t[21]||(t[21]=o("span",{class:"status-label"},"å¾…æ‰§è¡Œ:",-1)),o("span",Ro,i(ht.value),1)])])]),K.value?(n(),a("div",Lo,[o("div",{class:"logs-header"},[t[22]||(t[22]=o("h4",null,"æ‰§è¡Œæ—¥å¿—",-1)),o("button",{onClick:at,class:"btn btn-small"},"æ¸…ç©º")]),o("div",{class:"logs-content",ref_key:"logsContainer",ref:B},[(n(!0),a(b,null,W(H.value,(s,l)=>(n(),a("div",{key:l,class:O(["log-entry",`log-${s.level}`])},[o("span",Oo,i(Ee(s.timestamp)),1),o("span",Uo,i(s.level.toUpperCase()),1),o("span",Bo,i(s.message),1)],2))),128)),H.value.length===0?(n(),a("div",Fo," æš‚æ— æ—¥å¿— ")):w("",!0)],512)])):w("",!0)])):w("",!0),U.value&&N.value?(n(),a("div",{key:2,class:"execution-results-panel",onClick:t[2]||(t[2]=q(s=>U.value=!1,["self"]))},[o("div",Yo,[o("div",Xo,[t[23]||(t[23]=o("h3",null,"æ‰§è¡Œç»“æžœ",-1)),o("div",Ko,[o("button",{onClick:it,class:"btn btn-small btn-secondary"}," æŸ¥çœ‹åŽ†å² "),o("button",{onClick:t[1]||(t[1]=s=>U.value=!1),class:"btn btn-small"},"å…³é—­")])]),o("div",{class:O(["result-status",N.value.status])},[(n(),m(g(N.value.status==="completed"?y(p).check:y(p).xCircle),{size:24})),N.value.status==="completed"?(n(),a("span",Vo,"æ‰§è¡ŒæˆåŠŸ")):(n(),a("span",qo,"æ‰§è¡Œå¤±è´¥"))],2),o("div",Ho,[o("div",Go,[t[24]||(t[24]=o("span",{class:"stat-label"},"æ‰§è¡Œæ—¶é•¿",-1)),o("span",Jo,i(tt(N.value.duration)),1)]),o("div",Zo,[t[25]||(t[25]=o("span",{class:"stat-label"},"å¤„ç†èŠ‚ç‚¹",-1)),o("span",Qo,i(N.value.nodeResults?.size||0)+" ä¸ª",1)]),o("div",es,[t[26]||(t[26]=o("span",{class:"stat-label"},"å®Œæˆæ—¶é—´",-1)),o("span",ts,i(De(Date.now())),1)])]),o("div",os,[t[27]||(t[27]=o("h4",null,"èŠ‚ç‚¹æ‰§è¡Œè¯¦æƒ…",-1)),o("div",ss,[(n(!0),a(b,null,W(T.value,s=>(n(),a("div",{key:s.id,class:O(["node-result-item",{"has-result":Se(s.id)}])},[o("div",ns,[o("span",ls,i(xe(s.type)),1),o("span",as,i(s.name),1),o("span",{class:O(["node-status-badge",`status-${s.status||"idle"}`])},i(ot(s.status)),3)]),Se(s.id)?(n(),a("div",is,[o("pre",null,i(nt(s.id)),1)])):w("",!0)],2))),128))])]),N.value.status==="completed"?(n(),a("div",rs,[o("button",{class:"btn btn-primary",onClick:St},[(n(),m(g(y(p).eye),{size:16})),t[28]||(t[28]=de(" æŸ¥çœ‹ç”Ÿæˆå†…å®¹ ",-1))]),o("button",{class:"btn btn-secondary",onClick:zt},[(n(),m(g(y(p).download),{size:16})),t[29]||(t[29]=de(" å¯¼å‡ºç»“æžœ ",-1))]),o("button",{class:"btn btn-secondary",onClick:Pt},[(n(),m(g(y(p).home),{size:16})),t[30]||(t[30]=de(" è¿”å›žé¡¹ç›®æ¦‚è§ˆ ",-1))])])):w("",!0)])])):w("",!0),o("div",us,[z.value==="status"?(n(),a("div",cs,[o("div",ds,[(n(!0),a(b,null,W(Te.value,s=>(n(),a("div",{key:s.id,class:"status-item",onClick:l=>rt(s)},[o("div",{class:O(["status-icon",`status-icon--${s.status}`])},[(n(),m(g(je(s.status)),{size:20}))],2),o("div",vs,[o("div",fs,i(s.name),1),o("div",ms,i(s.description||"æš‚æ— æè¿°"),1)]),o("div",gs,i(De(s.updatedAt)),1)],8,ps))),128)),Te.value.length===0?(n(),a("div",ys,[(n(),m(g(y(p).inbox),{size:48})),o("span",null,"æš‚æ— "+i(ke.value)+"çš„å·¥ä½œæµ",1)])):w("",!0)])])):z.value==="template"?(n(),a("div",ws,[o("div",ks,[o("div",_s,[(n(),m(g(y(p).layers),{size:64}))]),o("div",hs,[t[31]||(t[31]=o("h4",null,"åŒ…å«èŠ‚ç‚¹",-1)),o("div",bs,[(n(!0),a(b,null,W(et.value,s=>(n(),a("div",{class:"node-preview",key:s},[o("span",xs,i(xe(s)),1),o("span",null,i(_e(s)),1)]))),128))])]),o("div",{class:"template-actions",style:{"margin-top":"20px"}},[o("button",{class:"btn btn-primary",onClick:ze},"ä½¿ç”¨æ­¤æ¨¡æ¿")])])])):z.value==="execution"?(n(),a("div",Cs,[o("div",Ns,[o("div",Is,[o("div",Ws,[t[32]||(t[32]=o("h3",null,"æ‰§è¡Œè¯¦æƒ…",-1)),o("span",Ts,"ID: "+i(Qe.value),1)]),o("div",js,[o("div",Ds,[t[33]||(t[33]=o("span",{class:"info-label"},"çŠ¶æ€",-1)),o("span",{class:O(["info-value status-badge",`status-badge--${we.value}`])},[(n(),m(g(je(we.value)),{size:14})),de(" "+i(st(we.value)),1)],2)]),o("div",Es,[t[34]||(t[34]=o("span",{class:"info-label"},"æ‰§è¡Œæ—¶é—´",-1)),o("span",Ss,i(Z.value),1)]),o("div",zs,[t[35]||(t[35]=o("span",{class:"info-label"},"å·¥ä½œæµ",-1)),o("span",Ps,i(ye.value),1)]),o("div",$s,[t[36]||(t[36]=o("span",{class:"info-label"},"èŠ‚ç‚¹æ•°é‡",-1)),o("span",Ms,i(Ge.value||0)+" ä¸ª",1)])]),o("div",As,[t[38]||(t[38]=o("h4",null,"æ‰§è¡Œæ—¶é—´çº¿",-1)),o("div",Rs,[(n(!0),a(b,null,W(Je.value,(s,l)=>(n(),a("div",{key:l,class:"timeline-item"},[t[37]||(t[37]=o("div",{class:"timeline-marker"},null,-1)),o("div",Ls,[o("span",Os,i(Ee(s.timestamp)),1),o("span",Us,i(s.message),1)])]))),128))])])])])])):(n(),a("div",Bs,[o("div",Fs,[t[42]||(t[42]=o("h3",null,"èŠ‚ç‚¹åº“",-1)),o("div",Ys,[(n(),m(g(y(p).search),{size:14,class:"search-icon"})),Ve(o("input",{type:"text","onUpdate:modelValue":t[3]||(t[3]=s=>R.value=s),placeholder:"æœç´¢èŠ‚ç‚¹...",class:"search-input",onKeydown:t[4]||(t[4]=Jt(s=>R.value="",["esc"]))},null,544),[[Gt,R.value]]),R.value?(n(),a("button",{key:0,onClick:t[5]||(t[5]=s=>R.value=""),class:"search-clear"},[(n(),m(g(y(p).x),{size:12}))])):w("",!0)]),o("div",Xs,[(n(!0),a(b,null,W(Ue.value,s=>(n(),a("div",{class:"category",key:s.name},[o("h4",null,i(s.name),1),(n(!0),a(b,null,W(s.nodes,l=>(n(),a("div",{key:l.type,class:"node-item",draggable:"true",onDragstart:D=>At(D,l.type)},[o("span",Vs,i(l.icon),1),t[39]||(t[39]=o("span",{class:"node-item-divider"},null,-1)),o("span",qs,i(l.title),1)],40,Ks))),128))]))),128)),Ue.value.length===0?(n(),a("div",Hs,[(n(),m(g(y(p).search),{size:32})),t[40]||(t[40]=o("p",null,"æœªæ‰¾åˆ°åŒ¹é…çš„èŠ‚ç‚¹",-1))])):w("",!0)]),_.value?(n(),a("div",Gs,[t[41]||(t[41]=o("h4",null,"å·¥ä½œæµéªŒè¯",-1)),o("button",{onClick:Mt,class:"btn btn-small"},"éªŒè¯å·¥ä½œæµ"),h.value?(n(),a("div",Js,[h.value.isValid?(n(),a("div",Zs," âœ… å·¥ä½œæµéªŒè¯é€šè¿‡ ")):(n(),a("div",Qs,[(n(!0),a(b,null,W(h.value.errors,s=>(n(),a("div",{key:s.message,class:"error-item"}," âŒ "+i(s.message),1))),128))])),h.value.warnings.length>0?(n(),a("div",en,[(n(!0),a(b,null,W(h.value.warnings,s=>(n(),a("div",{key:s.message,class:"warning-item"}," âš ï¸ "+i(s.message),1))),128))])):w("",!0)])):w("",!0)])):w("",!0)]),o("div",tn,[o("div",{class:"workflow-canvas",onDrop:Rt,onDragover:t[12]||(t[12]=q(()=>{},["prevent"])),onWheel:pt,onMousedown:vt,onMousemove:ft,onMouseup:mt},[o("div",on,[o("button",{onClick:Pe,class:"control-btn",title:"æ”¾å¤§"},[(n(),m(g(y(p).plus),{size:14}))]),o("button",{onClick:$e,class:"control-btn",title:"ç¼©å°"},[(n(),m(g(y(p).minus),{size:14}))]),o("span",sn,i(Math.round(M.value*100))+"%",1),o("button",{onClick:Me,class:"control-btn",title:"é‡ç½®"},[(n(),m(g(y(p).maximize),{size:14}))])]),_.value?(n(),a("div",{key:1,class:"canvas-grid",style:ce(xt.value)},[(n(!0),a(b,null,W(T.value,s=>(n(),a("div",{key:s.id,class:O(["workflow-node",{"node-running":s.status==="running","node-completed":s.status==="completed","node-error":s.status==="error","node-pending":s.status==="pending","node-selected":k.value===s.id}]),style:ce({left:s.position.x+"px",top:s.position.y+"px"}),onMousedown:l=>Ot(l,s),onClick:q(l=>Lt(s),["stop"]),onDblclick:q(l=>Ke(s),["stop"])},[s.status&&s.status!=="idle"?(n(),a("div",an,[s.status==="running"?(n(),m(g(y(p).refresh),{key:0,size:12,class:"status-icon spinning"})):s.status==="completed"?(n(),m(g(y(p).check),{key:1,size:12,class:"status-icon"})):s.status==="error"?(n(),m(g(y(p).xCircle),{key:2,size:12,class:"status-icon"})):s.status==="pending"?(n(),m(g(y(p).clock),{key:3,size:12,class:"status-icon"})):w("",!0)])):w("",!0),o("div",rn,[o("span",un,i(xe(s.type)),1),o("span",cn,i(s.name),1),o("button",{onClick:q(l=>Ke(s),["stop"]),class:"node-edit",title:"ç¼–è¾‘èŠ‚ç‚¹"},"âœŽ",8,dn),o("button",{onClick:q(l=>be(s.id),["stop"]),class:"node-remove",title:"åˆ é™¤èŠ‚ç‚¹"},"Ã—",8,pn)]),o("div",vn,[o("div",fn,[(n(!0),a(b,null,W(Ut(s.type),l=>(n(),a("div",{key:l,class:"input-port"}," â— "+i(l),1))),128))]),o("div",mn,[(n(!0),a(b,null,W(Bt(s.type),l=>(n(),a("div",{key:l,class:"output-port"},i(l)+" â— ",1))),128))])]),s.config&&Object.keys(s.config).length>0?(n(),a("div",gn,[(n(!0),a(b,null,W(s.config,(l,D)=>(n(),a("div",{key:D,class:"config-item"},i(D)+": "+i(l),1))),128))])):w("",!0),s.status==="running"&&s.progress!==void 0?(n(),a("div",yn,[o("div",wn,[o("div",{class:"node-progress-fill",style:ce({width:s.progress+"%"})},null,4)]),o("span",kn,i(s.progress)+"%",1)])):w("",!0)],46,ln))),128)),(n(),a("svg",_n,[(n(!0),a(b,null,W(yt.value,s=>(n(),a("line",{key:s.id,x1:Ft(s),y1:Yt(s),x2:Xt(s),y2:Kt(s),stroke:"rgba(255,255,255,0.6)","stroke-width":"2"},null,8,hn))),128))]))],4)):(n(),a("div",nn,[...t[43]||(t[43]=[o("div",{class:"empty-message"},[o("h3",null,"è¯·é€‰æ‹©æˆ–åˆ›å»ºä¸€ä¸ªå·¥ä½œæµ"),o("p",null,"ä»Žä¸Šæ–¹é€‰æ‹©çŽ°æœ‰å·¥ä½œæµï¼Œæˆ–åˆ›å»ºæ–°çš„å·¥ä½œæµå¼€å§‹ç¼–è¾‘")],-1)])])),P.value&&_.value?(n(),a("div",bn,[o("div",xn,[t[44]||(t[44]=o("h4",null,"èŠ‚ç‚¹å±žæ€§",-1)),o("button",{class:"close-btn",onClick:t[6]||(t[6]=s=>k.value=""),title:"å…³é—­"},"Ã—")]),o("div",Cn,[o("div",Nn,[t[45]||(t[45]=o("label",null,"èŠ‚ç‚¹åç§°",-1)),o("input",{type:"text",value:P.value.name,onChange:t[7]||(t[7]=s=>bt(s.target.value)),class:"property-input"},null,40,In)]),o("div",Wn,[t[46]||(t[46]=o("label",null,"èŠ‚ç‚¹ç±»åž‹",-1)),o("div",Tn,i(_e(P.value.type)),1)]),o("div",jn,[t[47]||(t[47]=o("label",null,"ä½ç½®",-1)),o("div",Dn,[o("span",null,"X: "+i(Math.round(P.value.position.x)),1),o("span",null,"Y: "+i(Math.round(P.value.position.y)),1)])]),o("div",En,[t[48]||(t[48]=o("label",null,"çŠ¶æ€",-1)),o("div",{class:O(["property-value status-tag",`status-${P.value.status||"idle"}`])},i(P.value.status||"idle"),3)]),P.value.type==="novel-parser"?(n(),a("div",Sn,[t[50]||(t[50]=o("label",null,"è§£æžæ¨¡å¼",-1)),o("select",{class:"property-input",onChange:t[8]||(t[8]=s=>he("parseMode",s.target.value))},[...t[49]||(t[49]=[o("option",{value:"auto"},"è‡ªåŠ¨æ£€æµ‹",-1),o("option",{value:"chapter"},"æŒ‰ç« èŠ‚",-1),o("option",{value:"paragraph"},"æŒ‰æ®µè½",-1)])],32)])):w("",!0),P.value.type==="character-analyzer"?(n(),a("div",zn,[t[52]||(t[52]=o("label",null,"åˆ†æžæ·±åº¦",-1)),o("select",{class:"property-input",onChange:t[9]||(t[9]=s=>he("depth",s.target.value))},[...t[51]||(t[51]=[o("option",{value:"basic"},"åŸºç¡€",-1),o("option",{value:"detailed"},"è¯¦ç»†",-1),o("option",{value:"comprehensive"},"å…¨é¢",-1)])],32)])):w("",!0),P.value.type==="scene-generator"?(n(),a("div",Pn,[t[54]||(t[54]=o("label",null,"åœºæ™¯é£Žæ ¼",-1)),o("select",{class:"property-input",onChange:t[10]||(t[10]=s=>he("style",s.target.value))},[...t[53]||(t[53]=[o("option",{value:"anime"},"åŠ¨æ¼«é£Žæ ¼",-1),o("option",{value:"realistic"},"å†™å®žé£Žæ ¼",-1),o("option",{value:"cartoon"},"å¡é€šé£Žæ ¼",-1)])],32)])):w("",!0),o("div",$n,[o("button",{class:"btn btn-small btn-danger",onClick:t[11]||(t[11]=s=>be(P.value.id))}," åˆ é™¤èŠ‚ç‚¹ ")])])])):w("",!0)],32)])]))]),ao(io,{visible:G.value,"onUpdate:visible":t[13]||(t[13]=s=>G.value=s),title:oe.value,message:se.value,placeholder:ne.value,"default-value":le.value,onConfirm:Wt},null,8,["visible","title","message","placeholder","default-value"])]))}}),Kn=to(Mn,[["__scopeId","data-v-59435512"]]);export{Kn as default};
