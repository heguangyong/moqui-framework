import{withModifiers as Se,vModelRadio as A,vModelText as W,vModelCheckbox as q,vModelSelect as Pe}from"./vue.runtime.esm-bundler-tGj6Om4U.js";import{i as b,_ as Z,u as Ce,e as Ie,c as Ee,d as Ne}from"./_plugin-vue_export-helper-BFgqyxDe.js";import{V as Te}from"./ViewHeader-DsFMPudV.js";import{I as ee,r as y,w as H,j as c,s as S,k as o,l as e,q as C,p as w,A as P,u as k,v as x,y as m,d as T,x as O,B as Y,C as Fe,K as ze,D as X,E as Ue,F as G,z as Q}from"./runtime-core.esm-bundler-8-XbLWPr.js";import"./pinia-Be3yrKEl.js";import"./preload-helper-CmsKOCeN.js";const Ve={class:"export-dialog"},Me={class:"dialog-content"},De={class:"form-group"},je={class:"format-options"},Ae={class:"format-option"},Oe={class:"format-label"},Le={class:"format-option"},Be={class:"format-label"},Je={class:"format-option"},Re={class:"format-label"},qe={class:"form-group"},He={class:"range-options"},Ke={class:"range-option"},We={class:"range-option"},Xe={class:"range-option"},Ge={key:0,class:"custom-range"},Qe=["max"],Ye=["max"],Ze={class:"form-group"},et={class:"export-options"},tt={class:"option-checkbox"},st={key:0,class:"option-checkbox"},at={class:"option-checkbox"},ot={class:"form-group"},lt={class:"dialog-footer"},nt=ee({__name:"ExportDialog",props:{visible:{type:Boolean},contentType:{},totalItems:{}},emits:["update:visible","export"],setup(v,{emit:l}){const t=v,s=l,r=y("json"),n=y("all"),i=y(1),d=y(t.totalItems),$=y(!0),I=y(!1),z=y(!0),_=y("");H(()=>t.totalItems,F=>{d.value=F}),H(()=>t.contentType,F=>{_.value=F==="scene"?"scenes":"storyboards"},{immediate:!0});function h(){s("update:visible",!1)}function N(){const F={format:r.value,range:n.value,customStart:n.value==="custom"?i.value:void 0,customEnd:n.value==="custom"?d.value:void 0,includeMetadata:$.value,includeTimestamps:I.value,openAfterExport:z.value,fileName:_.value||(t.contentType==="scene"?"scenes":"storyboards")};s("export",F)}return(F,a)=>v.visible?(o(),c("div",{key:0,class:"export-dialog-overlay",onClick:Se(h,["self"])},[e("div",Ve,[e("div",{class:"dialog-header"},[a[12]||(a[12]=e("h3",null,"å¯¼å‡ºå†…å®¹",-1)),e("button",{onClick:h,class:"close-btn"},"Ã—")]),e("div",Me,[e("div",De,[a[16]||(a[16]=e("label",null,"å¯¼å‡ºæ ¼å¼",-1)),e("div",je,[e("label",Ae,[C(e("input",{type:"radio","onUpdate:modelValue":a[0]||(a[0]=p=>r.value=p),value:"json"},null,512),[[A,r.value]]),e("span",Oe,[(o(),w(k(x(b).fileText),{size:20})),a[13]||(a[13]=P(" JSON æ•°æ® ",-1))])]),e("label",Le,[C(e("input",{type:"radio","onUpdate:modelValue":a[1]||(a[1]=p=>r.value=p),value:"text"},null,512),[[A,r.value]]),e("span",Be,[(o(),w(k(x(b).fileText),{size:20})),a[14]||(a[14]=P(" æ–‡æœ¬æ–‡ä»¶ ",-1))])]),e("label",Je,[C(e("input",{type:"radio","onUpdate:modelValue":a[2]||(a[2]=p=>r.value=p),value:"images"},null,512),[[A,r.value]]),e("span",Re,[(o(),w(k(x(b).image),{size:20})),a[15]||(a[15]=P(" å›¾ç‰‡åºåˆ— ",-1))])])])]),e("div",qe,[a[20]||(a[20]=e("label",null,"å¯¼å‡ºèŒƒå›´",-1)),e("div",He,[e("label",Ke,[C(e("input",{type:"radio","onUpdate:modelValue":a[3]||(a[3]=p=>n.value=p),value:"all"},null,512),[[A,n.value]]),P(" å…¨éƒ¨ ("+m(v.totalItems)+" é¡¹) ",1)]),e("label",We,[C(e("input",{type:"radio","onUpdate:modelValue":a[4]||(a[4]=p=>n.value=p),value:"current"},null,512),[[A,n.value]]),a[17]||(a[17]=P(" å½“å‰é¡¹ ",-1))]),e("label",Xe,[C(e("input",{type:"radio","onUpdate:modelValue":a[5]||(a[5]=p=>n.value=p),value:"custom"},null,512),[[A,n.value]]),a[18]||(a[18]=P(" è‡ªå®šä¹‰èŒƒå›´ ",-1))])]),n.value==="custom"?(o(),c("div",Ge,[C(e("input",{type:"number","onUpdate:modelValue":a[6]||(a[6]=p=>i.value=p),min:1,max:v.totalItems,placeholder:"èµ·å§‹"},null,8,Qe),[[W,i.value,void 0,{number:!0}]]),a[19]||(a[19]=e("span",null,"è‡³",-1)),C(e("input",{type:"number","onUpdate:modelValue":a[7]||(a[7]=p=>d.value=p),min:1,max:v.totalItems,placeholder:"ç»“æŸ"},null,8,Ye),[[W,d.value,void 0,{number:!0}]])])):S("",!0)]),e("div",Ze,[a[24]||(a[24]=e("label",null,"å¯¼å‡ºé€‰é¡¹",-1)),e("div",et,[e("label",tt,[C(e("input",{type:"checkbox","onUpdate:modelValue":a[8]||(a[8]=p=>$.value=p)},null,512),[[q,$.value]]),a[21]||(a[21]=P(" åŒ…å«å…ƒæ•°æ® ",-1))]),r.value==="images"?(o(),c("label",st,[C(e("input",{type:"checkbox","onUpdate:modelValue":a[9]||(a[9]=p=>I.value=p)},null,512),[[q,I.value]]),a[22]||(a[22]=P(" æ·»åŠ æ—¶é—´æˆ³ ",-1))])):S("",!0),e("label",at,[C(e("input",{type:"checkbox","onUpdate:modelValue":a[10]||(a[10]=p=>z.value=p)},null,512),[[q,z.value]]),a[23]||(a[23]=P(" å¯¼å‡ºåæ‰“å¼€æ–‡ä»¶å¤¹ ",-1))])])]),e("div",ot,[a[25]||(a[25]=e("label",null,"æ–‡ä»¶å",-1)),C(e("input",{type:"text","onUpdate:modelValue":a[11]||(a[11]=p=>_.value=p),class:"file-name-input",placeholder:"è¾“å…¥æ–‡ä»¶å"},null,512),[[W,_.value]])])]),e("div",lt,[e("button",{onClick:h,class:"btn btn-secondary"},"å–æ¶ˆ"),e("button",{onClick:N,class:"btn btn-primary"},[(o(),w(k(x(b).download),{size:14})),a[26]||(a[26]=P(" å¼€å§‹å¯¼å‡º ",-1))])])])])):S("",!0)}}),it=Z(nt,[["__scopeId","data-v-5c23d7d2"]]),rt={key:0,class:"export-progress-overlay"},ut={class:"export-progress-dialog"},ct={class:"dialog-header"},dt={class:"dialog-content"},vt={class:"progress-info"},pt={class:"progress-message"},gt={class:"progress-details"},mt={class:"progress-percentage"},ht={class:"progress-bar-container"},ft={class:"progress-bar"},yt={key:0,class:"current-item"},bt={class:"current-text"},xt={key:1,class:"estimated-time"},$t={class:"time-text"},wt={key:2,class:"completion-info"},kt={key:0,class:"export-path"},_t={class:"path-text"},St={key:3,class:"error-info"},Pt={class:"error-message"},Ct={class:"dialog-footer"},It=ee({__name:"ExportProgressDialog",props:{visible:{type:Boolean},progress:{},exportPath:{},canCancel:{type:Boolean,default:!0}},emits:["update:visible","cancel","openFolder"],setup(v,{emit:l}){const t=v,s=l,r=y(0),n=y(0),i=T(()=>r.value===0?0:Date.now()-r.value);H(()=>t.progress,_=>{if(_.status==="exporting"){if(r.value===0&&(r.value=Date.now()),_.percentage>0&&_.percentage<100){const h=i.value,N=h/_.percentage*100;n.value=N-h}}else _.status==="preparing"&&(r.value=0,n.value=0)},{deep:!0});function d(){s("update:visible",!1)}function $(){s("cancel")}function I(){t.exportPath&&s("openFolder",t.exportPath)}function z(_){if(_<=0)return"è®¡ç®—ä¸­...";const h=Math.floor(_/1e3),N=Math.floor(h/60);return N>0?`${N}åˆ†${h%60}ç§’`:`${h}ç§’`}return(_,h)=>v.visible?(o(),c("div",rt,[e("div",ut,[e("div",ct,[h[0]||(h[0]=e("h3",null,"å¯¼å‡ºè¿›åº¦",-1)),v.canCancel?(o(),c("button",{key:0,onClick:$,class:"cancel-btn"}," å–æ¶ˆ ")):S("",!0)]),e("div",dt,[e("div",{class:O(["status-icon",`status-${v.progress.status}`])},[v.progress.status==="preparing"?(o(),w(k(x(b).settings),{key:0,size:32,class:"preparing-icon"})):v.progress.status==="exporting"?(o(),w(k(x(b).download),{key:1,size:32,class:"exporting-icon"})):v.progress.status==="completed"?(o(),w(k(x(b).check),{key:2,size:32,class:"completed-icon"})):v.progress.status==="error"?(o(),w(k(x(b).xCircle),{key:3,size:32,class:"error-icon"})):S("",!0)],2),e("div",vt,[e("div",pt,m(v.progress.message),1),e("div",gt,[e("span",null,m(v.progress.current)+" / "+m(v.progress.total),1),e("span",mt,m(v.progress.percentage)+"%",1)])]),e("div",ht,[e("div",ft,[e("div",{class:O(["progress-fill",`fill-${v.progress.status}`]),style:Y({width:v.progress.percentage+"%"})},null,6)])]),v.progress.currentItem&&v.progress.status==="exporting"?(o(),c("div",yt,[h[1]||(h[1]=e("span",{class:"current-label"},"æ­£åœ¨å¤„ç†:",-1)),e("span",bt,m(v.progress.currentItem),1)])):S("",!0),n.value&&v.progress.status==="exporting"?(o(),c("div",xt,[h[2]||(h[2]=e("span",{class:"time-label"},"é¢„è®¡å‰©ä½™æ—¶é—´:",-1)),e("span",$t,m(z(n.value)),1)])):S("",!0),v.progress.status==="completed"?(o(),c("div",wt,[h[4]||(h[4]=e("div",{class:"completion-message"},"å¯¼å‡ºå®Œæˆï¼",-1)),v.exportPath?(o(),c("div",kt,[h[3]||(h[3]=e("span",{class:"path-label"},"ä¿å­˜ä½ç½®:",-1)),e("span",_t,m(v.exportPath),1)])):S("",!0)])):S("",!0),v.progress.status==="error"?(o(),c("div",St,[e("div",Pt,m(v.progress.message),1)])):S("",!0)]),e("div",Ct,[v.progress.status==="completed"?(o(),c("button",{key:0,onClick:I,class:"btn btn-secondary"},[(o(),w(k(x(b).folder),{size:14})),h[5]||(h[5]=P(" æ‰“å¼€æ–‡ä»¶å¤¹ ",-1))])):S("",!0),v.progress.status==="completed"||v.progress.status==="error"?(o(),c("button",{key:1,onClick:d,class:"btn btn-primary"}," å…³é—­ ")):S("",!0),v.progress.status==="exporting"&&v.canCancel?(o(),c("button",{key:2,onClick:$,class:"btn btn-danger"}," å–æ¶ˆå¯¼å‡º ")):S("",!0)])])])):S("",!0)}}),Et=Z(It,[["__scopeId","data-v-0fe738bf"]]);class Nt{constructor(){this.isCancelled=!1}setProgressCallback(l){this.progressCallback=l}cancel(){this.isCancelled=!0}async exportScenes(l,t){this.isCancelled=!1;try{const s=this.getItemsInRange(l,t);this.updateProgress(0,s.length,"å‡†å¤‡å¯¼å‡º...","preparing");let r;switch(t.format){case"json":r=await this.exportScenesAsJSON(s,t);break;case"text":r=await this.exportScenesAsText(s,t);break;case"images":r=await this.exportScenesAsImages(s,t);break;default:throw new Error(`ä¸æ”¯æŒçš„å¯¼å‡ºæ ¼å¼: ${t.format}`)}return this.updateProgress(s.length,s.length,"å¯¼å‡ºå®Œæˆ","completed"),t.openAfterExport&&await this.openExportFolder(r),r}catch(s){throw this.updateProgress(0,0,`å¯¼å‡ºå¤±è´¥: ${s.message}`,"error"),s}}async exportStoryboards(l,t){this.isCancelled=!1;try{const s=this.getItemsInRange(l,t);this.updateProgress(0,s.length,"å‡†å¤‡å¯¼å‡º...","preparing");let r;switch(t.format){case"json":r=await this.exportStoryboardsAsJSON(s,t);break;case"text":r=await this.exportStoryboardsAsText(s,t);break;case"images":r=await this.exportStoryboardsAsImages(s,t);break;default:throw new Error(`ä¸æ”¯æŒçš„å¯¼å‡ºæ ¼å¼: ${t.format}`)}return this.updateProgress(s.length,s.length,"å¯¼å‡ºå®Œæˆ","completed"),t.openAfterExport&&await this.openExportFolder(r),r}catch(s){throw this.updateProgress(0,0,`å¯¼å‡ºå¤±è´¥: ${s.message}`,"error"),s}}getItemsInRange(l,t){switch(t.range){case"all":return l;case"current":return l.slice(0,1);case"custom":const s=Math.max(0,(t.customStart||1)-1),r=Math.min(l.length,t.customEnd||l.length);return l.slice(s,r);default:return l}}async exportScenesAsJSON(l,t){const s={type:"scenes",exportedAt:new Date().toISOString(),metadata:t.includeMetadata?{totalScenes:l.length,exportOptions:t}:void 0,scenes:l.map((i,d)=>{if(this.updateProgress(d+1,l.length,`å¯¼å‡ºåœºæ™¯: ${i.title}`,"exporting"),this.isCancelled)throw new Error("å¯¼å‡ºå·²å–æ¶ˆ");return{...i,exportIndex:d+1,timestamp:t.includeTimestamps?new Date().toISOString():void 0}})},r=`${t.fileName}.json`;return await this.saveFile(r,JSON.stringify(s,null,2))}async exportScenesAsText(l,t){let s="";t.includeMetadata&&(s+=`åœºæ™¯å¯¼å‡ºæŠ¥å‘Š
`,s+=`å¯¼å‡ºæ—¶é—´: ${new Date().toLocaleString("zh-CN")}
`,s+=`åœºæ™¯æ•°é‡: ${l.length}
`,s+=`
${"=".repeat(50)}

`),l.forEach((i,d)=>{if(this.updateProgress(d+1,l.length,`å¯¼å‡ºåœºæ™¯: ${i.title}`,"exporting"),this.isCancelled)throw new Error("å¯¼å‡ºå·²å–æ¶ˆ");s+=`åœºæ™¯ ${d+1}: ${i.title}
`,s+=`æè¿°: ${i.description}
`,i.characters&&i.characters.length>0&&(s+=`è§’è‰²: ${i.characters.map($=>`${$.name}(${$.role})`).join(", ")}
`),s+=`æ—¶é•¿: ${Math.floor(i.duration/1e3)}ç§’
`,t.includeTimestamps&&(s+=`å¯¼å‡ºæ—¶é—´: ${new Date().toLocaleString("zh-CN")}
`),s+=`
${"-".repeat(30)}

`});const r=`${t.fileName}.txt`;return await this.saveFile(r,s)}async exportScenesAsImages(l,t){const s=t.fileName,r=await this.createExportFolder(s);for(let n=0;n<l.length;n++){const i=l[n];if(this.updateProgress(n+1,l.length,`ç”Ÿæˆåœºæ™¯å›¾ç‰‡: ${i.title}`,"exporting"),this.isCancelled)throw new Error("å¯¼å‡ºå·²å–æ¶ˆ");await this.delay(500);const d={title:i.title,description:i.description,characters:i.characters,duration:i.duration,timestamp:t.includeTimestamps?new Date().toISOString():void 0},$=`scene_${String(n+1).padStart(3,"0")}_info.json`;await this.saveFileToFolder(r,$,JSON.stringify(d,null,2));const I=`scene_${String(n+1).padStart(3,"0")}.png`;await this.saveFileToFolder(r,I,"placeholder image data")}return r}async exportStoryboardsAsJSON(l,t){const s={type:"storyboards",exportedAt:new Date().toISOString(),metadata:t.includeMetadata?{totalStoryboards:l.length,exportOptions:t}:void 0,storyboards:l.map((i,d)=>{if(this.updateProgress(d+1,l.length,`å¯¼å‡ºåˆ†é•œå¤´ ${d+1}`,"exporting"),this.isCancelled)throw new Error("å¯¼å‡ºå·²å–æ¶ˆ");return{...i,exportIndex:d+1,timestamp:t.includeTimestamps?new Date().toISOString():void 0}})},r=`${t.fileName}.json`;return await this.saveFile(r,JSON.stringify(s,null,2))}async exportStoryboardsAsText(l,t){let s="";t.includeMetadata&&(s+=`åˆ†é•œå¤´å¯¼å‡ºæŠ¥å‘Š
`,s+=`å¯¼å‡ºæ—¶é—´: ${new Date().toLocaleString("zh-CN")}
`,s+=`åˆ†é•œå¤´æ•°é‡: ${l.length}
`,s+=`
${"=".repeat(50)}

`),l.forEach((i,d)=>{if(this.updateProgress(d+1,l.length,`å¯¼å‡ºåˆ†é•œå¤´ ${d+1}`,"exporting"),this.isCancelled)throw new Error("å¯¼å‡ºå·²å–æ¶ˆ");s+=`åˆ†é•œå¤´ ${d+1}
`,s+=`æè¿°: ${i.description}
`,i.dialogue&&(s+=`å¯¹è¯: "${i.dialogue}"
`,i.speaker&&(s+=`è¯´è¯äºº: ${i.speaker}
`)),s+=`æ—¶é•¿: ${Math.floor(i.duration/1e3)}ç§’
`,i.imageUrl&&(s+=`å›¾ç‰‡: ${i.imageUrl}
`),t.includeTimestamps&&(s+=`å¯¼å‡ºæ—¶é—´: ${new Date().toLocaleString("zh-CN")}
`),s+=`
${"-".repeat(30)}

`});const r=`${t.fileName}.txt`;return await this.saveFile(r,s)}async exportStoryboardsAsImages(l,t){const s=t.fileName,r=await this.createExportFolder(s);for(let n=0;n<l.length;n++){const i=l[n];if(this.updateProgress(n+1,l.length,`å¯¼å‡ºåˆ†é•œå¤´å›¾ç‰‡ ${n+1}`,"exporting"),this.isCancelled)throw new Error("å¯¼å‡ºå·²å–æ¶ˆ");await this.delay(300);const d={description:i.description,dialogue:i.dialogue,speaker:i.speaker,duration:i.duration,originalImageUrl:i.imageUrl,timestamp:t.includeTimestamps?new Date().toISOString():void 0},$=`storyboard_${String(n+1).padStart(3,"0")}_info.json`;if(await this.saveFileToFolder(r,$,JSON.stringify(d,null,2)),i.imageUrl){const I=`storyboard_${String(n+1).padStart(3,"0")}.png`;await this.saveFileToFolder(r,I,"image data from "+i.imageUrl)}}return r}updateProgress(l,t,s,r){if(this.progressCallback){const n=t>0?Math.round(l/t*100):0;this.progressCallback({current:l,total:t,percentage:n,currentItem:s,status:r,message:s})}}async saveFile(l,t){await this.delay(200);const s=`/exports/${l}`;return console.log(`æ–‡ä»¶å·²ä¿å­˜: ${s}`,{size:t.length}),s}async createExportFolder(l){await this.delay(100);const t=`/exports/${l}`;return console.log(`æ–‡ä»¶å¤¹å·²åˆ›å»º: ${t}`),t}async saveFileToFolder(l,t,s){await this.delay(50),console.log(`æ–‡ä»¶å·²ä¿å­˜: ${l}/${t}`,{size:s.length})}async openExportFolder(l){console.log(`æ‰“å¼€æ–‡ä»¶å¤¹: ${l}`)}delay(l){return new Promise(t=>setTimeout(t,l))}}const R=new Nt,Tt={class:"preview-view"},Ft={key:0,class:"loading-overlay"},zt={class:"preview-controls"},Ut=["disabled"],Vt=["disabled"],Mt={class:"preview-content"},Dt={class:"preview-player"},jt={class:"player-container"},At={key:0,class:"scene-preview"},Ot={key:0,class:"scene-content"},Lt={class:"scene-header"},Bt={class:"scene-index"},Jt={class:"scene-description"},Rt={key:0,class:"scene-characters"},qt={class:"character-list"},Ht={class:"character-name"},Kt={class:"character-role"},Wt={key:1,class:"empty-scene"},Xt={key:1,class:"storyboard-preview"},Gt={key:0,class:"storyboard-content"},Qt={class:"storyboard-header"},Yt={class:"storyboard-index"},Zt={class:"storyboard-image"},es=["src","alt"],ts={key:1,class:"placeholder-image"},ss={key:0,class:"error-text"},as={key:1},os={class:"storyboard-description"},ls={key:0,class:"storyboard-dialogue"},ns={class:"dialogue-content"},is={key:0,class:"dialogue-speaker"},rs={key:1,class:"empty-storyboard"},us={class:"player-controls"},cs={class:"control-buttons"},ds=["disabled"],vs=["disabled"],ps=["disabled"],gs={class:"progress-section"},ms={class:"progress-text"},hs={class:"playback-settings"},fs={class:"speed-control"},ys={class:"auto-play-control"},bs={class:"content-sidebar"},xs={class:"sidebar-header"},$s={class:"content-count"},ws={class:"content-list"},ks={key:0,class:"scene-list"},_s=["onClick"],Ss={class:"scene-thumbnail"},Ps={class:"scene-info"},Cs={class:"scene-title"},Is={class:"scene-meta"},Es={key:1,class:"storyboard-list"},Ns=["onClick"],Ts={class:"storyboard-thumbnail"},Fs=["src","alt"],zs={class:"storyboard-info"},Us={class:"storyboard-title"},Vs={class:"storyboard-meta"},Ms={key:2,class:"empty-list"},Ds=ee({__name:"PreviewView",setup(v){Ce();const l=Ie(),t=Ee();Ne();const s=y(!1),r=y(!1),n=y("scene"),i=y(0),d=y(0),$=y(!1),I=y(1),z=y(!1),_=y(!1),h=y(!1),N=y({current:0,total:0,percentage:0,currentItem:"",status:"preparing",message:"å‡†å¤‡å¯¼å‡º..."}),F=y(""),a=y([]),p=y([]);let D=null;const ne=T(()=>n.value==="scene"?"åœºæ™¯é¢„è§ˆ":"åˆ†é•œå¤´é¢„è§ˆ"),ie=T(()=>{const f=l.currentProject;return f?`é¡¹ç›®: ${f.name}`:"é¢„è§ˆç”Ÿæˆçš„å†…å®¹"}),j=T(()=>a.value[i.value]||null),E=T(()=>p.value[d.value]||null),U=T(()=>n.value==="scene"?a.value.length:p.value.length),L=T(()=>n.value==="scene"?i.value:d.value),K=T(()=>U.value>0),re=T(()=>L.value===0),te=T(()=>L.value>=U.value-1),se=T(()=>U.value===0?0:L.value/(U.value-1)*100);async function ue(){console.log("ğŸ¬ [PreviewView] Initializing..."),console.log("ğŸ“Š [PreviewView] Current project:",l.currentProject);try{r.value=!0,await ae(),s.value=!0,console.log("âœ… [PreviewView] Initialization completed")}catch(f){console.error("âŒ [PreviewView] é¢„è§ˆåˆå§‹åŒ–å¤±è´¥:",f),t.addNotification({type:"error",title:"åŠ è½½å¤±è´¥",message:"æ— æ³•åŠ è½½é¢„è§ˆå†…å®¹",timeout:3e3})}finally{r.value=!1}}async function ae(){if(!l.currentProject){console.warn("æ²¡æœ‰å½“å‰é¡¹ç›®");return}let u=[],g=[];console.log("ğŸ“¦ [PreviewView] Loading from localStorage/backend"),a.value=u,p.value=g,a.value.length===0&&p.value.length===0&&(console.warn("âš ï¸ [PreviewView] æ²¡æœ‰æ‰¾åˆ°é¢„è§ˆæ•°æ®"),t.addNotification({type:"info",title:"æš‚æ— é¢„è§ˆå†…å®¹",message:"è¯·å…ˆæ‰§è¡Œå·¥ä½œæµç”Ÿæˆå†…å®¹",timeout:3e3}))}function ce(){n.value=n.value==="scene"?"storyboard":"scene",V()}async function de(){await ae(),t.addNotification({type:"success",title:"åˆ·æ–°æˆåŠŸ",message:"é¢„è§ˆå†…å®¹å·²æ›´æ–°",timeout:2e3})}function ve(){_.value=!0}function pe(){$.value?V():ge()}function ge(){K.value&&($.value=!0,B())}function V(){$.value=!1,D&&(clearTimeout(D),D=null)}function B(){if(!$.value)return;const g=((n.value==="scene"?j.value:E.value)?.duration||3e3)/I.value;D=setTimeout(()=>{te.value?z.value?(n.value==="scene"?i.value=0:d.value=0,B()):V():(oe(),B())},g)}function me(){n.value==="scene"?i.value>0&&i.value--:d.value>0&&d.value--}function oe(){n.value==="scene"?i.value<a.value.length-1&&i.value++:d.value<p.value.length-1&&d.value++}function he(f){i.value=f,V()}function fe(f){d.value=f,V()}function ye(f){const g=f.currentTarget.getBoundingClientRect(),M=(f.clientX-g.left)/g.width,J=Math.floor(M*U.value);n.value==="scene"?i.value=Math.max(0,Math.min(J,a.value.length-1)):d.value=Math.max(0,Math.min(J,p.value.length-1)),V()}function be(){$.value&&(D&&clearTimeout(D),B())}function le(f){return`${Math.floor(f/1e3)}s`}function xe(f){console.warn("å›¾ç‰‡åŠ è½½å¤±è´¥:",f.imageUrl),f.imageLoadError=!0}function $e(f){console.log("å¯¼å‡ºé€‰é¡¹:",f),_.value=!1,we(f)}async function we(f){try{h.value=!0,F.value="",R.setProgressCallback(g=>{N.value={...g}});let u;n.value==="scene"?u=await R.exportScenes(a.value,f):u=await R.exportStoryboards(p.value,f),F.value=u,t.addNotification({type:"success",title:"å¯¼å‡ºæˆåŠŸ",message:`å†…å®¹å·²å¯¼å‡ºåˆ°: ${u}`,timeout:5e3})}catch(u){console.error("å¯¼å‡ºå¤±è´¥:",u),N.value={...N.value,status:"error",message:u.message||"å¯¼å‡ºè¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯"},t.addNotification({type:"error",title:"å¯¼å‡ºå¤±è´¥",message:u.message||"å¯¼å‡ºè¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯",timeout:5e3})}}function ke(){R.cancel(),h.value=!1,t.addNotification({type:"info",title:"å¯¼å‡ºå·²å–æ¶ˆ",message:"å¯¼å‡ºæ“ä½œå·²è¢«ç”¨æˆ·å–æ¶ˆ",timeout:3e3})}function _e(f){console.log("æ‰“å¼€å¯¼å‡ºæ–‡ä»¶å¤¹:",f),t.addNotification({type:"info",title:"æ‰“å¼€æ–‡ä»¶å¤¹",message:`æ­£åœ¨æ‰“å¼€: ${f}`,timeout:2e3})}return Fe(()=>{ue()}),ze(()=>{V()}),H(n,()=>{V()}),(f,u)=>(o(),c("div",Tt,[s.value?S("",!0):(o(),c("div",Ft,[...u[5]||(u[5]=[e("div",{class:"loading-spinner"},"æ­£åœ¨åŠ è½½é¢„è§ˆ...",-1)])])),X(Te,{title:ne.value,subtitle:ie.value},{actions:Ue(()=>[e("div",zt,[e("button",{onClick:ce,class:O(["btn btn-secondary",{active:n.value==="scene"}])},m(n.value==="scene"?"åœºæ™¯é¢„è§ˆ":"åˆ†é•œé¢„è§ˆ"),3),e("button",{onClick:de,class:"btn btn-secondary",disabled:r.value},[(o(),w(k(x(b).refresh),{size:14})),u[6]||(u[6]=P(" åˆ·æ–° ",-1))],8,Ut),e("button",{onClick:ve,class:"btn btn-primary",disabled:!K.value},[(o(),w(k(x(b).download),{size:14})),u[7]||(u[7]=P(" å¯¼å‡º ",-1))],8,Vt)])]),_:1},8,["title","subtitle"]),e("div",Mt,[e("div",Dt,[e("div",jt,[n.value==="scene"?(o(),c("div",At,[j.value?(o(),c("div",Ot,[e("div",Lt,[e("h3",null,m(j.value.title),1),e("span",Bt,m(i.value+1)+" / "+m(a.value.length),1)]),e("div",Jt,[e("p",null,m(j.value.description),1)]),j.value.characters?.length?(o(),c("div",Rt,[u[8]||(u[8]=e("h4",null,"å‡ºåœºè§’è‰²",-1)),e("div",qt,[(o(!0),c(G,null,Q(j.value.characters,g=>(o(),c("div",{key:g.id,class:"character-item"},[e("span",Ht,m(g.name),1),e("span",Kt,m(g.role),1)]))),128))])])):S("",!0)])):(o(),c("div",Wt,[(o(),w(k(x(b).film),{size:64})),u[9]||(u[9]=e("p",null,"æš‚æ— åœºæ™¯å†…å®¹",-1))]))])):(o(),c("div",Xt,[E.value?(o(),c("div",Gt,[e("div",Qt,[e("h3",null,"åˆ†é•œå¤´ "+m(d.value+1),1),e("span",Yt,m(d.value+1)+" / "+m(p.value.length),1)]),e("div",Zt,[E.value.imageUrl&&!E.value.imageLoadError?(o(),c("img",{key:0,src:E.value.imageUrl,alt:E.value.description,onError:u[0]||(u[0]=g=>xe(E.value))},null,40,es)):(o(),c("div",ts,[(o(),w(k(x(b).image),{size:64})),E.value.imageLoadError?(o(),c("p",ss,"å›¾ç‰‡åŠ è½½å¤±è´¥")):(o(),c("p",as,"æš‚æ— å›¾ç‰‡")),u[10]||(u[10]=e("p",{class:"hint-text"},"å·¥ä½œæµæœªç”Ÿæˆå›¾ç‰‡æ•°æ®",-1))]))]),e("div",os,[e("p",null,m(E.value.description),1)]),E.value.dialogue?(o(),c("div",ls,[u[11]||(u[11]=e("h4",null,"å¯¹è¯",-1)),e("div",ns,[e("p",null,'"'+m(E.value.dialogue)+'"',1),E.value.speaker?(o(),c("span",is," â€”â€” "+m(E.value.speaker),1)):S("",!0)])])):S("",!0)])):(o(),c("div",rs,[(o(),w(k(x(b).image),{size:64})),u[12]||(u[12]=e("p",null,"æš‚æ— åˆ†é•œå¤´å†…å®¹",-1))]))]))]),e("div",us,[e("div",cs,[e("button",{onClick:me,class:"control-btn",disabled:re.value},[(o(),w(k(x(b).chevronLeft),{size:16}))],8,ds),e("button",{onClick:pe,class:"control-btn play-btn",disabled:!K.value},[(o(),w(k($.value?x(b).pause:x(b).play),{size:20}))],8,vs),e("button",{onClick:oe,class:"control-btn",disabled:te.value},[(o(),w(k(x(b).chevronRight),{size:16}))],8,ps)]),e("div",gs,[e("div",{class:"progress-bar",onClick:ye},[e("div",{class:"progress-fill",style:Y({width:se.value+"%"})},null,4),e("div",{class:"progress-handle",style:Y({left:se.value+"%"})},null,4)]),e("div",ms,m(L.value+1)+" / "+m(U.value),1)]),e("div",hs,[e("label",fs,[u[14]||(u[14]=P(" é€Ÿåº¦: ",-1)),C(e("select",{"onUpdate:modelValue":u[1]||(u[1]=g=>I.value=g),onChange:be},[...u[13]||(u[13]=[e("option",{value:"0.5"},"0.5x",-1),e("option",{value:"1"},"1x",-1),e("option",{value:"1.5"},"1.5x",-1),e("option",{value:"2"},"2x",-1)])],544),[[Pe,I.value]])]),e("label",ys,[C(e("input",{type:"checkbox","onUpdate:modelValue":u[2]||(u[2]=g=>z.value=g)},null,512),[[q,z.value]]),u[15]||(u[15]=P(" è‡ªåŠ¨æ’­æ”¾ ",-1))])])])]),e("div",bs,[e("div",xs,[e("h3",null,m(n.value==="scene"?"åœºæ™¯åˆ—è¡¨":"åˆ†é•œåˆ—è¡¨"),1),e("span",$s,m(U.value)+" é¡¹",1)]),e("div",ws,[n.value==="scene"?(o(),c("div",ks,[(o(!0),c(G,null,Q(a.value,(g,M)=>(o(),c("div",{key:g.id,class:O(["scene-item",{active:M===i.value}]),onClick:J=>he(M)},[e("div",Ss,[(o(),w(k(x(b).film),{size:20}))]),e("div",Ps,[e("div",Cs,m(g.title),1),e("div",Is,[e("span",null,m(g.characters?.length||0)+" ä¸ªè§’è‰²",1),e("span",null,m(le(g.duration)),1)])])],10,_s))),128))])):(o(),c("div",Es,[(o(!0),c(G,null,Q(p.value,(g,M)=>(o(),c("div",{key:g.id,class:O(["storyboard-item",{active:M===d.value}]),onClick:J=>fe(M)},[e("div",Ts,[g.thumbnailUrl?(o(),c("img",{key:0,src:g.thumbnailUrl,alt:g.description},null,8,Fs)):(o(),w(k(x(b).image),{key:1,size:20}))]),e("div",zs,[e("div",Us,"åˆ†é•œ "+m(M+1),1),e("div",Vs,[e("span",null,m(le(g.duration)),1)])])],10,Ns))),128))])),U.value===0?(o(),c("div",Ms,[(o(),w(k(x(b).inbox),{size:32})),u[16]||(u[16]=e("p",null,"æš‚æ— å†…å®¹",-1))])):S("",!0)])])]),X(it,{visible:_.value,"onUpdate:visible":u[3]||(u[3]=g=>_.value=g),"content-type":n.value,"total-items":U.value,onExport:$e},null,8,["visible","content-type","total-items"]),X(Et,{visible:h.value,"onUpdate:visible":u[4]||(u[4]=g=>h.value=g),progress:N.value,"export-path":F.value,"can-cancel":N.value.status==="exporting",onCancel:ke,onOpenFolder:_e},null,8,["visible","progress","export-path","can-cancel"])]))}}),Rs=Z(Ds,[["__scopeId","data-v-776ddfdd"]]);export{Rs as default};
