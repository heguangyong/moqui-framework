const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./DashboardPanel-3Y0QnzcO.js","./_plugin-vue_export-helper-BFgqyxDe.js","./runtime-core.esm-bundler-8-XbLWPr.js","./pinia-Be3yrKEl.js","./preload-helper-CmsKOCeN.js","./vue.runtime.esm-bundler-tGj6Om4U.js","./InputDialog-CLWUPPpH.js","./InputDialog-jO_GFQKy.css","./useTheme-yXL8gOdE.js","./credits-WUr7wWTG.js","./DashboardPanel-C-DXd_jx.css","./WorkflowContextPanel-DI_Gd8sW.js","./workflowStore-BU4lfOfq.js","./api-BR07cdPl.js","./CharacterSystem-9i6-R3qi.js","./WorkflowContextPanel-DmE5ROJU.css","./AssetsPanel-e6XBygAm.js","./AssetsPanel-CCwbg1f-.css","./CharactersPanel-DepzV6PI.js","./CharactersPanel-DGpY41rU.css","./SettingsPanel-BRvowfdk.js","./SettingsPanel-KeTAqFPz.css"])))=>i.map(i=>d[i]);
import{Transition as Q,withModifiers as K,vModelText as Ne,withKeys as re,vModelDynamic as ce}from"./vue.runtime.esm-bundler-tGj6Om4U.js";import{_ as q,j as oe,d as de,c as me,i as L,u as fe,e as Ae,n as Ce,o as Se,b as Ee}from"./_plugin-vue_export-helper-BFgqyxDe.js";import{defineStore as he}from"./pinia-Be3yrKEl.js";import{u as ye,b as Re}from"./useTheme-yXL8gOdE.js";import{r as C,I as ie,w as ne,p as V,k as n,D as B,E as G,T as ae,j as l,s as I,l as t,F as Z,z as ee,x as W,y as h,v as f,d as D,q as le,B as Y,C as ve,K as _e,A as xe,u as H,N as Oe,O as Pe,P as te,a as Le,G as De,L as Fe}from"./runtime-core.esm-bundler-8-XbLWPr.js";import{_ as se}from"./preload-helper-CmsKOCeN.js";import{useCreditsStore as Ue}from"./credits-WUr7wWTG.js";const Ve=he("task",{state:()=>({tasks:[],isLoading:!1,error:null}),getters:{newTasks:e=>e.tasks.filter(s=>s.status==="pending"),runningTasks:e=>e.tasks.filter(s=>s.status==="running"),reviewTasks:e=>e.tasks.filter(s=>s.status==="review"),completedTasks:e=>e.tasks.filter(s=>s.status==="completed"),failedTasks:e=>e.tasks.filter(s=>s.status==="failed"),taskCounts:e=>({new:e.tasks.filter(s=>s.status==="pending").length,running:e.tasks.filter(s=>s.status==="running").length,review:e.tasks.filter(s=>s.status==="review").length,completed:e.tasks.filter(s=>s.status==="completed").length,failed:e.tasks.filter(s=>s.status==="failed").length,total:e.tasks.length}),tasksByProject:e=>{const s={};return e.tasks.forEach(o=>{s[o.projectId]||(s[o.projectId]=[]),s[o.projectId].push(o)}),s}},actions:{createTask(e){const s={id:`task_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,projectId:e.projectId,type:e.type,name:e.name||this.getTaskTypeName(e.type),status:"pending",progress:0,error:null,createdAt:new Date,startedAt:null,completedAt:null,...e};return this.tasks.push(s),this.saveTasks(),s},getTaskTypeName(e){return{parse:"å°è¯´è§£æž",analyze:"è§’è‰²åˆ†æž",script:"å‰§æœ¬ç”Ÿæˆ",storyboard:"åˆ†é•œç”Ÿæˆ",video:"è§†é¢‘ç”Ÿæˆ"}[e]||e},updateTaskStatus(e,s,o={}){const i=this.tasks.find(c=>c.id===e);return i&&(i.status=s,s==="running"&&!i.startedAt&&(i.startedAt=new Date),(s==="completed"||s==="failed")&&(i.completedAt=new Date),o.progress!==void 0&&(i.progress=o.progress),o.error&&(i.error=o.error),this.saveTasks()),i},updateTaskProgress(e,s){const o=this.tasks.find(i=>i.id===e);return o&&(o.progress=Math.min(100,Math.max(0,s)),this.saveTasks()),o},deleteTask(e){const s=this.tasks.findIndex(o=>o.id===e);return s>-1?(this.tasks.splice(s,1),this.saveTasks(),!0):!1},getProjectTasks(e){return this.tasks.filter(s=>s.projectId===e)},cancelTask(e){return this.updateTaskStatus(e,"failed",{error:"ç”¨æˆ·å–æ¶ˆ"})},retryTask(e){const s=this.tasks.find(o=>o.id===e);return s&&s.status==="failed"?(s.status="pending",s.progress=0,s.error=null,s.startedAt=null,s.completedAt=null,this.saveTasks(),s):null},saveTasks(){try{localStorage.setItem("novel-anime-tasks",JSON.stringify(this.tasks))}catch(e){console.error("Failed to save tasks:",e)}},loadTasks(){try{const e=localStorage.getItem("novel-anime-tasks");e&&(this.tasks=JSON.parse(e),this.tasks.forEach(s=>{s.createdAt=new Date(s.createdAt),s.startedAt&&(s.startedAt=new Date(s.startedAt)),s.completedAt&&(s.completedAt=new Date(s.completedAt))}))}catch(e){console.error("Failed to load tasks:",e),this.tasks=[]}},clearCompletedTasks(){this.tasks=this.tasks.filter(e=>e.status!=="completed"),this.saveTasks()}}}),Me=he("file",{state:()=>({fileTree:[],expandedFolders:[],selectedNode:null,searchQuery:"",isLoading:!1,error:null}),getters:{filteredFileTree:e=>e.searchQuery.trim()?be(e.fileTree,e.searchQuery.toLowerCase()):e.fileTree,totalFiles:e=>ke(e.fileTree),totalFolders:e=>we(e.fileTree),filesByType:e=>{const s={novel:[],script:[],storyboard:[],video:[],other:[]};return Te(e.fileTree,s),s}},actions:{initializeFileTree(e){this.isLoading=!0,this.error=null;try{this.fileTree=[{id:"novels",name:"å°è¯´æ–‡ä»¶",type:"folder",path:"/novels",icon:"folder",children:[],count:0},{id:"scripts",name:"å‰§æœ¬æ–‡ä»¶",type:"folder",path:"/scripts",icon:"folder",children:[],count:0},{id:"characters",name:"è§’è‰²è®¾å®š",type:"folder",path:"/characters",icon:"folder",children:[],count:0},{id:"storyboards",name:"åˆ†é•œæ–‡ä»¶",type:"folder",path:"/storyboards",icon:"folder",children:[],count:0},{id:"audio",name:"éŸ³é¢‘æ–‡ä»¶",type:"folder",path:"/audio",icon:"folder",children:[],count:0},{id:"videos",name:"è§†é¢‘æ–‡ä»¶",type:"folder",path:"/videos",icon:"folder",children:[],count:0}],this.expandedFolders=["novels"],this.saveToStorage()}catch(s){this.error=s.message,console.error("Failed to initialize file tree:",s)}finally{this.isLoading=!1}},addFile(e,s){const o=this.findNodeById(e);if(o&&o.type==="folder"){const i={id:`file_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,name:s.name,type:"file",fileType:s.fileType||"other",path:`${o.path}/${s.name}`,size:s.size||0,modifiedAt:new Date,...s};return o.children||(o.children=[]),o.children.push(i),o.count=o.children.length,this.saveToStorage(),i}return null},addFolder(e,s){const o=e?this.findNodeById(e):null,i={id:`folder_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,name:s.name,type:"folder",path:o?`${o.path}/${s.name}`:`/${s.name}`,icon:"folder",children:[],count:0,...s};return o&&o.type==="folder"?(o.children||(o.children=[]),o.children.push(i),o.count=o.children.length):this.fileTree.push(i),this.saveToStorage(),i},deleteNode(e){const s=$e(this.fileTree,e);if(s){const o=this.expandedFolders.indexOf(e);o>-1&&this.expandedFolders.splice(o,1),this.selectedNode?.id===e&&(this.selectedNode=null),this.saveToStorage()}return s},renameNode(e,s){const o=this.findNodeById(e);if(o){o.name=s;const i=o.path.split("/");return i[i.length-1]=s,o.path=i.join("/"),this.saveToStorage(),!0}return!1},toggleFolder(e){const s=this.expandedFolders.indexOf(e);s>-1?this.expandedFolders.splice(s,1):this.expandedFolders.push(e),this.saveToStorage()},selectNode(e){this.selectedNode=e},setSearchQuery(e){this.searchQuery=e},findNodeById(e,s=this.fileTree){for(const o of s){if(o.id===e)return o;if(o.children){const i=this.findNodeById(e,o.children);if(i)return i}}return null},saveToStorage(){try{localStorage.setItem("novel-anime-file-tree",JSON.stringify({fileTree:this.fileTree,expandedFolders:this.expandedFolders}))}catch(e){console.error("Failed to save file tree:",e)}},loadFromStorage(){try{const e=localStorage.getItem("novel-anime-file-tree"),s=localStorage.getItem("novel-anime-file-tree-version"),o="2";if(e&&s===o){const i=JSON.parse(e);this.fileTree=i.fileTree||[],this.expandedFolders=i.expandedFolders||[],Ie(this.fileTree)}else this.initializeFileTree(),localStorage.setItem("novel-anime-file-tree-version",o)}catch(e){console.error("Failed to load file tree:",e),this.initializeFileTree()}},clearFileTree(){this.fileTree=[],this.expandedFolders=[],this.selectedNode=null,this.searchQuery="",this.saveToStorage()}}});function be(e,s){const o=[];for(const i of e)if(i.name.toLowerCase().includes(s))o.push({...i});else if(i.children){const c=be(i.children,s);c.length>0&&o.push({...i,children:c})}return o}function ke(e){let s=0;for(const o of e)o.type==="file"?s++:o.children&&(s+=ke(o.children));return s}function we(e){let s=0;for(const o of e)o.type==="folder"&&(s++,o.children&&(s+=we(o.children)));return s}function Te(e,s){for(const o of e)if(o.type==="file"){const i=o.fileType||"other";s[i]?s[i].push(o):s.other.push(o)}else o.children&&Te(o.children,s)}function $e(e,s){for(let o=0;o<e.length;o++){if(e[o].id===s)return e.splice(o,1),!0;if(e[o].children&&$e(e[o].children,s))return e[o].count=e[o].children.length,!0}return!1}function Ie(e){for(const s of e)s.modifiedAt&&(s.modifiedAt=new Date(s.modifiedAt)),s.children&&Ie(s.children)}var M=(e=>(e.NETWORK_ERROR="NETWORK_ERROR",e.TIMEOUT_ERROR="TIMEOUT_ERROR",e.API_ERROR="API_ERROR",e.BAD_REQUEST="BAD_REQUEST",e.UNAUTHORIZED="UNAUTHORIZED",e.FORBIDDEN="FORBIDDEN",e.NOT_FOUND="NOT_FOUND",e.CONFLICT="CONFLICT",e.VALIDATION_ERROR="VALIDATION_ERROR",e.INTERNAL_ERROR="INTERNAL_ERROR",e.SERVICE_UNAVAILABLE="SERVICE_UNAVAILABLE",e.UNKNOWN="UNKNOWN",e))(M||{});const pe={[M.NETWORK_ERROR]:{title:"ç½‘ç»œè¿žæŽ¥å¤±è´¥",message:"æ— æ³•è¿žæŽ¥åˆ°æœåŠ¡å™¨ï¼Œè¯·æ£€æŸ¥æ‚¨çš„ç½‘ç»œè¿žæŽ¥ã€‚",solution:`è¯·å°è¯•ä»¥ä¸‹è§£å†³æ–¹æ¡ˆï¼š
1. æ£€æŸ¥ç½‘ç»œè¿žæŽ¥æ˜¯å¦æ­£å¸¸
2. ç¡®è®¤é˜²ç«å¢™æœªé˜»æ­¢åº”ç”¨
3. ç¨åŽé‡è¯•`,severity:"error",category:"network",icon:"wifi-off"},[M.UNAUTHORIZED]:{title:"ç™»å½•å·²è¿‡æœŸ",message:"æ‚¨çš„ç™»å½•ä¼šè¯å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•ã€‚",solution:"ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®é‡æ–°ç™»å½•ä»¥ç»§ç»­ä½¿ç”¨ã€‚",severity:"warning",category:"auth",icon:"lock"},[M.FORBIDDEN]:{title:"æƒé™ä¸è¶³",message:"æ‚¨æ²¡æœ‰æƒé™æ‰§è¡Œæ­¤æ“ä½œã€‚",solution:"å¦‚éœ€è®¿é—®æ­¤åŠŸèƒ½ï¼Œè¯·è”ç³»ç®¡ç†å‘˜èŽ·å–ç›¸åº”æƒé™ã€‚",severity:"warning",category:"auth",icon:"shield-off"},[M.NOT_FOUND]:{title:"èµ„æºä¸å­˜åœ¨",message:"è¯·æ±‚çš„èµ„æºæœªæ‰¾åˆ°æˆ–å·²è¢«åˆ é™¤ã€‚",solution:"è¯·æ£€æŸ¥èµ„æºæ˜¯å¦å­˜åœ¨ï¼Œæˆ–å°è¯•åˆ·æ–°é¡µé¢ã€‚",severity:"warning",category:"system",icon:"search"},[M.VALIDATION_ERROR]:{title:"è¾“å…¥éªŒè¯å¤±è´¥",message:"æ‚¨è¾“å…¥çš„æ•°æ®æ ¼å¼ä¸æ­£ç¡®ã€‚",solution:"è¯·æ£€æŸ¥è¾“å…¥å†…å®¹æ˜¯å¦ç¬¦åˆè¦æ±‚ï¼Œå¹¶é‡è¯•ã€‚",severity:"warning",category:"validation",icon:"alert-circle"},[M.SERVER_ERROR]:{title:"æœåŠ¡å™¨é”™è¯¯",message:"æœåŠ¡å™¨é‡åˆ°äº†é—®é¢˜ï¼Œæ— æ³•å®Œæˆæ‚¨çš„è¯·æ±‚ã€‚",solution:"è¿™é€šå¸¸æ˜¯ä¸´æ—¶é—®é¢˜ï¼Œè¯·ç¨åŽé‡è¯•ã€‚å¦‚æžœé—®é¢˜æŒç»­ï¼Œè¯·è”ç³»æŠ€æœ¯æ”¯æŒã€‚",severity:"error",category:"system",icon:"server"},[M.TIMEOUT]:{title:"è¯·æ±‚è¶…æ—¶",message:"æœåŠ¡å™¨å“åº”æ—¶é—´è¿‡é•¿ï¼Œè¯·æ±‚å·²è¶…æ—¶ã€‚",solution:"è¯·æ£€æŸ¥ç½‘ç»œè¿žæŽ¥ï¼Œæˆ–ç¨åŽé‡è¯•ã€‚å¦‚æžœå¤„ç†å¤§æ–‡ä»¶ï¼Œè¯·è€å¿ƒç­‰å¾…ã€‚",severity:"warning",category:"network",icon:"clock"},[M.API_ERROR]:{title:"API è¯·æ±‚å¤±è´¥",message:"API è¯·æ±‚é‡åˆ°é—®é¢˜ã€‚",solution:"è¯·ç¨åŽé‡è¯•ã€‚å¦‚æžœé—®é¢˜æŒç»­ï¼Œè¯·æ£€æŸ¥ API é…ç½®æˆ–è”ç³»æŠ€æœ¯æ”¯æŒã€‚",severity:"error",category:"system",icon:"alert-triangle"},[M.UNKNOWN]:{title:"æœªçŸ¥é”™è¯¯",message:"å‘ç”Ÿäº†æ„å¤–é”™è¯¯ã€‚",solution:"è¯·å°è¯•åˆ·æ–°é¡µé¢æˆ–é‡å¯åº”ç”¨ã€‚å¦‚æžœé—®é¢˜æŒç»­ï¼Œè¯·è”ç³»æŠ€æœ¯æ”¯æŒã€‚",severity:"error",category:"unknown",icon:"help-circle"}},ze={FILE_TOO_LARGE:{title:"æ–‡ä»¶è¿‡å¤§",message:"ä¸Šä¼ çš„æ–‡ä»¶è¶…è¿‡äº†å¤§å°é™åˆ¶ã€‚",solution:"è¯·é€‰æ‹©å°äºŽ 10MB çš„æ–‡ä»¶ï¼Œæˆ–å°†å¤§æ–‡ä»¶åˆ†å‰²åŽä¸Šä¼ ã€‚",severity:"warning",category:"file",icon:"file"},FILE_TYPE_NOT_SUPPORTED:{title:"æ–‡ä»¶ç±»åž‹ä¸æ”¯æŒ",message:"ä¸æ”¯æŒæ­¤æ–‡ä»¶æ ¼å¼ã€‚",solution:"è¯·ä¸Šä¼  .txt æˆ– .md æ ¼å¼çš„æ–‡æœ¬æ–‡ä»¶ã€‚",severity:"warning",category:"file",icon:"file-text"},AI_QUOTA_EXCEEDED:{title:"AI é…é¢ä¸è¶³",message:"æ‚¨çš„ AI æœåŠ¡é…é¢å·²ç”¨å®Œã€‚",solution:"è¯·å……å€¼ç§¯åˆ†æˆ–ç­‰å¾…é…é¢é‡ç½®åŽç»§ç»­ä½¿ç”¨ã€‚",severity:"warning",category:"ai",icon:"zap-off"},AI_SERVICE_UNAVAILABLE:{title:"AI æœåŠ¡ä¸å¯ç”¨",message:"AI æœåŠ¡æš‚æ—¶æ— æ³•ä½¿ç”¨ã€‚",solution:"è¯·ç¨åŽé‡è¯•ï¼Œæˆ–åœ¨è®¾ç½®ä¸­åˆ‡æ¢åˆ°å…¶ä»– AI æœåŠ¡æä¾›å•†ã€‚",severity:"error",category:"ai",icon:"cloud-off"},PROJECT_NOT_FOUND:{title:"é¡¹ç›®ä¸å­˜åœ¨",message:"æ‰¾ä¸åˆ°æŒ‡å®šçš„é¡¹ç›®ã€‚",solution:"é¡¹ç›®å¯èƒ½å·²è¢«åˆ é™¤æˆ–ç§»åŠ¨ã€‚è¯·è¿”å›žé¡¹ç›®åˆ—è¡¨é‡æ–°é€‰æ‹©ã€‚",severity:"warning",category:"system",icon:"folder"},SAVE_FAILED:{title:"ä¿å­˜å¤±è´¥",message:"æ— æ³•ä¿å­˜æ‚¨çš„æ›´æ”¹ã€‚",solution:"è¯·æ£€æŸ¥ç£ç›˜ç©ºé—´æ˜¯å¦å……è¶³ï¼Œå¹¶ç¡®ä¿æœ‰å†™å…¥æƒé™ã€‚",severity:"error",category:"file",icon:"save"},WORKFLOW_VALIDATION_FAILED:{title:"å·¥ä½œæµéªŒè¯å¤±è´¥",message:"å·¥ä½œæµé…ç½®å­˜åœ¨é”™è¯¯ã€‚",solution:"è¯·æ£€æŸ¥èŠ‚ç‚¹è¿žæŽ¥æ˜¯å¦æ­£ç¡®ï¼Œç¡®ä¿æ‰€æœ‰å¿…éœ€å‚æ•°å·²é…ç½®ã€‚",severity:"warning",category:"validation",icon:"git-branch"},EXECUTION_FAILED:{title:"æ‰§è¡Œå¤±è´¥",message:"å·¥ä½œæµæ‰§è¡Œè¿‡ç¨‹ä¸­é‡åˆ°é”™è¯¯ã€‚",solution:"è¯·æŸ¥çœ‹æ‰§è¡Œæ—¥å¿—äº†è§£è¯¦æƒ…ï¼Œä¿®å¤é—®é¢˜åŽé‡è¯•ã€‚",severity:"error",category:"system",icon:"play"}};function X(e,s){const o=pe[e]||pe[M.UNKNOWN];return s?{...o,message:s}:o}function Be(e){return ze[e]}function je(e,s){const o=typeof e=="string"?e:e.message;return s?X(s,o):o.includes("network")||o.includes("fetch")?X(M.NETWORK_ERROR,o):o.includes("unauthorized")||o.includes("401")?X(M.UNAUTHORIZED,o):o.includes("forbidden")||o.includes("403")?X(M.FORBIDDEN,o):o.includes("not found")||o.includes("404")?X(M.NOT_FOUND,o):o.includes("timeout")?X(M.TIMEOUT,o):{title:"é”™è¯¯",message:o,severity:"error",category:"unknown",icon:"alert-circle"}}function He(e){return{info:"#3b82f6",warning:"#f59e0b",error:"#ef4444",critical:"#dc2626"}[e]}const ue=C({visible:!1,title:"",message:"",severity:"error",actions:[]}),J=C([]),ge=50;function We(){function e(u,v={}){let g;typeof u=="object"&&"title"in u?g=u:g=je(u,v.code),J.value.unshift({...g,timestamp:new Date}),J.value.length>ge&&(J.value=J.value.slice(0,ge)),ue.value={visible:!0,title:g.title,message:g.message,solution:g.solution,details:v.details,severity:g.severity,actions:v.actions||g.actions||[]}}function s(u,v,g={}){const _=X(u,v);e(_,g)}function o(u,v={}){const g=Be(u);e(g,v)}function i(u,v){const g=[];u&&g.push({label:"é‡è¯•",action:u,primary:!0}),s(M.NETWORK_ERROR,void 0,{actions:g,details:v})}function c(u,v){const g=[];u&&g.push({label:"é‡æ–°ç™»å½•",action:u,primary:!0}),s(M.UNAUTHORIZED,void 0,{actions:g,details:v})}function R(u,v,g){s(M.VALIDATION_ERROR,`${u} ${v}`,{details:g})}function b(u,v){o(u,{details:v})}function x(u,v,g){const _=[];v&&u==="AI_SERVICE_UNAVAILABLE"&&_.push({label:"é‡è¯•",action:v,primary:!0}),o(u,{actions:_,details:g})}function k(){ue.value.visible=!1}function N(){return J.value}function p(){J.value=[]}function y(){return JSON.stringify(J.value.map(u=>({timestamp:u.timestamp.toISOString(),title:u.title,message:u.message,severity:u.severity,category:u.category})),null,2)}function w(u,v="æˆåŠŸ"){console.log(`âœ… ${v}: ${u}`)}function P(u,v="è­¦å‘Š"){e({title:v,message:u,severity:"warning",category:"system",icon:"alert-triangle"})}function T(u,v="æç¤º"){e({title:v,message:u,severity:"info",category:"system",icon:"info"})}return{errorDialog:ue,errorHistory:J,showError:e,showErrorByCode:s,showScenarioError:o,showNetworkError:i,showAuthError:c,showValidationError:R,showFileError:b,showAIError:x,closeError:k,getErrorHistory:N,clearErrorHistory:p,exportErrorHistory:y,showSuccess:w,showWarning:P,showInfo:T}}const Ke={class:"credits-history-dialog"},Ge={class:"filter-tabs"},Qe=["onClick"],Je={key:0,class:"loading-state"},Ze={key:1,class:"empty-state"},qe={key:2,class:"transaction-list"},Xe={class:"transaction-info"},Ye={class:"transaction-desc"},et={class:"transaction-meta"},tt={class:"transaction-type"},st={class:"transaction-time"},ot={key:0,class:"load-more"},it=["disabled"],nt={class:"dialog-footer"},at={class:"balance-summary"},lt={class:"balance-value"},rt=ie({__name:"CreditsHistoryDialog",props:{modelValue:{type:Boolean}},emits:["update:modelValue","close"],setup(e,{emit:s}){const o=e,i=s,c=Ue(),R=C(null),b=C(void 0),x=[{label:"å…¨éƒ¨",value:void 0},{label:"æ¶ˆè´¹",value:"consume"},{label:"å……å€¼",value:"add"},{label:"åˆå§‹",value:"initial"},{label:"é€€æ¬¾",value:"refund"}];ne(()=>o.modelValue,async _=>{_&&await c.refreshHistory(b.value)});function k(){i("update:modelValue",!1),i("close")}async function N(_){b.value=_,await c.refreshHistory(_)}async function p(){await c.loadMoreHistory(b.value)}function y(_){const A=_.target,{scrollTop:S,scrollHeight:U,clientHeight:j}=A;U-S-j<100&&c.hasMoreHistory&&!c.isLoading&&p()}function w(_){switch(_){case"consume":return"ðŸ“¤";case"add":return"ðŸ“¥";case"initial":return"ðŸŽ";case"refund":return"â†©ï¸";default:return"ðŸ’Ž"}}function P(_){switch(_){case"consume":return"æ¶ˆè´¹";case"add":return"å……å€¼";case"initial":return"åˆå§‹";case"refund":return"é€€æ¬¾";default:return _}}function T(_){switch(_){case"consume":return"type-consume";case"add":return"type-add";case"initial":return"type-initial";case"refund":return"type-refund";default:return""}}function u(_){return _>=0?"amount-positive":"amount-negative"}function v(_){return`${_>=0?"+":""}${_}`}function g(_){const A=new Date(_),U=new Date().getTime()-A.getTime();return U<6e4?"åˆšåˆš":U<36e5?`${Math.floor(U/6e4)}åˆ†é’Ÿå‰`:U<864e5?`${Math.floor(U/36e5)}å°æ—¶å‰`:U<6048e5?`${Math.floor(U/864e5)}å¤©å‰`:A.toLocaleDateString("zh-CN",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}return(_,A)=>(n(),V(ae,{to:"body"},[B(Q,{name:"dialog"},{default:G(()=>[e.modelValue?(n(),l("div",{key:0,class:"dialog-overlay",onClick:K(k,["self"])},[t("div",Ke,[t("div",{class:"dialog-header"},[A[0]||(A[0]=t("h2",{class:"dialog-title"},"ç§¯åˆ†è®°å½•",-1)),t("button",{class:"close-btn",onClick:k},"âœ•")]),t("div",Ge,[(n(),l(Z,null,ee(x,S=>t("button",{key:S.value,class:W(["filter-tab",{active:b.value===S.value}]),onClick:U=>N(S.value)},h(S.label),11,Qe)),64))]),t("div",{class:"dialog-content",ref_key:"contentRef",ref:R,onScroll:y},[f(c).isLoading&&f(c).history.length===0?(n(),l("div",Je,[...A[1]||(A[1]=[t("div",{class:"spinner"},null,-1),t("p",null,"åŠ è½½ä¸­...",-1)])])):f(c).history.length===0?(n(),l("div",Ze,[...A[2]||(A[2]=[t("span",{class:"empty-icon"},"ðŸ“‹",-1),t("p",null,"æš‚æ— ç§¯åˆ†è®°å½•",-1)])])):(n(),l("div",qe,[(n(!0),l(Z,null,ee(f(c).history,S=>(n(),l("div",{key:S.transactionId,class:"transaction-item"},[t("div",{class:W(["transaction-icon",T(S.type)])},h(w(S.type)),3),t("div",Xe,[t("div",Ye,h(S.description),1),t("div",et,[t("span",tt,h(P(S.type)),1),t("span",st,h(g(S.timestamp)),1)])]),t("div",{class:W(["transaction-amount",u(S.amount)])},h(v(S.amount)),3)]))),128)),f(c).hasMoreHistory?(n(),l("div",ot,[t("button",{class:"load-more-btn",onClick:p,disabled:f(c).isLoading},h(f(c).isLoading?"åŠ è½½ä¸­...":"åŠ è½½æ›´å¤š"),9,it)])):I("",!0)]))],544),t("div",nt,[t("div",at,[A[3]||(A[3]=t("span",{class:"balance-label"},"å½“å‰ä½™é¢",-1)),t("span",lt,"ðŸ’Ž "+h(f(c).formattedBalance),1)])])])])):I("",!0)]),_:1})]))}}),ct=q(rt,[["__scopeId","data-v-b09a23c1"]]),ut={class:"profile-edit-dialog"},dt={class:"dialog-content"},ft={class:"avatar-section"},vt={class:"avatar-preview"},pt=["src"],gt={key:1,class:"avatar-initials"},mt={class:"upload-overlay"},ht={key:0,class:"upload-text"},yt={key:1,class:"upload-text"},_t={class:"form-section"},bt={class:"form-group"},kt={class:"form-group"},wt=["value"],Tt={class:"form-group"},$t=["value"],It={key:0,class:"error-message"},Nt={class:"dialog-footer"},At=["disabled"],Ct=["disabled"],St=ie({__name:"ProfileEditDialog",props:{modelValue:{type:Boolean}},emits:["update:modelValue","close","saved"],setup(e,{emit:s}){const o=e,i=s,c=oe(),R=C(""),b=C(null),x=C(null),k=C(!1),N=C(!1),p=C(!1),y=C(""),w=C(null),P=D(()=>{const E=R.value!==(c.fullName||""),d=x.value!==null;return E||d});ne(()=>o.modelValue,E=>{E&&(R.value=c.fullName||"",b.value=c.avatarUrl||null,x.value=null,y.value="",p.value=!1)});function T(){i("update:modelValue",!1),i("close")}function u(){w.value?.click()}function v(E){const d=E.target;d.files&&d.files[0]&&S(d.files[0])}function g(){p.value=!0}function _(){p.value=!1}function A(E){p.value=!1,E.dataTransfer?.files&&E.dataTransfer.files[0]&&S(E.dataTransfer.files[0])}function S(E){if(!["image/png","image/jpeg","image/gif","image/webp"].includes(E.type)){y.value="è¯·é€‰æ‹© PNGã€JPGã€GIF æˆ– WebP æ ¼å¼çš„å›¾ç‰‡";return}if(E.size>2*1024*1024){y.value="å›¾ç‰‡å¤§å°ä¸èƒ½è¶…è¿‡ 2MB";return}y.value="",x.value=E;const F=new FileReader;F.onload=r=>{b.value=r.target?.result},F.readAsDataURL(E)}function U(){b.value=c.avatarUrl||null,x.value=null,w.value&&(w.value.value="")}async function j(){if(P.value){k.value=!0,y.value="";try{let E;if(x.value){N.value=!0;const F=await c.uploadAvatar(x.value);if(N.value=!1,!F.success){y.value=F.error||"å¤´åƒä¸Šä¼ å¤±è´¥",k.value=!1;return}E=F.avatarUrl}const d=R.value!==c.fullName;if(d){const F={};d&&(F.fullName=R.value);const r=await c.updateProfile(F);if(!r.success){y.value=r.error||"ä¿å­˜å¤±è´¥ï¼Œè¯·é‡è¯•",k.value=!1;return}}i("saved"),T()}catch(E){y.value=E.message||"ä¿å­˜å¤±è´¥ï¼Œè¯·é‡è¯•"}finally{k.value=!1,N.value=!1}}}return(E,d)=>(n(),V(ae,{to:"body"},[B(Q,{name:"dialog"},{default:G(()=>[e.modelValue?(n(),l("div",{key:0,class:"dialog-overlay",onClick:K(T,["self"])},[t("div",ut,[t("div",{class:"dialog-header"},[d[1]||(d[1]=t("h2",{class:"dialog-title"},"ç¼–è¾‘ä¸ªäººèµ„æ–™",-1)),t("button",{class:"close-btn",onClick:T},"âœ•")]),t("div",dt,[t("div",ft,[t("div",{class:W(["avatar-upload-area",{"drag-over":p.value,uploading:N.value}]),onClick:u,onDragover:K(g,["prevent"]),onDragleave:K(_,["prevent"]),onDrop:K(A,["prevent"])},[t("div",vt,[b.value?(n(),l("img",{key:0,src:b.value,alt:"avatar",class:"avatar-img"},null,8,pt)):(n(),l("span",gt,h(f(c).initials),1))]),t("div",mt,[N.value?(n(),l("span",ht,"ä¸Šä¼ ä¸­...")):(n(),l("span",yt,"ç‚¹å‡»æˆ–æ‹–æ‹½ä¸Šä¼ "))])],34),t("input",{ref_key:"fileInput",ref:w,type:"file",accept:"image/png,image/jpeg,image/gif,image/webp",onChange:v,class:"file-input-hidden"},null,544),d[2]||(d[2]=t("div",{class:"avatar-hint"},"æ”¯æŒ PNGã€JPGã€GIFã€WebPï¼Œæœ€å¤§ 2MB",-1)),b.value&&b.value!==f(c).avatarUrl?(n(),l("button",{key:0,class:"avatar-reset-btn",onClick:U}," é‡ç½® ")):I("",!0)]),t("div",_t,[t("div",bt,[d[3]||(d[3]=t("label",{class:"form-label"},"æ˜¾ç¤ºåç§°",-1)),le(t("input",{type:"text","onUpdate:modelValue":d[0]||(d[0]=F=>R.value=F),placeholder:"è¾“å…¥æ‚¨çš„æ˜¾ç¤ºåç§°",class:"form-input"},null,512),[[Ne,R.value]])]),t("div",kt,[d[4]||(d[4]=t("label",{class:"form-label"},"ç”¨æˆ·å",-1)),t("input",{type:"text",value:f(c).username,disabled:"",class:"form-input form-input--disabled"},null,8,wt),d[5]||(d[5]=t("span",{class:"form-hint"},"ç”¨æˆ·åä¸å¯ä¿®æ”¹",-1))]),t("div",Tt,[d[6]||(d[6]=t("label",{class:"form-label"},"é‚®ç®±",-1)),t("input",{type:"email",value:f(c).email,disabled:"",class:"form-input form-input--disabled"},null,8,$t),d[7]||(d[7]=t("span",{class:"form-hint"},"é‚®ç®±ä¸å¯ä¿®æ”¹",-1))])]),y.value?(n(),l("div",It,h(y.value),1)):I("",!0)]),t("div",Nt,[t("button",{class:"btn btn--secondary",onClick:T,disabled:k.value||N.value}," å–æ¶ˆ ",8,At),t("button",{class:"btn btn--primary",onClick:j,disabled:k.value||N.value||!P.value},h(k.value?"ä¿å­˜ä¸­...":"ä¿å­˜"),9,Ct)])])])):I("",!0)]),_:1})]))}}),Et=q(St,[["__scopeId","data-v-75df5faa"]]),Rt={class:"change-password-dialog"},xt={class:"dialog-content"},Ot={key:0,class:"success-state"},Pt={key:1,class:"form-section"},Lt={class:"form-group"},Dt={class:"password-input-wrapper"},Ft=["type"],Ut={class:"form-group"},Vt={class:"password-input-wrapper"},Mt=["type"],zt={key:0,class:"password-strength"},Bt={class:"strength-bar"},jt={class:"form-group"},Ht={class:"password-input-wrapper"},Wt=["type"],Kt={key:0,class:"form-error"},Gt={key:0,class:"error-message"},Qt={class:"dialog-footer"},Jt=["disabled"],Zt=["disabled"],qt=ie({__name:"ChangePasswordDialog",props:{modelValue:{type:Boolean}},emits:["update:modelValue","close","changed"],setup(e,{emit:s}){const o=e,i=s,c=oe(),R=C(""),b=C(""),x=C(""),k=C(!1),N=C(!1),p=C(!1),y=C(!1),w=C(""),P=C(!1),T=C(null),u=C(null),v=D(()=>b.value===x.value),g=D(()=>{const r=b.value;if(!r)return 0;let a=0;return r.length>=8&&(a+=25),r.length>=12&&(a+=15),/[a-z]/.test(r)&&(a+=15),/[A-Z]/.test(r)&&(a+=15),/[0-9]/.test(r)&&(a+=15),/[^a-zA-Z0-9]/.test(r)&&(a+=15),Math.min(100,a)}),_=D(()=>g.value),A=D(()=>{const r=g.value;return r<40?"weak":r<70?"medium":"strong"}),S=D(()=>{const r=g.value;return r<40?"å¼±":r<70?"ä¸­ç­‰":"å¼º"}),U=D(()=>R.value.length>0&&b.value.length>=8&&v.value);ne(()=>o.modelValue,r=>{r&&(R.value="",b.value="",x.value="",k.value=!1,N.value=!1,p.value=!1,w.value="",P.value=!1)});function j(){i("update:modelValue",!1),i("close")}function E(){T.value?.focus()}function d(){u.value?.focus()}async function F(){if(U.value){y.value=!0,w.value="";try{const r=await c.changePassword(R.value,b.value);r.success?(P.value=!0,i("changed")):w.value=r.error||"ä¿®æ”¹å¤±è´¥ï¼Œè¯·é‡è¯•"}catch(r){w.value=r.message||"ä¿®æ”¹å¤±è´¥ï¼Œè¯·é‡è¯•"}finally{y.value=!1}}}return(r,a)=>(n(),V(ae,{to:"body"},[B(Q,{name:"dialog"},{default:G(()=>[e.modelValue?(n(),l("div",{key:0,class:"dialog-overlay",onClick:K(j,["self"])},[t("div",Rt,[t("div",{class:"dialog-header"},[a[6]||(a[6]=t("h2",{class:"dialog-title"},"ä¿®æ”¹å¯†ç ",-1)),t("button",{class:"close-btn",onClick:j},"âœ•")]),t("div",xt,[P.value?(n(),l("div",Ot,[...a[7]||(a[7]=[t("span",{class:"success-icon"},"âœ“",-1),t("p",{class:"success-message"},"å¯†ç ä¿®æ”¹æˆåŠŸï¼",-1),t("p",{class:"success-hint"},"è¯·ä½¿ç”¨æ–°å¯†ç é‡æ–°ç™»å½•",-1)])])):(n(),l("div",Pt,[t("div",Lt,[a[8]||(a[8]=t("label",{class:"form-label"},"å½“å‰å¯†ç ",-1)),t("div",Dt,[le(t("input",{type:k.value?"text":"password","onUpdate:modelValue":a[0]||(a[0]=O=>R.value=O),placeholder:"è¾“å…¥å½“å‰å¯†ç ",class:"form-input",onKeyup:re(E,["enter"])},null,40,Ft),[[ce,R.value]]),t("button",{type:"button",class:"toggle-password-btn",onClick:a[1]||(a[1]=O=>k.value=!k.value)},h(k.value?"ðŸ™ˆ":"ðŸ‘ï¸"),1)])]),t("div",Ut,[a[9]||(a[9]=t("label",{class:"form-label"},"æ–°å¯†ç ",-1)),t("div",Vt,[le(t("input",{ref_key:"newPasswordInput",ref:T,type:N.value?"text":"password","onUpdate:modelValue":a[2]||(a[2]=O=>b.value=O),placeholder:"è¾“å…¥æ–°å¯†ç ï¼ˆè‡³å°‘8ä½ï¼‰",class:"form-input",onKeyup:re(d,["enter"])},null,40,Mt),[[ce,b.value]]),t("button",{type:"button",class:"toggle-password-btn",onClick:a[3]||(a[3]=O=>N.value=!N.value)},h(N.value?"ðŸ™ˆ":"ðŸ‘ï¸"),1)]),b.value?(n(),l("div",zt,[t("div",Bt,[t("div",{class:W(["strength-fill",A.value]),style:Y({width:_.value+"%"})},null,6)]),t("span",{class:W(["strength-text",A.value])},h(S.value),3)])):I("",!0)]),t("div",jt,[a[10]||(a[10]=t("label",{class:"form-label"},"ç¡®è®¤æ–°å¯†ç ",-1)),t("div",Ht,[le(t("input",{ref_key:"confirmPasswordInput",ref:u,type:p.value?"text":"password","onUpdate:modelValue":a[4]||(a[4]=O=>x.value=O),placeholder:"å†æ¬¡è¾“å…¥æ–°å¯†ç ",class:W(["form-input",{"form-input--error":x.value&&!v.value}]),onKeyup:re(F,["enter"])},null,42,Wt),[[ce,x.value]]),t("button",{type:"button",class:"toggle-password-btn",onClick:a[5]||(a[5]=O=>p.value=!p.value)},h(p.value?"ðŸ™ˆ":"ðŸ‘ï¸"),1)]),x.value&&!v.value?(n(),l("span",Kt," ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´ ")):I("",!0)]),w.value?(n(),l("div",Gt,h(w.value),1)):I("",!0)]))]),t("div",Qt,[P.value?(n(),l("button",{key:0,class:"btn btn--primary",onClick:j}," å®Œæˆ ")):(n(),l(Z,{key:1},[t("button",{class:"btn btn--secondary",onClick:j,disabled:y.value}," å–æ¶ˆ ",8,Jt),t("button",{class:"btn btn--primary",onClick:F,disabled:y.value||!U.value},h(y.value?"ä¿®æ”¹ä¸­...":"ä¿®æ”¹å¯†ç "),9,Zt)],64))])])])):I("",!0)]),_:1})]))}}),Xt=q(qt,[["__scopeId","data-v-6a1772e5"]]),Yt={class:"context-panel"},es={class:"user-avatar"},ts={class:"avatar-circle"},ss=["src"],os={key:1,class:"avatar-initials"},is={class:"user-info"},ns={class:"user-name"},as={class:"user-email"},ls={key:0,class:"user-menu"},rs={class:"menu-credits"},cs={__name:"ContextPanel",props:{userName:{type:String,default:""},userEmail:{type:String,default:""},userCredits:{type:Number,default:0},userAvatarUrl:{type:String,default:null}},setup(e){const s=te(()=>se(()=>import("./DashboardPanel-3Y0QnzcO.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10]),import.meta.url)),o=te(()=>se(()=>import("./WorkflowContextPanel-DI_Gd8sW.js"),__vite__mapDeps([11,4,1,2,3,12,13,14,15]),import.meta.url)),i=te(()=>se(()=>import("./AssetsPanel-e6XBygAm.js"),__vite__mapDeps([16,5,2,1,3,4,17]),import.meta.url)),c=te(()=>se(()=>import("./CharactersPanel-DepzV6PI.js"),__vite__mapDeps([18,5,2,1,3,4,19]),import.meta.url)),R=te(()=>se(()=>import("./SettingsPanel-BRvowfdk.js"),__vite__mapDeps([20,1,2,3,4,21]),import.meta.url)),b=e,x=fe(),k=de(),N=oe(),p=me(),y=C(!1),w=C(!1),P=C(!1),T=C(!1),u=D(()=>b.userName||"User"),v=D(()=>N.initials||"U"),g={dashboard:s,workflow:o,assets:i,characters:c,settings:R},_=D(()=>g[k.activeNavId]||s),A=D(()=>k.currentPanelContext);function S(){y.value=!y.value}function U(){y.value=!1}function j($){if(!y.value)return;document.querySelector(".context-panel");const m=document.querySelector(".user-menu");if(m&&m.contains($.target))return;const z=document.querySelector(".user-section");z&&z.contains($.target)||U()}function E(){y.value=!1,w.value=!0}function d(){y.value=!1,P.value=!0}function F(){y.value=!1,T.value=!0}function r(){p.addNotification({type:"success",title:"ä¿å­˜æˆåŠŸ",message:"ä¸ªäººèµ„æ–™å·²æ›´æ–°"})}function a(){p.addNotification({type:"success",title:"ä¿®æ”¹æˆåŠŸ",message:"å¯†ç å·²æ›´æ–°ï¼Œè¯·ä½¿ç”¨æ–°å¯†ç ç™»å½•"})}async function O(){console.log("ðŸšª Logout initiated..."),y.value=!1,await N.logout(),console.log("ðŸ§¹ User store logout completed");const $=localStorage.getItem("novel_anime_access_token");console.log("ðŸ” Token after logout:",$?"STILL EXISTS!":"cleared"),p.addNotification({type:"success",title:"å·²é€€å‡º",message:"æ‚¨å·²æˆåŠŸé€€å‡ºç™»å½•"}),console.log("ðŸ”„ Redirecting to /login..."),await x.push("/login"),console.log("âœ… Router push completed")}return ve(async()=>{document.addEventListener("click",j)}),_e(()=>{document.removeEventListener("click",j)}),($,m)=>(n(),l("div",Yt,[t("div",{class:"user-section",onClick:S},[t("div",es,[t("div",ts,[e.userAvatarUrl?(n(),l("img",{key:0,src:e.userAvatarUrl,alt:"avatar",class:"avatar-img"},null,8,ss)):(n(),l("span",os,h(v.value),1))])]),t("div",is,[t("div",ns,[xe(h(u.value)+" ",1),m[3]||(m[3]=t("span",{class:"dropdown-arrow"},"â–¾",-1))]),t("div",as,h(e.userEmail),1)]),t("div",{class:"credits-display",onClick:K(E,["stop"])},[(n(),V(H(f(L).star),{size:14})),t("span",null,h(e.userCredits),1)])]),y.value?(n(),l("div",ls,[t("div",{class:"user-menu-item",onClick:K(d,["stop"])},[(n(),V(H(f(L).edit),{size:16})),m[4]||(m[4]=t("span",null,"ç¼–è¾‘èµ„æ–™",-1))]),t("div",{class:"user-menu-item",onClick:K(F,["stop"])},[(n(),V(H(f(L).lock),{size:16})),m[5]||(m[5]=t("span",null,"ä¿®æ”¹å¯†ç ",-1))]),t("div",{class:"user-menu-item",onClick:K(E,["stop"])},[(n(),V(H(f(L).star),{size:16})),m[6]||(m[6]=t("span",null,"ç§¯åˆ†è®°å½•",-1)),t("span",rs,h(e.userCredits),1)]),m[8]||(m[8]=t("div",{class:"user-menu-divider"},null,-1)),t("div",{class:"user-menu-item user-menu-item--danger",onClick:K(O,["stop"])},[(n(),V(H(f(L).logOut),{size:16})),m[7]||(m[7]=t("span",null,"é€€å‡ºç™»å½•",-1))])])):I("",!0),(n(),V(H(_.value),Oe(Pe(A.value)),null,16)),B(ct,{modelValue:w.value,"onUpdate:modelValue":m[0]||(m[0]=z=>w.value=z)},null,8,["modelValue"]),B(Et,{modelValue:P.value,"onUpdate:modelValue":m[1]||(m[1]=z=>P.value=z),onSaved:r},null,8,["modelValue"]),B(Xt,{modelValue:T.value,"onUpdate:modelValue":m[2]||(m[2]=z=>T.value=z),onChanged:a},null,8,["modelValue"])]))}},us=q(cs,[["__scopeId","data-v-c626adee"]]),ds={key:0,class:"tutorial-overlay"},fs={class:"tutorial-card__header"},vs={class:"tutorial-card__title"},ps={class:"tutorial-card__content"},gs={class:"tutorial-card__description"},ms={class:"tutorial-card__progress"},hs={class:"tutorial-card__progress-bar"},ys={class:"tutorial-card__progress-text"},_s={class:"tutorial-card__actions"},bs=ie({__name:"TutorialOverlay",setup(e){const{isActive:s,activeTutorial:o,currentStep:i,currentStepIndex:c,progress:R,canGoNext:b,canGoPrev:x,isLastStep:k,nextStep:N,prevStep:p,skipTutorial:y,completeTutorial:w}=ye(),P=C({}),T=C({});function u(){if(!i.value?.target){P.value={},T.value={};return}const E=document.querySelector(i.value.target);if(!E){console.warn(`Tutorial target not found: ${i.value.target}`),P.value={},T.value={};return}const d=E.getBoundingClientRect(),F=8;P.value={top:`${d.top-F}px`,left:`${d.left-F}px`,width:`${d.width+F*2}px`,height:`${d.height+F*2}px`};const r=i.value.position||"center",a=400,O=300,$=20;let m=0,z=0;switch(r){case"top":m=d.top-O-$,z=d.left+d.width/2-a/2;break;case"bottom":m=d.bottom+$,z=d.left+d.width/2-a/2;break;case"left":m=d.top+d.height/2-O/2,z=d.left-a-$;break;case"right":m=d.top+d.height/2-O/2,z=d.right+$;break;case"center":default:m=window.innerHeight/2-O/2,z=window.innerWidth/2-a/2;break}m=Math.max(20,Math.min(m,window.innerHeight-O-20)),z=Math.max(20,Math.min(z,window.innerWidth-a-20)),T.value={top:`${m}px`,left:`${z}px`}}ne([i,s],()=>{s.value&&setTimeout(u,100)},{immediate:!0});let v=null;function g(){v&&clearTimeout(v),v=window.setTimeout(u,100)}ve(()=>{window.addEventListener("resize",g)}),_e(()=>{window.removeEventListener("resize",g),v&&clearTimeout(v)});function _(){N()}function A(){p()}function S(){y()}function U(){w()}function j(){i.value?.canSkip!==!1&&S()}return(E,d)=>(n(),V(ae,{to:"body"},[B(Q,{name:"tutorial-fade"},{default:G(()=>[f(s)?(n(),l("div",ds,[t("div",{class:"tutorial-backdrop",onClick:j}),f(i)?.target?(n(),l("div",{key:0,class:"tutorial-spotlight",style:Y(P.value)},null,4)):I("",!0),t("div",{class:W(["tutorial-card",`tutorial-card--${f(i)?.position||"center"}`]),style:Y(T.value)},[t("div",fs,[t("h3",vs,h(f(i)?.title),1),f(i)?.canSkip!==!1?(n(),l("button",{key:0,class:"tutorial-card__close",onClick:S,title:"è·³è¿‡æ•™ç¨‹"},[...d[0]||(d[0]=[t("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"currentColor"},[t("path",{d:"M10 8.586L2.929 1.515 1.515 2.929 8.586 10l-7.071 7.071 1.414 1.414L10 11.414l7.071 7.071 1.414-1.414L11.414 10l7.071-7.071-1.414-1.414L10 8.586z"})],-1)])])):I("",!0)]),t("div",ps,[t("p",gs,h(f(i)?.description),1)]),t("div",ms,[t("div",hs,[t("div",{class:"tutorial-card__progress-fill",style:Y({width:`${f(R)}%`})},null,4)]),t("span",ys,h(f(c)+1)+" / "+h(f(o)?.steps.length),1)]),t("div",_s,[f(x)?(n(),l("button",{key:0,class:"tutorial-btn tutorial-btn--secondary",onClick:A},h(f(i)?.prevLabel||"ä¸Šä¸€æ­¥"),1)):I("",!0),d[1]||(d[1]=t("div",{class:"tutorial-card__spacer"},null,-1)),f(i)?.canSkip!==!1&&!f(k)?(n(),l("button",{key:1,class:"tutorial-btn tutorial-btn--text",onClick:S}," è·³è¿‡æ•™ç¨‹ ")):I("",!0),f(b)?(n(),l("button",{key:2,class:"tutorial-btn tutorial-btn--primary",onClick:_},h(f(i)?.nextLabel||"ä¸‹ä¸€æ­¥"),1)):(n(),l("button",{key:3,class:"tutorial-btn tutorial-btn--primary",onClick:U},h(f(i)?.nextLabel||"å®Œæˆ"),1))])],6)])):I("",!0)]),_:1})]))}}),ks=q(bs,[["__scopeId","data-v-739c779a"]]),ws={width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},Ts={key:0,cx:"12",cy:"12",r:"10"},$s={key:1,d:"M12 16v-4"},Is={key:2,d:"M12 8h.01"},Ns={key:3,d:"M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"},As={key:4,x1:"12",y1:"9",x2:"12",y2:"13"},Cs={key:5,x1:"12",y1:"17",x2:"12.01",y2:"17"},Ss={key:6,cx:"12",cy:"12",r:"10"},Es={key:7,x1:"15",y1:"9",x2:"9",y2:"15"},Rs={key:8,x1:"9",y1:"9",x2:"15",y2:"15"},xs={class:"error-dialog__content"},Os={class:"error-dialog__title"},Ps={class:"error-dialog__message"},Ls={key:0,class:"error-dialog__solution"},Ds={class:"solution-text"},Fs={key:1,class:"error-dialog__details"},Us={key:0,class:"details-content"},Vs={class:"error-dialog__actions"},Ms=["onClick"],zs=ie({__name:"ErrorDialog",props:{visible:{type:Boolean},title:{},message:{},solution:{},details:{},severity:{default:"error"},actions:{default:()=>[]}},emits:["close","action"],setup(e,{emit:s}){const o=e,i=s,c=C(!1),R=D(()=>He(o.severity));function b(){i("close")}function x(){o.severity!=="critical"&&b()}function k(N){i("action",N),N.action&&N.action(),b()}return(N,p)=>(n(),V(ae,{to:"body"},[B(Q,{name:"dialog-fade"},{default:G(()=>[e.visible?(n(),l("div",{key:0,class:"error-dialog-overlay",onClick:x},[t("div",{class:W(["error-dialog",`error-dialog--${e.severity}`]),onClick:p[1]||(p[1]=K(()=>{},["stop"]))},[t("div",{class:"error-dialog__icon",style:Y({color:R.value})},[(n(),l("svg",ws,[e.severity==="info"?(n(),l("circle",Ts)):I("",!0),e.severity==="info"?(n(),l("path",$s)):I("",!0),e.severity==="info"?(n(),l("path",Is)):I("",!0),e.severity==="warning"?(n(),l("path",Ns)):I("",!0),e.severity==="warning"?(n(),l("line",As)):I("",!0),e.severity==="warning"?(n(),l("line",Cs)):I("",!0),e.severity==="error"||e.severity==="critical"?(n(),l("circle",Ss)):I("",!0),e.severity==="error"||e.severity==="critical"?(n(),l("line",Es)):I("",!0),e.severity==="error"||e.severity==="critical"?(n(),l("line",Rs)):I("",!0)]))],4),t("div",xs,[t("h3",Os,h(e.title),1),t("p",Ps,h(e.message),1),e.solution?(n(),l("div",Ls,[p[2]||(p[2]=t("div",{class:"solution-header"},[t("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("circle",{cx:"12",cy:"12",r:"10"}),t("path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"}),t("line",{x1:"12",y1:"17",x2:"12.01",y2:"17"})]),t("span",null,"è§£å†³æ–¹æ¡ˆ")],-1)),t("p",Ds,h(e.solution),1)])):I("",!0),e.details?(n(),l("div",Fs,[t("button",{class:"details-toggle",onClick:p[0]||(p[0]=y=>c.value=!c.value)},[(n(),l("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2",class:W({rotated:c.value})},[...p[3]||(p[3]=[t("polyline",{points:"6 9 12 15 18 9"},null,-1)])],2)),t("span",null,h(c.value?"éšè—":"æŸ¥çœ‹")+"æŠ€æœ¯è¯¦æƒ…",1)]),B(Q,{name:"details-expand"},{default:G(()=>[c.value?(n(),l("pre",Us,h(e.details),1)):I("",!0)]),_:1})])):I("",!0)]),t("div",Vs,[(n(!0),l(Z,null,ee(e.actions,(y,w)=>(n(),l("button",{key:w,class:W(["error-dialog__btn",{"error-dialog__btn--primary":y.primary}]),onClick:P=>k(y)},h(y.label),11,Ms))),128)),!e.actions||e.actions.length===0?(n(),l("button",{key:0,class:"error-dialog__btn error-dialog__btn--primary",onClick:b}," ç¡®å®š ")):I("",!0)]),t("button",{class:"error-dialog__close",onClick:b,title:"å…³é—­"},[...p[4]||(p[4]=[t("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),t("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)])])],2)])):I("",!0)]),_:1})]))}}),Bs=q(zs,[["__scopeId","data-v-942309a4"]]),js={class:"mobile-nav"},Hs=["aria-label"],Ws={class:"mobile-nav__user"},Ks={class:"user-info"},Gs={class:"user-name"},Qs={class:"user-email"},Js={class:"mobile-nav__items"},Zs=["onClick"],qs={class:"mobile-nav__footer"},Xs={__name:"MobileNav",setup(e){const s=fe(),o=de(),i=oe(),c=C(!1),R=[{id:"dashboard",route:"/dashboard",label:"é¡¹ç›®æ¦‚è§ˆ",icon:L.home},{id:"workflow",route:"/workflow",label:"å·¥ä½œæµ",icon:L.gitBranch},{id:"assets",route:"/assets",label:"èµ„æºåº“",icon:L.folderOpen},{id:"characters",route:"/characters",label:"è§’è‰²ç®¡ç†",icon:L.users}],b=D(()=>o.activeNavId),x=D(()=>i.displayName||"ç”¨æˆ·"),k=D(()=>i.email||""),N=D(()=>x.value.charAt(0).toUpperCase()),p=D(()=>{const u=["#7a9188","#8a9aaa","#959c98"],v=x.value.charCodeAt(0)%u.length;return u[v]});function y(){c.value=!c.value}function w(){c.value=!1}function P(u){o.setActiveNav(u.id),s.push(u.route),w()}function T(){o.setActiveNav("settings"),s.push("/settings"),w()}return(u,v)=>(n(),l("div",js,[t("button",{class:"mobile-nav__toggle",onClick:y,"aria-label":c.value?"Close menu":"Open menu"},[(n(),V(H(c.value?f(L).x:f(L).menu),{size:24}))],8,Hs),B(Q,{name:"fade"},{default:G(()=>[c.value?(n(),l("div",{key:0,class:"mobile-nav__overlay",onClick:w})):I("",!0)]),_:1}),B(Q,{name:"slide"},{default:G(()=>[c.value?(n(),l("nav",{key:0,class:"mobile-nav__drawer",onClick:v[0]||(v[0]=K(()=>{},["stop"]))},[t("div",Ws,[t("div",{class:"avatar-circle",style:Y({background:p.value})},h(N.value),5),t("div",Ks,[t("div",Gs,h(x.value),1),t("div",Qs,h(k.value),1)])]),t("div",Js,[(n(),l(Z,null,ee(R,g=>t("button",{key:g.id,class:W(["mobile-nav__item",{"mobile-nav__item--active":b.value===g.id}]),onClick:_=>P(g)},[(n(),V(H(g.icon),{size:20})),t("span",null,h(g.label),1)],10,Zs)),64))]),t("div",qs,[t("button",{class:"mobile-nav__item",onClick:T},[(n(),V(H(f(L).settings),{size:20})),v[1]||(v[1]=t("span",null,"è®¾ç½®",-1))])])])):I("",!0)]),_:1})]))}},Ys=q(Xs,[["__scopeId","data-v-cb9105fc"]]),eo={class:"app-container"},to={class:"mobile-nav-container show-on-mobile"},so={class:"app-layout"},oo={class:"narrow-sidebar hide-on-mobile"},io={class:"sidebar-section sidebar-section--nav"},no={class:"sidebar-icons"},ao=["onClick","onMouseenter"],lo={class:"sidebar-section sidebar-section--settings"},ro={class:"sidebar-icons sidebar-icons--bottom"},co={class:"middle-panel"},uo={class:"menu-column"},fo={class:"main-area"},vo={class:"workspace-content"},po={class:"content-area"},go={key:0,class:"loading-overlay"},mo={class:"loading-spinner"},ho={class:"notification-container"},yo={class:"notification-icon"},_o={class:"notification-content"},bo={class:"notification-title"},ko={class:"notification-message"},wo=["onClick"],To={__name:"App",setup(e){console.log("ðŸ“± App.vue script setup started"),console.log("âš™ï¸ Setting up router and stores...");const s=fe(),o=Ee(),i=me(),c=de(),R=Ae(),b=Ve(),x=Me(),k=oe(),{autoStartWelcomeTutorial:N}=ye(),{errorDialog:p,closeError:y}=We();console.log("âœ… App.vue setup completed");const w=D(()=>R.currentProject),P=D(()=>o.meta.guest===!0||o.name==="login"),T=Le({visible:!1,text:"",top:0,left:0}),u=[{id:"dashboard",route:"/dashboard",label:"é¡¹ç›®æ¦‚è§ˆ",icon:L.home,description:"æŸ¥çœ‹é¡¹ç›®ç»Ÿè®¡å’Œå¿«é€Ÿæ“ä½œ"},{id:"workflow",route:"/workflow",label:"å·¥ä½œæµ",icon:L.gitBranch,description:"ç¼–è¾‘å’Œæ‰§è¡Œè½¬æ¢æµç¨‹"},{id:"assets",route:"/assets",label:"èµ„æºåº“",icon:L.folderOpen,description:"ç®¡ç†é¡¹ç›®èµ„æºæ–‡ä»¶"},{id:"characters",route:"/characters",label:"è§’è‰²ç®¡ç†",icon:L.users,description:"ç®¡ç†è§’è‰²æ¡£æ¡ˆå’Œä¸€è‡´æ€§"}],v=D(()=>c.activeNavId);function g(r){c.setActiveNav(r.id),i.setActiveRoute(r.route),s.push(r.route)}D(()=>{switch(o.name){case"home":return"é¡¹ç›®";case"files":return"æ–‡ä»¶ç®¡ç†";case"edit":return"ç¼–è¾‘å™¨";case"workflow":return"å·¥ä½œæµ";case"settings":return"è®¾ç½®";default:return"é¡¹ç›®"}}),D(()=>{if(w.value)return w.value.name;switch(o.name){case"home":return"Dashboard";case"files":return"æ–‡ä»¶ç®¡ç†";case"edit":return"å‰§æœ¬ç¼–è¾‘å™¨";case"workflow":return"å·¥ä½œæµç¼–è¾‘å™¨";case"settings":return"åº”ç”¨è®¾ç½®";default:return"å°è¯´åŠ¨æ¼«ç”Ÿæˆå™¨"}}),D(()=>{if(w.value)return w.value.description||"ç®¡ç†æ‚¨çš„åˆ›ä½œé¡¹ç›®";switch(o.name){case"home":return"æ‰€æœ‰å·¥ä½œæµå’Œé¡¹ç›®æ¦‚è§ˆ";case"files":return"ç®¡ç†é¡¹ç›®æ–‡ä»¶å’Œèµ„æº";case"edit":return"åˆ›ä½œå’Œç¼–è¾‘æ‚¨çš„å‰§æœ¬";case"workflow":return"è®¾è®¡å’Œæ‰§è¡Œå·¥ä½œæµç¨‹";case"settings":return"é…ç½®åº”ç”¨ç¨‹åºè®¾ç½®";default:return""}}),D(()=>["home","files","edit"].includes(o.name));function _(r){c.setActiveNav("settings"),i.setActiveRoute(r.route),r.route&&s.push(`/${r.route}`)}let A=null;function S(r,a){A&&(clearTimeout(A),A=null);const O=a.target.getBoundingClientRect();A=setTimeout(()=>{T.visible=!0,T.text=r.label,T.top=O.top+O.height/2-16,T.left=O.right+12},300)}function U(){A&&(clearTimeout(A),A=null),T.visible=!1}function j(r){return{success:L.check,error:L.alertCircle,warning:L.alertCircle,info:L.info}[r]||L.info}ve(()=>{console.log("ðŸš€ App.vue onMounted started");try{console.log("ðŸ” Checking app version...");const r=Ce(),a=Se();console.log("ðŸ“Š Version info:",a),r&&(console.log("âœ¨ Cache cleared due to version change"),setTimeout(()=>{i.addNotification({type:"info",title:"åº”ç”¨å·²æ›´æ–°",message:`ç‰ˆæœ¬ ${a.currentVersion} - ç¼“å­˜å·²è‡ªåŠ¨æ¸…ç†`,timeout:4e3})},1500)),console.log("ðŸŽ¨ Initializing theme system..."),Re(),console.log("âœ… Theme system initialized"),console.log("ðŸ“Š Initializing UI store..."),i.initializeFromStorage(),console.log("âœ… UI store initialized"),console.log("ðŸ§­ Initializing navigation store..."),c.initializeFromStorage(),console.log("âœ… Navigation store initialized"),console.log("ðŸ‘¤ Initializing user store..."),k.initializeFromStorage(),k.isLoggedIn&&(console.log("ðŸ”„ Fetching user profile..."),k.fetchProfile().then(m=>{m.success?console.log("âœ… User profile fetched successfully"):console.warn("âš ï¸ Failed to fetch user profile:",m.error)})),console.log("âœ… User store initialized"),console.log("ðŸ“‹ Loading tasks..."),b.loadTasks(),console.log("âœ… Tasks loaded"),console.log("ðŸ“ Loading file store..."),x.loadFromStorage(),console.log("âœ… File store loaded"),i.layout.sidebarCollapsed=!1,console.log("ðŸ“ Sidebar expanded");const O=o.path;console.log("ðŸ›£ï¸ Current path:",O);const $=u.find(m=>O.startsWith(m.route));$?(console.log("ðŸŽ¯ Matched nav:",$.id),c.setActiveNav($.id)):console.log("â“ No matching nav found for path:",O),console.log("âœ… App mounted, UI store initialized"),window.electronAPI?(console.log("ðŸ–¥ï¸ Setting up Electron API listeners"),window.electronAPI.onMenuAction(m=>{switch(console.log("ðŸ“± Menu action received:",m),m){case"new-project":E();break;case"open-project":d();break;case"workflow-editor":s.push("/workflow");break;case"generate-animation":F();break}})):console.log("ðŸŒ Running in web mode (no Electron API)"),console.log("ðŸŽ‰ App.vue onMounted completed successfully"),setTimeout(()=>{N()},1e3)}catch(r){console.error("ðŸ’¥ Error in App.vue onMounted:",r)}}),ne(()=>o.path,r=>{if(r.startsWith("/settings")){c.setActiveNav("settings");return}const a=u.find(O=>r.startsWith(O.route));a&&c.setActiveNav(a.id)});async function E(){const r=prompt("è¯·è¾“å…¥é¡¹ç›®åç§°:");if(r&&r.trim())try{console.log("ðŸ“ App: Creating project via menu:",r);const a=await R.createProject({name:r.trim(),description:"æ–°å»ºçš„å°è¯´åŠ¨æ¼«é¡¹ç›®",type:"novel-to-anime"});a?(console.log("âœ… App: Project created successfully:",a),i.addNotification({type:"success",title:"é¡¹ç›®åˆ›å»ºæˆåŠŸ",message:`é¡¹ç›® "${r}" å·²åˆ›å»º`,timeout:2e3}),s.push("/dashboard")):(console.error("âŒ App: Project creation failed"),i.addNotification({type:"error",title:"åˆ›å»ºé¡¹ç›®å¤±è´¥",message:R.error||"æ— æ³•åˆ›å»ºé¡¹ç›®ï¼Œè¯·é‡è¯•",timeout:5e3}))}catch(a){console.error("âŒ App: Exception during project creation:",a),i.addNotification({type:"error",title:"åˆ›å»ºé¡¹ç›®å¤±è´¥",message:a.message||"å‘ç”ŸæœªçŸ¥é”™è¯¯",timeout:5e3})}}async function d(){if(window.electronAPI)try{const r=await window.electronAPI.openProject();if(r){const a=await R.loadProject(r);a&&(i.addNotification({type:"success",title:"é¡¹ç›®æ‰“å¼€æˆåŠŸ",message:`é¡¹ç›® "${a.name}" å·²æ‰“å¼€`}),s.push(`/project/${a.id}`))}}catch(r){i.addNotification({type:"error",title:"æ‰“å¼€é¡¹ç›®å¤±è´¥",message:r.message})}}function F(){w.value?s.push("/workflow"):i.addNotification({type:"warning",title:"éœ€è¦é¡¹ç›®",message:"è¯·å…ˆåˆ›å»ºæˆ–æ‰“å¼€ä¸€ä¸ªé¡¹ç›®"})}return(r,a)=>{const O=Fe("router-view");return n(),l("div",eo,[P.value?(n(),V(O,{key:0})):(n(),l(Z,{key:1},[t("div",to,[B(Ys)]),t("div",so,[t("aside",oo,[t("div",io,[t("div",no,[a[2]||(a[2]=De('<div class="sidebar-logo" data-v-38bf1362><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-38bf1362><path d="M12 2L2 7L12 12L22 7L12 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-38bf1362></path><path d="M2 17L12 22L22 17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-38bf1362></path><path d="M2 12L12 17L22 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-38bf1362></path></svg></div><div class="sidebar-divider" data-v-38bf1362></div>',2)),(n(),l(Z,null,ee(u,$=>t("button",{key:$.id,class:W(["sidebar-icon-btn",{"sidebar-icon-btn--active":v.value===$.id}]),onClick:m=>g($),onMouseenter:m=>S({label:$.label},m),onMouseleave:U},[(n(),V(H($.icon),{size:24}))],42,ao)),64))]),a[3]||(a[3]=t("div",{class:"sidebar-section-divider"},null,-1)),a[4]||(a[4]=t("div",{class:"sidebar-label"},"NOVEL ANIME",-1))]),t("div",lo,[a[5]||(a[5]=t("div",{class:"sidebar-label sidebar-label--top"},"SETTINGS",-1)),a[6]||(a[6]=t("div",{class:"sidebar-section-divider"},null,-1)),t("div",ro,[t("button",{class:"sidebar-icon-btn sidebar-icon-btn--settings",onClick:a[0]||(a[0]=$=>_({route:"settings"})),onMouseenter:a[1]||(a[1]=$=>S({label:"Settings"},$)),onMouseleave:U},[(n(),V(H(f(L).settings),{size:24}))],32)])]),T.visible?(n(),l("div",{key:0,class:"sidebar-tooltip",style:Y({top:T.top+"px",left:T.left+"px"})},h(T.text),5)):I("",!0)]),t("div",co,[t("div",uo,[B(us,{"user-name":f(k).displayName,"user-email":f(k).email,"user-credits":f(k).credits,"user-avatar-url":f(k).avatarUrl},null,8,["user-name","user-email","user-credits","user-avatar-url"])]),t("main",fo,[t("div",vo,[t("div",po,[f(i).loading.global?(n(),l("div",go,[t("div",mo,[(n(),V(H(f(L).refresh),{size:24,class:"spin"}))]),a[7]||(a[7]=t("p",null,"Loading...",-1))])):(n(),V(O,{key:1},{default:G(({Component:$})=>[B(Q,{name:"view-fade",mode:"out-in"},{default:G(()=>[(n(),V(H($)))]),_:2},1024)]),_:1}))])])])])])],64)),t("div",ho,[(n(!0),l(Z,null,ee(f(i).notifications,$=>(n(),l("div",{key:$.id,class:W(["notification",`notification--${$.type}`])},[t("div",yo,[(n(),V(H(j($.type)),{size:16}))]),t("div",_o,[t("span",bo,h($.title),1),t("span",ko,h($.message),1)]),t("button",{class:"notification-close",onClick:m=>f(i).removeNotification($.id)},[(n(),V(H(f(L).x),{size:16}))],8,wo)],2))),128))]),B(ks),B(Bs,{visible:f(p).visible,title:f(p).title,message:f(p).message,solution:f(p).solution,details:f(p).details,severity:f(p).severity,actions:f(p).actions,onClose:f(y)},null,8,["visible","title","message","solution","details","severity","actions","onClose"])])}}},$o=q(To,[["__scopeId","data-v-38bf1362"]]),xo=Object.freeze(Object.defineProperty({__proto__:null,default:$o},Symbol.toStringTag,{value:"Module"}));export{xo as A,Ve as a,Me as u};
