<?xml version="1.0" encoding="UTF-8"?>
<entities xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
          xsi:noNamespaceSchemaLocation="http://moqui.org/xsd/moqui-entity-3.xsd">

    <!-- Entity to store metadata for each file/object in MinIO -->
    <entity entity-name="NetdiskFile" package="moqui.netdisk">
        <field name="fileId" type="id" is-pk="true"/>
        <field name="fileName" type="text-long" required="true"/>
        <field name="filePath" type="text-long" required="true"/> <!-- Full path within the bucket -->
        <field name="bucketName" type="text-medium" required="true"/>
        <field name="versionId" type="text-medium"/> <!-- For versioned objects in MinIO -->
        <field name="size" type="number-integer"/>
        <field name="contentType" type="text-short"/>
        <field name="etag" type="text-medium"/>
        <field name="ownerId" type="id-long" required="true"/> <!-- Maps to UserAccount.userId -->
        <field name="lastModifiedDate" type="date-time"/>
        <field name="isFolder" type="indicator" default-value="N"/>
        <relationship type="one" related="moqui.security.UserAccount" fk-name="NDF_USER_OWNER">
            <key-map field-name="ownerId" related-field-name="userId"/>
        </relationship>
        <seed-data>
            <!-- Example seed data can be added here if needed -->
        </seed-data>
    </entity>

    <!-- Entity to store bucket information and ownership -->
    <entity entity-name="NetdiskBucket" package="moqui.netdisk">
        <field name="bucketName" type="text-medium" is-pk="true"/>
        <field name="ownerId" type="id-long" required="true"/> <!-- Maps to UserAccount.userId -->
        <field name="creationDate" type="date-time"/>
        <relationship type="one" related="moqui.security.UserAccount" fk-name="NDB_USER_OWNER">
            <key-map field-name="ownerId" related-field-name="userId"/>
        </relationship>
    </entity>

    <!-- Entity to manage user storage quotas -->
    <entity entity-name="NetdiskUserQuota" package="moqui.netdisk">
        <field name="userId" type="id-long" is-pk="true"/>
        <field name="quotaSize" type="number-integer" default-value="5368709120"/> <!-- Default 5GB in bytes -->
        <field name="usedSize" type="number-integer" default-value="0"/>
        <relationship type="one" related="moqui.security.UserAccount" fk-name="NDQ_USER">
            <key-map field-name="userId"/>
        </relationship>
        <seed-data>
            <!-- Initial quota for system/admin user -->
            <record field-map='{"userId":"_NA_"}'>
                <field name="quotaSize" value="10737418240"/> <!-- 10GB for _NA_ user -->
            </record>
        </seed-data>
    </entity>
</entities>