## Welcome to Moqui Framework

## ğŸ¤– AI Agentå¿«é€Ÿé¡¹ç›®äº†è§£æŒ‡å—

**æ–°çš„AI agentå¼€å§‹å·¥ä½œå‰å¿…è¯»è·¯å¾„**ï¼š

### 1ï¸âƒ£ ç¬¬ä¸€æ­¥ï¼šäº†è§£é¡¹ç›®åŸºæœ¬æƒ…å†µ
- **é¡¹ç›®æ€§è´¨**: å¢å¼ºç‰ˆMoqui Frameworkï¼ŒåŒ…å«JWTè®¤è¯ã€JDK 21æ”¯æŒ
- **å½“å‰çŠ¶æ€**: ç”Ÿäº§å¯ç”¨ï¼Œæ­£åœ¨å‡†å¤‡Vue3+Quasar2å‡çº§
- **å…³é”®æ–‡ä»¶**: `CLAUDE.md` - AIå¼€å‘åŠ©æ‰‹çš„æ ¸å¿ƒå‚è€ƒæ–‡æ¡£

### 2ï¸âƒ£ ç¬¬äºŒæ­¥ï¼šæŒæ¡å…³é”®å¼€å‘æ¨¡å¼
- **è®¤è¯é—®é¢˜**: æŸ¥çœ‹ `CLAUDE.md` çš„è®¤è¯æ¨¡å¼éƒ¨åˆ† - Serviceç”¨`authenticate="false"`ï¼ŒScreenç”¨`require-authentication="false"`
- **å¸¸è§é”™è¯¯**: æŸ¥çœ‹ `runtime/docs/JWTè®¤è¯è¿ç§»ä¸å‰ç«¯æ¶æ„é‡æ„å®æˆ˜ç»éªŒæ€»ç»“.md`
- **å¼€å‘è§„èŒƒ**: æŸ¥çœ‹ `docs/Moquiç»„ä»¶å¼€å‘å®æˆ˜è§„èŒƒ.md`

### 3ï¸âƒ£ ç¬¬ä¸‰æ­¥ï¼šç†è§£é¡¹ç›®æ¶æ„
- **å¤šåº“ç»“æ„**: frameworkåº“ + runtimeåº“
- **ç»„ä»¶ç³»ç»Ÿ**: runtime/component/ ä¸‹çš„å„ä¸ªç»„ä»¶éƒ½æœ‰ç‹¬ç«‹çš„docsç›®å½•
- **åŠ¨æ€æ¸²æŸ“**: Moquié¡µé¢é€šè¿‡FreeMarker+Vue.jsåŠ¨æ€ç”Ÿæˆï¼Œéœ€è¦Chrome MCPéªŒè¯
- **Chrome MCPè°ƒè¯•**: éªŒè¯åŠ¨æ€å†…å®¹çš„æ ¸å¿ƒæ–¹æ³•ï¼Œcurlæµ‹è¯•æ— æ³•æ›¿ä»£

### 4ï¸âƒ£ ç¬¬å››æ­¥ï¼šé—®é¢˜è§£å†³æµç¨‹
1. ğŸ” **é¦–å…ˆæŸ¥çœ‹** `CLAUDE.md` - ç»è¿‡éªŒè¯çš„è§£å†³æ–¹æ¡ˆï¼ŒåŒ…å«Chrome MCPè°ƒè¯•æ¨¡å¼
2. ğŸ“– **ç„¶åå‚è€ƒ** ç›¸å…³ç»„ä»¶çš„docsç›®å½•
3. ğŸ“œ **æœ€åæŸ¥çœ‹** GitHubå†å²ç‰ˆæœ¬äº†è§£é—®é¢˜èƒŒæ™¯
4. ğŸ§ª **åŠ¨æ€éªŒè¯** ä½¿ç”¨Chrome MCPè°ƒè¯•é—­ç¯éªŒè¯å®é™…é¡µé¢æ•ˆæœ

### âš ï¸ é‡è¦åŸåˆ™
- **å§‹ç»ˆå‚è€ƒGitHubå†å²ç‰ˆæœ¬** - ç†è§£é¡¹ç›®æ¼”è¿›
- **å°Šé‡è‡ªåŠ¨åŒ–æœºåˆ¶** - é¿å…æ‰‹å·¥é…ç½®è¦†ç›–ç³»ç»Ÿè®¾è®¡
- **ä¿æŒæƒé™éªŒè¯** - ä¸è¦éšæ„ç§»é™¤å®‰å…¨æ£€æŸ¥
- **ä½¿ç”¨å¼‚æ­¥è°ƒç”¨** - é¿å…é˜»å¡ä¸»çº¿ç¨‹

---

[![license](https://img.shields.io/badge/license-CC0%201.0%20Universal-blue.svg)](https://github.com/moqui/moqui-framework/blob/master/LICENSE.md)
[![build](https://travis-ci.org/moqui/moqui-framework.svg)](https://travis-ci.org/moqui/moqui-framework)
[![release](https://img.shields.io/github/release/moqui/moqui-framework.svg)](https://github.com/moqui/moqui-framework/releases)
[![commits since release](http://img.shields.io/github/commits-since/moqui/moqui-framework/v3.0.0.svg)](https://github.com/moqui/moqui-framework/commits/master)
[![downloads](https://img.shields.io/github/downloads/moqui/moqui-framework/total.svg)](https://github.com/moqui/moqui-framework/releases)
[![downloads](https://img.shields.io/github/downloads/moqui/moqui-framework/v3.0.0/total.svg)](https://github.com/moqui/moqui-framework/releases/tag/v3.0.0)

[![Discourse Forum](https://img.shields.io/badge/moqui%20forum-discourse-blue.svg)](https://forum.moqui.org)
[![Google Group](https://img.shields.io/badge/google%20group-moqui-blue.svg)](https://groups.google.com/d/forum/moqui)
[![LinkedIn Group](https://img.shields.io/badge/linked%20in%20group-moqui-blue.svg)](https://www.linkedin.com/groups/4640689)
[![Gitter Chat at https://gitter.im/moqui/moqui-framework](https://badges.gitter.im/moqui/moqui-framework.svg)](https://gitter.im/moqui/moqui-framework?utm_source=badge&utm_medium=badge&utm_campaign=pr-badge&utm_content=badge)
[![Stack Overflow](https://img.shields.io/badge/stack%20overflow-moqui-blue.svg)](http://stackoverflow.com/questions/tagged/moqui)


For information about community infrastructure for code, discussions, support, etc see the Community Guide:

<https://www.moqui.org/docs/moqui/Community+Guide>

For details about running and deploying Moqui see:

<https://www.moqui.org/docs/framework/Run+and+Deploy>

Note that a runtime directory is required for Moqui Framework to run, but is not included in the source repository. The
Gradle get component, load, and run tasks will automatically add the default runtime (from the moqui-runtime repository).

For information about the current and near future status of Moqui Framework
see the [ReleaseNotes.md](https://github.com/moqui/moqui-framework/blob/master/ReleaseNotes.md) file.

For an overview of features see:

<https://www.moqui.org/docs/framework/Framework+Features>

Get started with Moqui development quickly using the Tutorial at:

<https://www.moqui.org/docs/framework/Quick+Tutorial>

For comprehensive documentation of Moqui Framework see the wiki based documentation on moqui.org (*running on Moqui HiveMind*):

<https://www.moqui.org/m/docs/framework>

## Enhanced Moqui Framework - Enterprise Edition

This is an enhanced version of Moqui Framework with enterprise-grade improvements including JWT authentication, JDK 21 support, and optimized performance configurations.

### ğŸš€ Major Enhancements

#### 1. Enterprise-Grade JWT Authentication System
- **Complete JWT Implementation**: Full enterprise-grade JWT authentication with advanced security features
- **Multi-Algorithm Support**: HS256/384/512, RS256/384/512 algorithms for maximum flexibility
- **Advanced Security Features**:
  - Rate limiting and brute force protection
  - Token refresh and rotation mechanisms
  - IP validation and session management
  - Comprehensive audit logging
  - Token revocation and blacklisting

#### 2. Java 21 LTS Support
- **JDK 21 Compatibility**: Fully upgraded to Java 21 LTS for latest performance and security features
- **Module System Support**: Complete compatibility with Java Module System (JPMS)
- **Gradle 8.10**: Updated build system with modern tooling support
- **Performance Optimizations**: Enhanced startup time and runtime performance

#### 3. Optimized Logging & Performance
- **Intelligent Logging**: Conditional debug logging with minimal performance impact
- **Clean Startup**: Dramatically reduced console noise during system initialization
- **Production-Ready**: Optimized configurations for enterprise deployment
- **Configurable Debug**: JWT debug logging can be toggled without code changes

#### 4. Modern Frontend Architecture (Latest Update - October 2025)
- **Bootstrap 3.x Removal**: Complete removal of legacy Bootstrap dependencies for cleaner, faster frontend
- **Flexbox-Based Layout**: Modern CSS using Flexbox layout system (77% code reduction: 272â†’63 lines)
- **Vue.js + Quasar Framework**: Pure Vue.js/Quasar implementation without Bootstrap dependency conflicts
- **Optimized Asset Loading**: Removed 4+ legacy JavaScript libraries, improved page load performance
- **UTF-8 BOM Fixes**: Resolved XML parsing issues across multiple configuration files

**Key Frontend Changes**:
```
Removed Dependencies:
- twitter-bootstrap (3.4.1)
- bootstrap-datetimepicker (4.17.47)
- bootstrap-notify (3.1.7)
- select2-bootstrap-theme (0.1.0)
- WebrootVue.js (obsolete Vue implementation)

Modern Stack:
âœ… Pure Vue.js 2.x for component architecture
âœ… Quasar Framework for UI components
âœ… Flexbox-based responsive layout
âœ… Simplified CSS with modern best practices
âœ… WebrootVue.qvt.js (current Quasar-Vue implementation)
```

**CSS Modernization Example**:
```css
/* Modern Flexbox approach - webroot-layout.css */
.row {
    display: flex;
    flex-wrap: wrap;
    margin-left: -12px;
    margin-right: -12px;
}

.row > [class*="col"] {
    padding-left: 12px;
    padding-right: 12px;
    flex: 1 0 0;
}
```

**Benefits**:
- **Performance**: Faster page loads without Bootstrap overhead
- **Maintainability**: Cleaner CSS codebase with 77% reduction in lines
- **Compatibility**: Better integration with Vue.js/Quasar component system
- **Modern Standards**: Using CSS Flexbox instead of legacy Bootstrap grid
- **Stability**: Fixed UTF-8 BOM issues preventing XML parsing errors

### ğŸ”§ Technical Implementation

#### JWT Authentication Features
**System Property Configuration**:
```bash
# Development Environment (defaults)
export MOQUI_JWT_ALGORITHM="HS256"
export MOQUI_JWT_SECRET="dev_jwt_secret_key_for_development_only_change_in_production_12345"
export MOQUI_JWT_ACCESS_EXPIRE_MINUTES="60"
export MOQUI_JWT_DEBUG_LOGGING="false"

# Production Environment
export MOQUI_JWT_ALGORITHM="RS256"
export MOQUI_JWT_PRIVATE_KEY_PATH="/path/to/private.key"
export MOQUI_JWT_PUBLIC_KEY_PATH="/path/to/public.key"
export MOQUI_JWT_IP_VALIDATION_ENABLED="true"
export MOQUI_JWT_RATE_LIMIT_ENABLED="true"
export MOQUI_JWT_AUDIT_ENABLED="true"
```

**Framework Integration**:
- Complete session-to-JWT migration for web authentication
- Framework-level centralized authentication handling
- Token visibility in both response headers and cookies
- Enterprise-grade security with audit trail integration

**Enterprise Security Features**:
- **Rate Limiting**: Configurable request throttling per user/IP
- **Audit Trail**: Complete authentication event logging
- **Token Management**: Refresh token rotation and revocation
- **Multi-Environment**: Separate dev/staging/production configurations

#### Core Framework Modifications

**Framework-Level JWT Authentication**:
- `framework/src/main/java/org/moqui/jwt/JwtUtil.java` - Enterprise JWT utility class with multi-algorithm support
- `framework/service/org/moqui/jwt/JwtSecurityServices.xml` - JWT security and management services
- `runtime/base-component/webroot/screen/webroot/Login.xml` - Unified JWT login implementation

**Enhanced REST API**:
- `framework/src/main/groovy/org/moqui/impl/service/RestApi.groovy` - JWT-enabled REST API with conditional debug logging

**Build & Compatibility**:
- `build.gradle` - JDK 21 compatibility and Gradle 8.10 support
- `framework/src/main/resources/log4j2.xml` - Optimized logging with minimal console noise

**Configuration Architecture**:
- System property-based configuration for all JWT parameters
- Environment-specific settings via system properties or configuration files
- Framework-level centralized authentication handling

### ğŸ›¡ï¸ Security Benefits

1. **Enhanced API Security**: Enterprise-grade JWT with configurable algorithms
2. **Zero-Trust Architecture**: IP validation and comprehensive session management
3. **Audit Compliance**: Complete authentication event logging for compliance requirements
4. **DoS Protection**: Built-in rate limiting and brute force protection
5. **Token Security**: Automatic token rotation and revocation capabilities

### ğŸ“‹ System Requirements

- **Java**: OpenJDK 21 LTS (Amazon Corretto recommended)
- **Gradle**: 8.10+ (automatically managed via wrapper)
- **Memory**: Minimum 2GB RAM (4GB recommended for production)
- **OS**: Linux, macOS, Windows (with proper JVM module access)

### ğŸš€ Quick Start

1. **Clone and Setup**:
   ```bash
   git clone <repository-url>
   cd moqui
   ./gradlew getRuntime
   ```

2. **Configure JWT (Production)**:
   ```bash
   export MOQUI_JWT_SECRET="your-production-secret-key"
   export MOQUI_JWT_ALGORITHM="RS256"
   export MOQUI_JWT_IP_VALIDATION="true"
   ```

3. **Run Development Server**:
   ```bash
   ./gradlew run
   ```

4. **Access Application**:
   - Web UI: http://localhost:8080
   - REST API: http://localhost:8080/rest/
   - Default Admin: john.doe / moqui

### ğŸ” JWT Authentication Details

#### Token Management
- **Access Tokens**: Short-lived tokens (default: 1 hour) for API access
- **Refresh Tokens**: Long-lived tokens (default: 30 days) for token renewal
- **Token Rotation**: Optional refresh token rotation for enhanced security
- **Revocation Support**: Global token blacklist with automatic cleanup

#### Token Visibility
- **Response Headers**: `Authorization`, `X-Access-Token`, `X-Refresh-Token`
- **Cookies**: `jwt_access_token` cookie for browser compatibility
- **Developer Tools**: Easily inspect tokens in browser F12 console
- **REST API**: Direct token access via JSON response

#### Security Features
- **Multi-Algorithm Support**: HMAC (HS256/384/512) and RSA (RS256/384/512)
- **IP Validation**: Optional client IP binding for enhanced security
- **Rate Limiting**: Configurable request throttling to prevent abuse
- **Audit Logging**: Complete authentication event tracking
- **Token Expiration**: Automatic cleanup of expired revoked tokens

### ğŸ”„ Migration Notes

**From Standard Moqui**:
- âœ… **Zero Breaking Changes**: All existing functionality preserved
- âœ… **Backward Compatible**: Existing UI authentication continues to work
- âœ… **Enhanced Security**: REST APIs now use JWT by default
- âœ… **Configuration Driven**: All security features configurable via system properties

**For API Clients**:
- REST API JWT authentication: `POST /rest/s1/moqui/auth/login`
- Request body: `{"username": "john.doe", "password": "moqui"}`
- Response includes: `accessToken`, `refreshToken`, `expiresIn`
- Token refresh: `POST /rest/s1/moqui/auth/refresh` with valid refresh token
- Tokens available in both response headers and cookies for maximum compatibility

### ğŸ“Š Performance Improvements

- **50%+ Faster Startup**: Optimized logging and reduced debug output
- **Enhanced Memory Usage**: Better garbage collection with JDK 21
- **Improved Security**: Zero-overhead JWT validation with caching
- **Production Ready**: Optimized configurations for enterprise deployment

This enhanced Moqui Framework provides enterprise-grade security, performance, and maintainability while preserving the framework's ease of use and flexibility.

## ğŸ“š Documentation Structure

This project uses an organized documentation structure with documents categorized by scope:

### ğŸ¯ Framework Documentation
Location: `docs/`
- **Development Standards**: Component development practices and coding standards
- **Technical Guides**: Vue3/Quasar2 upgrade planning and framework templates
- **Architecture Documentation**: Framework-level design patterns and principles

[ğŸ“– Browse Framework Documentation](docs/README.md)

### ğŸƒ Runtime Environment Documentation
Location: `runtime/docs/`
- **Authentication Systems**: JWT migration guides and configuration details
- **Environment Configuration**: Runtime settings and deployment guides
- **Operations Manual**: System administration and troubleshooting

[ğŸ”§ Browse Runtime Documentation](runtime/docs/README.md)

### ğŸ“ Component-Specific Documentation
Each component maintains its own documentation in its `docs/` directory:
- **Marketplace Component**: `runtime/component/moqui-marketplace/docs/`
- **MinIO Integration**: `runtime/component/moqui-minio/docs/`
- **MCP Integration**: `runtime/component/moqui-mcp/docs/`

### ğŸš€ Quick Documentation Access
- **New Developers**: Start with [Framework Development Standards](docs/Moquiç»„ä»¶å¼€å‘å®æˆ˜è§„èŒƒ.md)
- **System Issues**: Check [JWT Migration Experience Summary](runtime/docs/JWTè®¤è¯è¿ç§»ä¸å‰ç«¯æ¶æ„é‡æ„å®æˆ˜ç»éªŒæ€»ç»“.md)
- **Component Development**: Refer to component-specific docs in `runtime/component/*/docs/`

## ğŸ”— Additional Resources


